!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}(window,function(){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=11)}([function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(8),a=i(1),r=i(3),s=i(5),l=i(4),c=i(6);e.exports=function(){function e(t,i,o,a,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.queue=new n(t),this.controller=t,this.game=t.game,this.position=new r(a,s),this.type=i,this.facing=l,this.offset=[-22,-12],this.identifier=o,this.healthPoint=3,this.underTree={state:!1,treeIndex:-1}}return o(e,[{key:"tick",value:function(){this.queue.tick()}},{key:"reset",value:function(){}},{key:"canMoveThrough",value:function(){return!1}},{key:"canPlaceBlock",value:function(){return!1}},{key:"canTriggerPressurePlates",value:function(){return!1}},{key:"shouldUpdateSelectionIndicator",value:function(){return!1}},{key:"setMovePosition",value:function(e){this.position=e}},{key:"getSortOrderOffset",value:function(){return 5}},{key:"addCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.queue.addCommand(e,t),this.queue.begin()}},{key:"addAnimation",value:function(){var e;return(e=this.getAnimationManager()).add.apply(e,arguments)}},{key:"getAnimationManager",value:function(){return this.animationRig?this.animationRig.animations:this.sprite.animations}},{key:"getWalkAnimation",value:function(){return"walk"+this.controller.levelView.getDirectionName(this.facing)}},{key:"getIdleAnimation",value:function(){return"idle"+this.controller.levelView.getDirectionName(this.facing)}},{key:"playMoveForwardAnimation",value:function(e,t,i,o){var n,r=this,s=this.controller.levelView,l=e[1]+(t===a.North?1:0);this.sprite.sortOrder=this.controller.levelView.yToIndex(l)+1,s.playBlockSound(o),s.playScaledSpeed(this.getAnimationManager(),this.getWalkAnimation()),setTimeout(function(){(n=r.controller.levelView.addResettableTween(r.sprite).to({x:r.offset[0]+40*e[0],y:r.offset[1]+40*e[1]},300,Phaser.Easing.Linear.None)).onComplete.add(function(){s.playScaledSpeed(r.getAnimationManager(),r.getIdleAnimation()),i.succeeded()}),n.start()},50/this.controller.tweenTimeScale)}},{key:"walkableCheck",value:function(){}},{key:"updateHidingTree",value:function(){var e=this.controller.levelView;if(this.underTree.state){var t=this.underTree.treeIndex,i=this.controller.levelEntity.entityMap;e.isUnderTree(t,this.position)||(function(e,t,i){var o=!0,n=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var l=r.value[1];if(l!==e&&l.underTree.treeIndex===i)return!0}}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return!1}(this,i,t)||e.changeTreeAlpha(t,1),this.underTree={state:!1,treeIndex:-1})}else for(var o=e.trees,n=0;n<o.length;n++)if(e.isUnderTree(n,this.position)){e.changeTreeAlpha(n,.8),this.underTree={state:!0,treeIndex:n};break}}},{key:"updateHidingBlock",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel.actionPlane;this.isOnBlock||function(e,o){var n=r.south(o),a=i.getBlockAt(n);if(a&&!a.isTransparent){var s=t.actionPlaneBlocks[t.coordinatesToIndex(n)];null!==s&&e.controller.levelView.addResettableTween(s).to({alpha:.8},300,Phaser.Easing.Linear.None).start()}}(this,this.position),void 0!==e&&function(e,i){var o=r.south(i);if(o.y<10){var n=t.actionPlaneBlocks[t.coordinatesToIndex(o)];null!==n&&e.controller.levelView.addResettableTween(n).to({alpha:1},300,Phaser.Easing.Linear.None).start()}}(this,e)}},{key:"doMoveForward",value:function(e,t){var i=this.controller.levelModel,o=this.position;this.position=t;var n=i.groundPlane.getBlockAt(this.position).blockType;this.playMoveForwardAnimation(t,this.facing,e,n,function(){}),this.updateHidingTree(),this.updateHidingBlock(o)}},{key:"bump",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.getAnimationManager(),"bump"+i);var o=this.controller.levelModel.getMoveForwardPosition(this),n=this.controller.levelEntity.getEntityAt(o);null!==n&&(this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:s.WhenTouched,targetType:t.type,targetIdentifier:t.identifier,eventSenderIdentifier:n.identifier})}),this.queue.endPushHighPriorityCommands()),this.controller.delayPlayerMoveBy(400,800,function(){e.succeeded()})}},{key:"callBumpEvents",value:function(e){for(var t=this,i=1;i<e.length;i++)"frontEntity"===e[i]&&(this.controller.events.forEach(function(o){return o({eventType:s.WhenTouched,targetType:e[i+1].type,eventSenderIdentifier:t.identifier,targetIdentifier:e[i+1].identifier})}),i++)}},{key:"moveDirection",value:function(e,t){this.controller.levelModel.turnToDirection(this,t),this.moveForward(e,!1)}},{key:"moveForward",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.controller.addCommandRecord("moveForward",this.type,e.repeat);var t=this.controller.levelModel.getMoveForwardPosition(this),i=this.controller.levelModel.canMoveForward(this);if(i[0]){var o=r.directionToOffsetPosition(this.facing),n=r.directionToOffsetPosition(a.opposite(this.facing)),s=this.handleMoveOnPressurePlate(o);this.doMoveForward(e,t),s||this.handleMoveOffPressurePlate(n),this.handleMoveOffIronDoor(n),this.handleMoveAwayFromPiston(n)}else this.bump(e),this.callBumpEvents(i)}},{key:"moveBackward",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.controller.addCommandRecord("moveBackward",this.type,e.repeat);var t=this.controller.levelModel.getMoveDirectionPosition(this,2),i=this.controller.levelModel.canMoveBackward(this);if(i[0]){var o=r.directionToOffsetPosition(a.opposite(this.facing)),n=r.directionToOffsetPosition(this.facing),s=this.handleMoveOnPressurePlate(o);this.doMoveBackward(e,t),s||this.handleMoveOffPressurePlate(n),this.handleMoveOffIronDoor(n),this.handleMoveAwayFromPiston(n)}else this.bump(e),this.callBumpEvents(i)}},{key:"canPlaceBlockOver",value:function(){return{canPlace:!1,plane:""}}},{key:"moveAway",value:function(e,t){this.controller.addCommandRecord("moveAway",this.type,e.repeat);var i=t.position,o=[],n=function(e,t,i){return r.absoluteDistanceSquare(t[1],e)<r.absoluteDistanceSquare(i[1],e)?i:t},s=r.absoluteDistanceSquare(i,this.position);i.x<=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.East)[0]&&(o=[a.East,r.east(this.position)]),i.x>=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.West)[0]&&(o=o.length>0?n(i,o,[a.West,r.west(this.position)]):[a.West,r.west(this.position)]),i.y>=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.North)[0]&&(o=o.length>0?n(i,o,[a.North,r.north(this.position)]):[a.North,r.north(this.position)]),i.y<=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.South)[0]&&(o=o.length>0?n(i,o,[a.South,r.south(this.position)]):[a.South,r.south(this.position)]),0===o.length||s>=r.absoluteDistanceSquare(i,o[1])?e.succeeded():this.moveDirection(e,o[0])}},{key:"moveToward",value:function(e,t){this.controller.addCommandRecord("moveToward",this.type,e.repeat);var i=t.position,o=[],n=function(e,t,i){return r.absoluteDistanceSquare(t[1],e)>r.absoluteDistanceSquare(i[1],e)?i:t};return i.x>=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.East)[0]&&(o=[a.East,r.east(this.position)]),i.x<=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.West)[0]&&(o=o.length>0?n(i,o,[a.West,r.west(this.position)]):[a.West,r.west(this.position)]),i.y<=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.North)[0]&&(o=o.length>0?n(i,o,[a.North,r.north(this.position)]):[a.North,r.north(this.position)]),i.y>=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.South)[0]&&(o=o.length>0?n(i,o,[a.South,r.south(this.position)]):[a.South,r.south(this.position)]),1===r.absoluteDistanceSquare(this.position,i)?(this.position.x<i.x?this.facing=a.East:this.position.x>i.x?this.facing=a.West:this.position.y<i.y?this.facing=a.South:this.position.y>i.y&&(this.facing=a.North),this.updateAnimationDirection(),this.bump(e),!1):0===o.length?(e.succeeded(),!1):(this.moveDirection(e,o[0]),!0)}},{key:"moveTo",value:function(e,t){var i=this;if(1===r.absoluteDistanceSquare(t.position,this.position))t.position.y-this.position.y==-1?this.moveDirection(e,a.North):t.position.y-this.position.y==1?this.moveDirection(e,a.South):t.position.x-this.position.x==1?this.moveDirection(e,a.East):this.moveDirection(e,a.West);else if(this.moveToward(e,t)){var o=new l(this.controller,function(){},function(){i.moveTo(o,t)},this.identifier);this.addCommand(o)}else this.bump(e)}},{key:"turn",value:function(e,t){(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.controller.addCommandRecord("turn",this.type,e.repeat),-1===t&&this.controller.levelModel.turnLeft(this),1===t&&this.controller.levelModel.turnRight(this),this.updateAnimationDirection(),this.controller.delayPlayerMoveBy(200,800,function(){e.succeeded()})}},{key:"turnRandom",value:function(e){this.controller.addCommandRecord("turnRandom",this.type,e.repeat);var t=0===function(e,t){return Math.floor(Math.random()*(t-e+1))+e}(0,1)?1:-1;this.turn(e,t,!1)}},{key:"use",value:function(e,t){var i=this,o="lookAtCam"+this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.getAnimationManager(),o),this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:s.WhenUsed,targetType:i.type,eventSenderIdentifier:t.identifier,targetIdentifier:i.identifier})}),this.queue.endPushHighPriorityCommands(),e.succeeded()}},{key:"drop",value:function(e,t){var i=this;this.controller.addCommandRecord("drop",this.type,e.repeat),this.controller.levelView.playItemDropAnimation(this.position,t,function(){if(e.succeeded(),i.controller.levelModel.usePlayer){var t=i.controller.levelModel.player.queue.currentCommand;t&&t.waitForOtherQueue&&t.succeeded()}})}},{key:"attack",value:function(e){var t=this;this.controller.addCommandRecord("attack",this.type,e.repeat);var i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.getAnimationManager(),"attack"+i),setTimeout(function(i){var o=i.controller.levelEntity.getEntityAt(i.controller.levelModel.getMoveForwardPosition(i));if(o){var n=new l(i.controller,function(){},function(){o.takeDamage(n)},o);o.addCommand(n)}setTimeout(function(t,i,n){null!==i&&(o.queue.startPushHighPriorityCommands(),t.events.forEach(function(e){return e({eventType:s.WhenAttacked,targetType:i.type,eventSenderIdentifier:n.identifier,targetIdentifier:i.identifier})}),o.queue.endPushHighPriorityCommands()),e.succeeded()},300/t.controller.tweenTimeScale,i.controller,o,i)},200/this.controller.tweenTimeScale,this)}},{key:"pushBack",value:function(e,t,i,o){var n=this,a=this.controller.levelModel,s=r.forward(this.position,t);if(a.isPositionEmpty(s)[0]){this.updateHidingBlock(this.position),this.position=s,this.updateHidingTree();var l=this.controller.levelView.addResettableTween(this.sprite).to({x:this.offset[0]+40*this.position[0],y:this.offset[1]+40*this.position[1]},i,Phaser.Easing.Linear.None);l.onComplete.add(function(){setTimeout(function(){e.succeeded(),void 0!==o&&o(n)},i/n.controller.tweenTimeScale)}),l.start()}else e.succeeded(),void 0!==o&&o(this)}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,o=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.getAnimationManager(),"hurt"+o),setTimeout(function(){t.healthPoint--,e.succeeded()},1500/this.controller.tweenTimeScale)):(this.healthPoint--,this.getAnimationManager().stop(null,!0),this.controller.levelView.playScaledSpeed(this.getAnimationManager(),"die"+o),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},300,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start()},1500/this.controller.tweenTimeScale))}},{key:"playRandomIdle",value:function(e){var t,i="";switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(5*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown"}i+=t,this.controller.levelView.playScaledSpeed(this.getAnimationManager(),i)}},{key:"updateAnimationDirection",value:function(){var e=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.getAnimationManager(),"idle"+e)}},{key:"getDistance",value:function(e){return r.absoluteDistanceSquare(this.position,e.position)}},{key:"blowUp",value:function(e,t){var i=a.South;t[0]>this.position[0]?(i=a.West,this.facing=a.East,this.updateAnimationDirection()):t[0]<this.position[0]?(i=a.East,this.facing=a.West,this.updateAnimationDirection()):t[1]>this.position[1]?(i=a.North,this.facing=a.South,this.updateAnimationDirection()):t[1]<this.position[1]&&(i=a.South,this.facing=a.North,this.updateAnimationDirection()),this.pushBack(e,i,150,function(t){var i=new l(t.controller,function(){},function(){t.controller.destroyEntity(i,t.identifier)},t.identifier);t.queue.startPushHighPriorityCommands(),t.addCommand(i,e.repeat),t.queue.endPushHighPriorityCommands()})}},{key:"hasPermissionToWalk",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(e.isWalkable||void 0!==t&&t.isOnBlock&&!e.isEmpty)&&(void 0===t||t.canMoveThrough())&&"water"!==i.blockType&&"lava"!==i.blockType}},{key:"handleMoveOffPressurePlate",value:function(e){var t=this,i=r.add(this.position,e),o="pressurePlateDown"===this.controller.levelModel.actionPlane.getBlockAt(i).blockType,n=this.controller.levelModel.actionPlane.getBlockAt(this.position),a=!1;if(void 0!==n&&n.isWalkable||(a=!0),this.controller.levelEntity.entityMap.forEach(function(e){e.identifier!==t.identifier&&e.canTriggerPressurePlates()&&t.controller.positionEquivalence(e.position,i)&&(a=!0)}),o&&!a){this.controller.audioPlayer.play("pressurePlateClick");var s=new c("pressurePlateUp");this.controller.levelModel.actionPlane.setBlockAt(i,s,e[0],e[1])}}},{key:"handleMoveOnPressurePlate",value:function(e){var t=r.add(this.position,e);if("pressurePlateUp"===this.controller.levelModel.actionPlane.getBlockAt(t).blockType){this.controller.audioPlayer.play("pressurePlateClick");var i=new c("pressurePlateDown");return this.controller.levelModel.actionPlane.setBlockAt(t,i),!0}return!1}},{key:"handleMoveOffIronDoor",value:function(e){var t=r.add(this.position,e);if(this.controller.levelModel.inBounds(t)){var i="doorIron"===this.controller.levelModel.actionPlane.getBlockAt(t).blockType,o="doorIron"===this.controller.levelModel.actionPlane.getBlockAt(this.position).blockType;i&&!o&&this.controller.levelModel.actionPlane.findDoorToAnimate(new r(-1,-1))}}},{key:"handleMoveAwayFromPiston",value:function(e){var t=this,i=r.add(this.position,e);r.getOrthogonalPositions(i).forEach(function(e){if(t.controller.levelModel.actionPlane.inBounds(e)){var i=t.controller.levelModel.actionPlane.getBlockAt(e);i.blockType.startsWith("piston")&&i.isPowered&&t.controller.levelModel.actionPlane.activatePiston(e)}})}},{key:"handleGetOnRails",value:function(e){this.getOffTrack=!1,this.handleMoveOffPressurePlate(new r(0,0)),this.controller.levelView.playTrack(this.position,e,!0,this,null)}}]),e}()},function(e,t,i){"use strict";var o=Object.freeze({North:0,East:1,South:2,West:3,opposite:function(e){switch(e){case o.North:return o.South;case o.South:return o.North;case o.East:return o.West;case o.West:return o.East}},left:function(e){return this.turn(e,"left")},right:function(e){return this.turn(e,"right")},turnDirection:function(e,t){switch(e){case o.North:return t===o.East?"right":"left";case o.South:return t===o.West?"right":"left";case o.East:return t===o.South?"right":"left";case o.West:return t===o.North?"right":"left"}},turn:function(e,t){return(e+4+("right"===t?1:-1))%4},directionToOffset:function(e){switch(e){case o.North:return[0,-1];case o.South:return[0,1];case o.East:return[1,0];case o.West:return[-1,0]}},directionToRelative:function(e){switch(e){case o.North:return"Up";case o.South:return"Down";case o.East:return"Right";case o.West:return"Left"}}});e.exports=o},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(9);e.exports=function(){function e(t,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.GameController=t,this.Game=t.game,this.HighlightCallback=i,this.state=n.NOT_STARTED,this.target=o,this.onFinish=a,this.repeat=!1}return o(e,[{key:"tick",value:function(){}},{key:"begin",value:function(){this.HighlightCallback&&this.HighlightCallback(),this.state=n.WORKING}},{key:"isStarted",value:function(){return this.state!==n.NOT_STARTED}},{key:"isFinished",value:function(){return this.isSucceeded()||this.isFailed()}},{key:"isSucceeded",value:function(){return this.state===n.SUCCESS}},{key:"isFailed",value:function(){return this.state===n.FAILURE}},{key:"succeeded",value:function(){this.state=n.SUCCESS}},{key:"failed",value:function(){this.state=n.FAILURE}}]),e}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(1),a=[n.North,n.East,n.South,n.West];e.exports=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i,this[0]=t,this[1]=i}return o(e,null,[{key:"add",value:function(t,i){return new e(t[0]+i[0],t[1]+i[1])}},{key:"subtract",value:function(t,i){return new e(t[0]-i[0],t[1]-i[1])}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"directionToOffsetPosition",value:function(t){var i=n.directionToOffset(t);if(i)return e.fromArray(i)}},{key:"isAdjacent",value:function(t,i){return a.map(e.directionToOffsetPosition).some(function(o){return e.equals(e.add(t,o),i)})}},{key:"forward",value:function(t,i){return e.add(t,e.directionToOffsetPosition(i))}},{key:"north",value:function(t){return e.forward(t,n.North)}},{key:"east",value:function(t){return e.forward(t,n.East)}},{key:"south",value:function(t){return e.forward(t,n.South)}},{key:"west",value:function(t){return e.forward(t,n.West)}},{key:"getOrthogonalPositions",value:function(t){return a.map(function(i){return e.forward(t,i)})}},{key:"manhattanDistance",value:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}},{key:"absoluteDistanceSquare",value:function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}},{key:"getSurroundingPositions",value:function(t){return e.getOrthogonalPositions(t).concat([e.north(e.east(t)),e.north(e.west(t)),e.south(e.east(t)),e.south(e.west(t))])}},{key:"fromArray",value:function(t){return new e(t[0],t[1])}}]),e}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,a));return r.actionCallback=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.actionCallback()}}]),t}()},function(e,t,i){"use strict";e.exports=Object.freeze({WhenTouched:0,WhenUsed:1,WhenSpawned:2,WhenAttacked:3,WhenNight:4,WhenDay:5,WhenNightGlobal:6,WhenDayGlobal:7,WhenRun:8})},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(1),a=n.North,r=n.South,s=n.East,l=n.West;e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blockType=t,this.isEntity=!1,this.isWalkable=!1,this.isPlacable=!1,this.isDestroyable=!0,this.isUsable=!0,this.isEmpty=!1,this.isEmissive=!1,this.isTransparent=!1,this.isRedstone=!1,this.isPowered=!1,this.isConnectedToRedstone=!1,this.isRedstoneBattery=!1,this.isOpen=!1,this.isRail=!1,this.isSolid=!0,this.isWeaklyPowerable=!0,this.isStickable=!0,this.isActivatedConduit=!1,""===t&&(this.isWalkable=!0,this.isDestroyable=!1,this.isEmpty=!0,this.isPlacable=!0,this.isUsable=!1,this.isWeaklyPowerable=!1),this.getIsMiniblock()&&(this.isEntity=!0,this.isWalkable=!0,this.isDestroyable=!1,this.isPlacable=!0,this.isUsable=!1,this.isTransparent=!0),t.match("torch")&&(this.isWalkable=!0,this.isPlacable=!0,this.isStickable=!1),"rails"===t.substring(0,5)&&(this.isWeaklyPowerable="railsRedstoneTorch"===t,this.isStickable="railsRedstoneTorch"!==t,this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!0,this.isTransparent=!0,this.isRail="railsRedstoneTorch"!==t,this.isConnectedToRedstone=/^rails(RedstoneTorch|Unpowered|Powered)/.test(t),this.isRedstoneBattery="railsRedstoneTorch"===t,this.connectionA=void 0,this.connectionB=void 0),"sheep"===t&&(this.isEntity=!0,this.isDestroyable=!1,this.isUsable=!0),"invisible"===t&&(this.isDestroyable=!1,this.isUsable=!1,this.isWeaklyPowerable=!1,this.isEmissive=!0),t.startsWith("glass")&&(this.isSolid=!1),t.startsWith("ice")&&(this.isSolid=!1),"creeper"===t&&(this.isEntity=!0),"bedrock"===t&&(this.isDestroyable=!1),"lava"===t&&(this.isEmissive=!0,this.isWalkable=!0,this.isPlacable=!0),"magmaUnderwater"!==t&&"magmaDeep"!==t||(this.isEmissive=!0),"bubbleColumn"===t&&(this.isSolid=!1,this.isTransparent=!0,this.isEntity=!0),"conduit"===t&&(this.isSolid=!1,this.isEntity=!0),"water"===t&&(this.isPlacable=!0),"torch"===t&&(this.isEmissive=!0,this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0),"cropWheat"===t&&(this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0),"tnt"===t&&(this.isUsable=!0,this.isDestroyable=!0),"door"===t&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isEntity=!0,this.isWalkable=!1,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0,this.isStickable=!1),"doorIron"===t&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isEntity=!0,this.isWalkable=!1,this.isDestroyable=!1,this.isTransparent=!0,this.isConnectedToRedstone=!0,this.isStickable=!1),t.startsWith("redstoneWire")&&(this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!0,this.isTransparent=!0,this.isRedstone=!0,this.isStickable=!1),t.startsWith("pressurePlate")&&(this.isWeaklyPowerable="pressurePlateUp"!==t,this.isEntity=!0,this.isWalkable=!0,this.isDestroyable=!1,this.isTransparent=!0,this.isConnectedToRedstone=!0,this.isRedstoneBattery="pressurePlateUp"!==t,this.isStickable=!1),"glowstone"===t&&(this.isEntity=!0),"bedFoot"!==t&&"bedHead"!==t||(this.isEntity=!0),t.startsWith("piston")&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isDestroyable=!1,this.isConnectedToRedstone=!t.startsWith("pistonArm"),("On"===t.substring(t.length-2,t.length)||t.startsWith("pistonArm")||"OnSticky"===t.substring(t.length-8,t.length))&&(this.isEntity=!0)),(t.startsWith("flower")||/coral/i.test(t)&&!/Block/.test(t)||"seaGrass"===t||"kelp"===t||"seaPickles"===t)&&(this.isWalkable=!0,this.isEntity=!0),"seaPickles"!==t&&"seaLantern"!==t&&"magmaBlock"!==t||(this.isEmissive=!0)}return o(e,[{key:"isFlat",value:function(){return this.isRail||this.isRedstone||this.blockType.startsWith("pressurePlate")}},{key:"notValidOnGroundPlane",value:function(){return this.blockType.startsWith("rails")||this.blockType.startsWith("redstone")}},{key:"skipsDestructionOverlay",value:function(){return this.isRedstone||"torch"===this.blockType||"railsRedstoneTorch"===this.blockType}},{key:"shouldRenderOnGroundPlane",value:function(){return this.isFlat()}},{key:"getIsPowerableRail",value:function(){return this.isRail&&this.isConnectedToRedstone}},{key:"getIsHorizontal",value:function(){return this.blockType.match("East|West")}},{key:"getIsVertical",value:function(){return this.blockType.match("North|South")}},{key:"getIsStickyPiston",value:function(){return"Sticky"===this.blockType.substring(this.blockType.length-6,this.blockType.length)}},{key:"canHoldCharge",value:function(){return this.isSolid}},{key:"getIsMiniblock",value:function(){return e.isMiniblock(this.blockType)}},{key:"getIsChestblock",value:function(){return e.isChestblock(this.blockType)}},{key:"getIsTree",value:function(){return!!this.blockType.match(/^tree/)}},{key:"getIsDoor",value:function(){return this.blockType.startsWith("door")}},{key:"getIsConduit",value:function(){return this.blockType.startsWith("conduit")}},{key:"getIsLiquid",value:function(){return"water"===this.blockType||"magmaUnderwater"===this.blockType||"lava"===this.blockType}},{key:"getCanFall",value:function(){return"sand"===this.blockType||"gravel"===this.blockType}},{key:"getIsPlaceableInLiquid",value:function(){return!(this.isRedstone||this.getIsPiston()||this.isRail||"torch"===this.blockType||"railsRedstoneTorch"===this.blockType||"pressurePlateUp"===this.blockType)}},{key:"getIsPiston",value:function(){return this.blockType.startsWith("piston")}},{key:"getIsPistonArm",value:function(){return this.blockType.startsWith("pistonArm")}},{key:"getIsPushable",value:function(){return""!==this.blockType&&!this.isDestroyableUponPush()}},{key:"isDestroyableUponPush",value:function(){return this.blockType.startsWith("redstone")||this.blockType.startsWith("door")||this.blockType.startsWith("railsRedstone")||this.blockType.startsWith("pressure")}},{key:"needToRefreshRedstone",value:function(){return!!(this.isRedstone||""===this.blockType||this.isConnectedToRedstone&&!this.blockType.startsWith("piston"))}},{key:"getPistonDirection",value:function(){if(this.blockType.startsWith("piston"))switch(this.blockType.substring(6,7)){case"D":return r;case"U":return a;case"L":return l;case"R":return s}}},{key:"getIsEmptyOrEntity",value:function(){return this.isEmpty||this.isEntity}}],[{key:"getCanFall",value:function(t){return new e(t).getCanFall()}},{key:"getIsPlaceableInLiquid",value:function(t){return new e(t).getIsPlaceableInLiquid()}},{key:"isWalkable",value:function(t){return new e(t).isWalkable}},{key:"isMiniblock",value:function(e){return e.endsWith("Miniblock")}},{key:"isChestblock",value:function(e){return e.endsWith("Chest")}},{key:"isFlat",value:function(t){return new e(t).isFlat()}},{key:"skipsDestructionOverlay",value:function(t){return new e(t).skipsDestructionOverlay()}},{key:"notValidOnGroundPlane",value:function(t){return new e(t).notValidOnGroundPlane()}},{key:"getMiniblockFrame",value:function(t){if("railsRedstoneTorch"===t)return"redstoneTorch";if(t.startsWith("rails"))return"railNormal";if(t.endsWith("Chest"))return"chest";if(!t.startsWith("glass")&&!t.startsWith("ice")){if("redstoneWire"===t.substring(0,12))return"redstoneDust";if(e.isMiniblock(t))return t.replace("Miniblock","");var i=t;switch(i){case"treeAcacia":case"treeBirch":case"treeJungle":case"treeOak":case"treeSpruce":case"treeSpruceSnowy":i="log"+i.substring(4);break;case"stone":i="cobblestone";break;case"oreCoal":i="coal";break;case"oreDiamond":i="diamond";break;case"oreIron":i="ingotIron";break;case"oreLapis":i="lapisLazuli";break;case"oreGold":i="ingotGold";break;case"oreEmerald":i="emerald";break;case"oreRedstone":i="redstoneDust";break;case"grass":i="dirt";break;case"tnt":i="gunPowder"}return i}}}]),e}()},function(e,t,i){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=i(1);e.exports.convertActionPlaneEntitiesToConfig=function(t){var i=t.gridWidth&&t.gridHeight?[t.gridWidth,t.gridHeight]:[10,10],n=o(i,2),a=n[0],r=n[1];[t.actionPlane].forEach(function(i){for(var o=0;o<i.length;o++){var n=o%a,s=Math.floor(o/r),l=e.exports.convertNameToEntity(i[o],n,s);l&&(t.entities=t.entities||[],t.entities.push(l),i[o]="")}})},e.exports.randomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e};var a={Up:n.North,Down:n.South,Left:n.West,Right:n.East};e.exports.convertNameToEntity=function(e,t,i){if(e.match(/^(sheep|zombie|ironGolem|creeper|cod|cow|chicken|dolphin|ghast|boat|salmon|squid|tropicalFish|seaTurtle)(Right|Left|Up|Down|$)/)){var o=e.match(/(.*)(Right|Left|Up|Down)/),r=o?a[o[2]]:n.East;return[o?o[1]:e,t,i,r]}}},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(9);e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameController=t,this.game=t.game,this.reset(),this.repeatCommands=[],this.setUnshiftState=!1,this.highPriorityCommands=[]}return o(e,[{key:"addCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.repeat=t,this.whileCommandQueue?this.whileCommandQueue.addCommand(e):this.setUnshiftState?this.highPriorityCommands.push(e):this.commandList_.push(e)}},{key:"setWhileCommandInsertState",value:function(e){this.whileCommandQueue=e}},{key:"begin",value:function(){this.state=n.WORKING}},{key:"reset",value:function(){this.state=n.NOT_STARTED,this.currentCommand=null,this.commandList_=[],this.highPriorityCommands=[],this.whileCommandQueue&&this.whileCommandQueue.reset(),this.repeatCommands=[],this.whileCommandQueue=null}},{key:"startPushHighPriorityCommands",value:function(){this.setUnshiftState=!0,this.highPriorityCommands=[]}},{key:"endPushHighPriorityCommands",value:function(){for(var e=this.highPriorityCommands.length-1;e>=0;e--)this.commandList_.unshift(this.highPriorityCommands[e]);this.setUnshiftState=!1}},{key:"tick",value:function(){if(this.state===n.WORKING){if(!this.currentCommand){if(0===this.commandList_.length){0===this.repeatCommands.length&&(this.state=n.SUCCESS),this.gameController.startPushRepeatCommand();for(var e=0;e<this.repeatCommands.length;e++)this.repeatCommands[e][1]>0?(this.repeatCommands[e][0](),this.repeatCommands[e][1]--):-1===this.repeatCommands[e][1]?this.repeatCommands[e][0]():this.repeatCommands.splice(e,1);return void this.gameController.endPushRepeatCommand()}this.currentCommand=this.commandList_.shift()}this.currentCommand.isStarted()?this.currentCommand.tick():this.currentCommand.begin(),this.currentCommand.isSucceeded()?(this.currentCommand.onFinish&&this.currentCommand.onFinish(),this.currentCommand=null):this.currentCommand.isFailed()&&(this.state=n.FAILURE)}}},{key:"getLength",value:function(){return this.commandList_?this.commandList_.length:0}},{key:"isStarted",value:function(){return this.state!==n.NOT_STARTED}},{key:"isFinished",value:function(){return this.isSucceeded()||this.isFailed()}},{key:"isSucceeded",value:function(){return this.state===n.SUCCESS}},{key:"isFailed",value:function(){return this.state===n.FAILURE}},{key:"addRepeatCommands",value:function(e,t){if(-1===t)for(var i=0;i<this.repeatCommands.length;i++)if(-1===this.repeatCommands[i][1]){this.repeatCommands.splice(i,1);break}this.repeatCommands.push([e,t]),this.begin()}}]),e}()},function(e,t,i){"use strict";e.exports=Object.freeze({NOT_STARTED:0,WORKING:1,SUCCESS:2,FAILURE:3})},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-22,-28],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){switch(this.facing){case a.North:return"Boat_05";case a.South:return"Boat_01";case a.East:return"Boat_07";case a.West:return"Boat_03"}}},{key:"prepareSprite",value:function(){var e=this.controller.levelView.actionGroup,i=this.getFrameForDirection();this.sprite=e.create(0,0,"player"+this.controller.player.name,i),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y,t.addBobTween(this.game,this.sprite)}}],[{key:"addBobTween",value:function(e,t){return e.add.tween(t).to({y:"3"},1e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)}}]),t}()},function(e,t,i){"use strict";var o=i(12),n=i(1),a=i(5),r=i(7);e.exports={GameController:o,FacingDirection:n,EventType:a,utils:r}},function(e,t,i){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var r=i(8),s=i(4),l=i(5),c=i(1),h=i(3),u=i(13),d=i(18),p=i(20),f=i(34),y=i(7).convertNameToEntity,m=i(35),v=400,g=400,k=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DEBUG=t.debug,window.PhaserGlobal={disableAudio:!0,disableWebAudio:!0,hideBanner:!this.DEBUG},this.codeOrgAPI=m.get(this);var o=t.Phaser;this.game=new o.Game({forceSetTimeOut:t.forceSetTimeOut,width:v,height:g,renderer:o.AUTO,parent:t.containerId,state:"earlyLoad",preserveDrawingBuffer:!0}),this.specialLevelType=null,this.queue=new r(this),this.OnCompleteCallback=null,this.assetRoot=t.assetRoot,this.audioPlayer=t.audioPlayer,this.afterAssetsLoaded=t.afterAssetsLoaded,this.assetLoader=new f(this),this.earlyLoadAssetPacks=t.earlyLoadAssetPacks||[],this.earlyLoadNiceToHaveAssetPacks=t.earlyLoadNiceToHaveAssetPacks||[],this.resettableTimers=[],this.timeouts=[],this.timeout=0,this.initializeCommandRecord(),this.score=0,this.useScore=!1,this.scoreText=null,this.onScoreUpdate=t.onScoreUpdate,this.events=[],this.assumedSlowMotion=1.5,this.initialSlowMotion=t.customSlowMotion||this.assumedSlowMotion,this.tweenTimeScale=1.5/this.initialSlowMotion,this.playerDelayFactor=1,this.dayNightCycle=!1,this.player=null,this.agent=null,this.timerSprite=null,this.game.state.add("earlyLoad",{preload:function(){i.game.load.resetLocked=!0,i.assetLoader.loadPacks(i.earlyLoadAssetPacks)},create:function(){i.assetLoader.loadPacks(i.earlyLoadNiceToHaveAssetPacks),i.game.load.start()}}),this.game.state.add("levelRunner",{preload:this.preload.bind(this),create:this.create.bind(this),update:this.update.bind(this),render:this.render.bind(this)})}return n(e,[{key:"getIsDirectPlayerControl",value:function(){return this.levelData.isEventLevel||this.levelData.isAgentLevel}},{key:"loadLevel",value:function(e){this.levelData=Object.freeze(e),this.levelEntity=new p(this),this.levelModel=new u(this.levelData,this),this.levelView=new d(this),this.specialLevelType=e.specialLevelType,this.timeout=e.levelVerificationTimeout,void 0!==e.useScore&&(this.useScore=e.useScore),this.timeoutResult=e.timeoutResult,this.onDayCallback=e.onDayCallback,this.onNightCallback=e.onNightCallback,this.game.state.start("levelRunner")}},{key:"reset",value:function(){var e=this;this.dayNightCycle=!1,this.queue.reset(),this.levelEntity.reset(),this.levelModel.reset(),this.levelView.reset(this.levelModel),this.levelEntity.loadData(this.levelData),this.player=this.levelModel.player,this.agent=this.levelModel.agent,this.resettableTimers.forEach(function(e){e.stop(!0)}),this.timeouts.forEach(function(e){clearTimeout(e)}),this.timerSprite&&this.timerSprite.kill(),this.timerSprite=null,this.timeouts=[],this.resettableTimers.length=0,this.events.length=0,this.score=0,this.useScore&&this.updateScore(),this.getIsDirectPlayerControl()||this.events.push(function(t){t.eventType===l.WhenUsed&&"sheep"===t.targetType&&e.codeOrgAPI.drop(null,"wool",t.targetIdentifier),t.eventType===l.WhenTouched&&"creeper"===t.targetType&&(e.codeOrgAPI.flashEntity(null,t.targetIdentifier),e.codeOrgAPI.explodeEntity(null,t.targetIdentifier))}),this.initializeCommandRecord()}},{key:"preload",value:function(){this.game.load.resetLocked=!0,this.game.time.advancedTiming=this.DEBUG,this.game.stage.disableVisibilityChange=!0,this.assetLoader.loadPacks(this.levelData.assetPacks.beforeLoad)}},{key:"create",value:function(){var e=this;this.levelView.create(this.levelModel),this.game.time.slowMotion=this.initialSlowMotion,this.addCheatKeys(),this.assetLoader.loadPacks(this.levelData.assetPacks.afterLoad),this.game.load.image("timer",this.assetRoot+"images/placeholderTimer.png"),this.game.load.onLoadComplete.addOnce(function(){e.afterAssetsLoaded&&e.afterAssetsLoaded()}),this.levelEntity.loadData(this.levelData),this.game.load.start()}},{key:"run",value:function(){var e=this;this.events.forEach(function(e){return e({eventType:l.WhenRun,targetIdentifier:void 0})});var t=!0,i=!1,o=void 0;try{for(var n,a=this.levelEntity.entityMap[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var r=n.value[1];this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:r.type,targetIdentifier:r.identifier})}),r.queue.begin()}}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}if(!isNaN(this.timeout)&&this.timeout>0){this.timerSprite=this.game.add.sprite(-50,390,"timer");var s=this.levelView.addResettableTween(this.timerSprite).to({x:-450,alpha:.5},this.timeout,Phaser.Easing.Linear.None);s.onComplete.add(function(){e.endLevel(e.timeoutResult(e.levelModel))}),s.start()}}},{key:"followingPlayer",value:function(){return!!this.levelData.gridDimensions&&!this.checkMinecartLevelEndAnimation()}},{key:"update",value:function(){this.queue.tick(),this.levelEntity.tick(),this.levelModel.usePlayer&&this.player.updateMovement(),this.levelModel.usingAgent&&this.agent.updateMovement(),this.levelView.update(),(this.getIsDirectPlayerControl()||this.player.queue.state>1)&&this.checkSolution()}},{key:"addCheatKeys",value:function(){var e,t=this;if(this.levelModel.usePlayer){var i=(a(e={},Phaser.Keyboard.UP,c.North),a(e,Phaser.Keyboard.W,c.North),a(e,Phaser.Keyboard.RIGHT,c.East),a(e,Phaser.Keyboard.D,c.East),a(e,Phaser.Keyboard.DOWN,c.South),a(e,Phaser.Keyboard.S,c.South),a(e,Phaser.Keyboard.LEFT,c.West),a(e,Phaser.Keyboard.A,c.West),a(e,Phaser.Keyboard.SPACEBAR,-2),e),o=function(){return null!==document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)};Object.keys(i).forEach(function(e){var n=i[e];t.game.input.keyboard.addKey(e).onDown.add(function(){o()||(t.player.movementState=n,t.player.updateMovement())}),t.game.input.keyboard.addKey(e).onUp.add(function(){o()||(t.player.movementState===n&&(t.player.movementState=-1),t.player.updateMovement())}),t.game.input.keyboard.removeKeyCapture(e)})}}},{key:"handleEndState",value:function(e){this.OnCompleteCallback&&(this.OnCompleteCallback(e,this.levelModel),this.OnCompleteCallback=null)}},{key:"render",value:function(){this.DEBUG&&this.game.debug.text(this.game.time.fps||"--",2,14,"#00ff00"),this.levelView.render()}},{key:"scaleFromOriginal",value:function(){var e=this.levelData.gridDimensions||[10,10],t=o(e,2);return[t[0]/10,t[1]/10]}},{key:"getScreenshot",value:function(){return this.game.canvas.toDataURL("image/png")}},{key:"initializeCommandRecord",value:function(){var e=["moveAway","moveToward","moveForward","turn","turnRandom","explode","wait","flash","drop","spawn","destroy","playSound","attack","addScore"];this.commandRecord=new Map,this.repeatCommandRecord=new Map,this.isRepeat=!1;for(var t=0;t<e.length;t++)this.commandRecord.set(e[t],new Map),this.commandRecord.get(e[t]).set("count",0),this.repeatCommandRecord.set(e[t],new Map),this.repeatCommandRecord.get(e[t]).set("count",0)}},{key:"startPushRepeatCommand",value:function(){this.isRepeat=!0}},{key:"endPushRepeatCommand",value:function(){this.isRepeat=!1}},{key:"addCommandRecord",value:function(e,t,i){var o=i?this.repeatCommandRecord:this.commandRecord;if(o.has(e)){var n=o.get(e);if(n.set("count",n.get("count")+1),n.has(t)?n.set(t,n.get(t)+1):n.set(t,1),this.DEBUG){var a=i?"Repeat ":"Command :";console.log(a+e+" executed in mob type : "+t+" updated count : "+n.get(t))}}}},{key:"getCommandCount",value:function(e,t,i){var o=i?this.repeatCommandRecord:this.commandRecord;if(o.has(e)){var n=o.get(e);return void 0===t?n.get("count"):n.has(t)?n.get(t):0}return 0}},{key:"getEntity",value:function(e){void 0===e&&(e="Player");var t=this.levelEntity.entityMap.get(e);return void 0===t&&console.log("Debug GetEntity: there is no entity : "+e+"\n"),t}},{key:"getEntities",value:function(e){return this.levelEntity.getEntitiesOfType(e)}},{key:"isType",value:function(e){return"string"==typeof e&&"Player"!==e&&"PlayerAgent"!==e}},{key:"printErrorMsg",value:function(e){this.DEBUG&&this.game.debug.text(e)}},{key:"moveAway",value:function(e,t){var i=this,o=e.target;if(void 0===o){var n=this.levelEntity.entityMap,a=function(){var o=d[1],n=new s(i,function(){},function(){i.moveAway(n,t)},o.identifier);o.addCommand(n,e.repeat)},r=!0,l=!1,c=void 0;try{for(var h,u=n[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var d=h.value;a()}}catch(e){l=!0,c=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw c}}e.succeeded()}else{var p=this.isType(o),f=this.isType(t);if(o===t)return this.printErrorMsg("Debug MoveAway: Can't move away entity from itself\n"),void e.succeeded();if(p||f)if(p&&!f){var y=this.getEntities(o),m=this.getEntity(t);if(void 0!==m)for(var v=function(){if(y[g].identifier===m.identifier)return"continue";var o=new s(i,function(){},function(){i.moveAway(o,t)},y[g].identifier);y[g].addCommand(o,e.repeat)},g=0;g<y.length;g++)v();e.succeeded()}else if(!p&&f){var k=this.getEntity(o),b=this.getEntities(t);if(b.length>0){for(var w=[Number.MAX_VALUE,-1],P=0;P<b.length;P++)if(k.identifier!==b[P].identifier){var _=k.getDistance(b[P]);_<w[0]&&(w=[_,P])}-1!==w[1]&&k.moveAway(e,b[w[1]])}else e.succeeded()}else!function(){var n=i.getEntities(o),a=i.getEntities(t);if(a.length>0&&n.length>0){for(var r=function(t){for(var o=n[t],r=[Number.MAX_VALUE,-1],l=0;l<a.length;l++)if(a[t].identifier!==o.identifier){var c=o.getDistance(a[l]);c<r[0]&&(r=[c,l])}if(-1!==r){var h=new s(i,function(){},function(){i.moveAway(h,a[r[1]].identifier)},o.identifier);o.addCommand(h,e.repeat)}else e.succeeded()},l=0;l<n.length;l++)r(l);e.succeeded()}}();else{var S=this.getEntity(o),A=this.getEntity(t);if(S===A)return void e.succeeded();S.moveAway(e,A)}}}},{key:"moveToward",value:function(e,t){var i=this,o=e.target;if(void 0===o){var n=this.levelEntity.entityMap,a=function(){var o=d[1],n=new s(i,function(){},function(){i.moveToward(n,t)},o.identifier);o.addCommand(n,e.repeat)},r=!0,l=!1,c=void 0;try{for(var h,u=n[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var d=h.value;a()}}catch(e){l=!0,c=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw c}}e.succeeded()}else{var p=this.isType(o),f=this.isType(t);if(o===t)return void e.succeeded();if(p||f)if(p&&!f){var y=this.getEntities(o),m=this.getEntity(t);if(void 0!==m){for(var v=function(o){if(y[o].identifier===m.identifier)return"continue";var n=new s(i,function(){},function(){i.moveToward(n,t)},y[o].identifier);y[o].addCommand(n,e.repeat)},g=0;g<y.length;g++)v(g);e.succeeded()}}else if(!p&&f){var k=this.getEntity(o),b=this.getEntities(t);if(b.length>0){var w=[Number.MAX_VALUE,-1];for(g=0;g<b.length;g++)if(b[g].identifier!==k.identifier){var P=k.getDistance(b[g]);P<w[0]&&(w=[P,g])}-1!==w[1]?k.moveToward(e,b[w[1]]):e.succeeded()}else e.succeeded()}else!function(){var n=i.getEntities(o),a=i.getEntities(t);if(a.length>0&&n.length>0){for(var r=function(t){for(var o=n[t],r=[Number.MAX_VALUE,-1],l=0;l<a.length;l++)if(a[t].identifier!==o.identifier){var c=o.getDistance(a[l]);c<r[0]&&(r=[c,l])}if(-1!==r[1]){var h=new s(i,function(){},function(){i.moveToward(h,a[r[1]].identifier)},o.identifier);o.addCommand(h,e.repeat)}},l=0;l<n.length;l++)r(l);e.succeeded()}}();else{var _=this.getEntity(o),S=this.getEntity(t);_.moveToward(e,S)}}}},{key:"positionEquivalence",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"execute",value:function(e,t){for(var i=arguments.length,o=Array(i>2?i-2:0),n=2;n<i;n++)o[n-2]=arguments[n];var a=this,r=e.target;if(this.isType(r)){for(var l=this.getEntities(r),c=function(i){var n=new s(a,function(){},function(){a.execute.apply(a,[n,t].concat(o))},l[i].identifier);l[i].addCommand(n,e.repeat)},h=0;h<l.length;h++)c(h);e.succeeded()}else if(void 0===r){var u=this.levelEntity.entityMap,d=function(i){var n=i[1],r=new s(a,function(){},function(){a.execute.apply(a,[r,t].concat(o))},n.identifier);n.addCommand(r,e.repeat)},p=!0,f=!1,y=void 0;try{for(var m,v=u[Symbol.iterator]();!(p=(m=v.next()).done);p=!0){d(m.value)}}catch(e){f=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw y}}e.succeeded()}else{var g=this.getEntity(r);g[t].apply(g,[e].concat(o))}}},{key:"moveForward",value:function(e){this.execute(e,"moveForward")}},{key:"moveBackward",value:function(e){this.execute(e,"moveBackward")}},{key:"moveDirection",value:function(e,t){var i=this.levelModel.player;this.levelModel.shouldRide(t)?(i.handleGetOnRails(t),e.succeeded()):this.execute(e,"moveDirection",t)}},{key:"turn",value:function(e,t){this.execute(e,"turn",t)}},{key:"turnRandom",value:function(e){this.execute(e,"turnRandom")}},{key:"flashEntity",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var o=this.getEntities(i),n=function(i){var n=new s(t,function(){},function(){t.flashEntity(n)},o[i].identifier);o[i].addCommand(n,e.repeat)},a=0;a<o.length;a++)n(a);e.succeeded()}else if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var o=i[1],n=new s(t,function(){},function(){t.flashEntity(n)},o.identifier);o.addCommand(n,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i),y=this.levelView.flashSpriteToWhite(f.sprite);this.addCommandRecord("flash",f.type,e.repeat),this.delayBy(y,function(){e.succeeded()})}}},{key:"explodeEntity",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var o=this.getEntities(i),n=function(i){var n=new s(t,function(){},function(){t.explodeEntity(n)},o[i].identifier);o[i].addCommand(n,e.repeat)},a=0;a<o.length;a++)n(a);e.succeeded()}else{if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var o=i[1],n=new s(t,function(){},function(){t.explodeEntity(n)},o.identifier);o.addCommand(n,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i);this.levelView.playExplosionCloudAnimation(f.position),this.addCommandRecord("explode",f.type,e.repeat),this.levelView.audioPlayer.play("explode");var y=this.levelEntity.entityMap,m=!0,v=!1,g=void 0;try{for(var k,b=y[Symbol.iterator]();!(m=(k=b.next()).done);m=!0)for(var w=k.value[1],P=-1;P<=1;P++)for(var _=-1;_<=1;_++)if(0!==P||0!==_){var S=[f.position[0]+P,f.position[1]+_];this.destroyBlockWithoutPlayerInteraction(S),w.position[0]===f.position[0]+P&&w.position[1]===f.position[1]+_&&w.blowUp(e,f.position)}}catch(e){v=!0,g=e}finally{try{!m&&b.return&&b.return()}finally{if(v)throw g}}var A=new s(this,function(){},function(){t.destroyEntity(A,f.identifier)},f.identifier);f.queue.startPushHighPriorityCommands(),f.addCommand(A,e.repeat),f.queue.endPushHighPriorityCommands()}e.succeeded(),this.updateFowPlane(),this.updateShadingPlane()}}},{key:"wait",value:function(e,t){var i=this,o=e.target;if(this.isType(o)){for(var n=this.getEntities(o),a=function(o){var a=new s(i,function(){},function(){i.wait(a,t)},n[o].identifier);n[o].addCommand(a,e.repeat)},r=0;r<n.length;r++)a(r);e.succeeded()}else{var l=this.getEntity(o);this.addCommandRecord("wait",l.type,e.repeat),setTimeout(function(){e.succeeded()},1e3*t/this.tweenTimeScale)}}},{key:"spawnEntity",value:function(e,t,i){this.addCommandRecord("spawn",t,e.repeat);var o=this.levelEntity.spawnEntity(t,i);null!==o&&this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:t,targetIdentifier:o.identifier})}),e.succeeded()}},{key:"spawnEntityAt",value:function(e,t,i,o,n){var a=this.levelEntity.spawnEntityAt(t,i,o,n);null!==a&&this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:t,targetIdentifier:a.identifier})}),e.succeeded()}},{key:"destroyEntity",value:function(e,t){var i=this;if(this.isType(t)){for(var o=this.getEntities(t),n=function(t){var n=o[t],a=new s(i,function(){},function(){i.destroyEntity(a,n.identifier)},n.identifier);n.addCommand(a,e.repeat)},a=0;a<o.length;a++)n(a);e.succeeded()}else if(void 0===t){var r=this.levelEntity.entityMap,l=function(t){var o=t[1],n=new s(i,function(){},function(){i.destroyEntity(n,o.identifier)},o.identifier);o.addCommand(n,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{this.addCommandRecord("destroy",this.type,e.repeat);var f=this.getEntity(t);void 0!==f?(f.healthPoint=1,f.takeDamage(e)):e.succeeded()}}},{key:"drop",value:function(e,t){var i=this,o=e.target;if(this.isType(o)){for(var n=this.getEntities(o),a=function(o){var a=new s(i,function(){},function(){i.drop(a,t)},n[o].identifier);n[o].addCommand(a,e.repeat)},r=0;r<n.length;r++)a(r);e.succeeded()}else if(void 0===o){var l=this.levelEntity.entityMap,c=function(o){var n=o[1],a=new s(i,function(){},function(){i.drop(a,t)},n.identifier);n.addCommand(a,e.repeat)},h=!0,u=!1,d=void 0;try{for(var p,f=l[Symbol.iterator]();!(h=(p=f.next()).done);h=!0){c(p.value)}}catch(e){u=!0,d=e}finally{try{!h&&f.return&&f.return()}finally{if(u)throw d}}e.succeeded()}else{this.getEntity(o).drop(e,t)}}},{key:"attack",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var o=this.getEntities(i),n=function(i){var n=new s(t,function(){},function(){t.attack(n)},o[i].identifier);o[i].addCommand(n,e.repeat)},a=0;a<o.length;a++)n(a);e.succeeded()}else if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var o=i[1],n=new s(t,function(){},function(){t.attack(n)},o.identifier);o.addCommand(n,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i);"Player"===f.identifier?(this.codeOrgAPI.destroyBlock(function(){},f.identifier),e.succeeded()):f.attack(e)}}},{key:"playSound",value:function(e,t){this.addCommandRecord("playSound",void 0,e.repeat),this.levelView.audioPlayer.play(t),e.succeeded()}},{key:"use",value:function(e){var t=this,i=this.levelModel.player,o=this.levelModel.getMoveForwardPosition(i),n=this.levelEntity.getEntityAt(o),a=this.levelModel.actionPlane.getBlockAt(o),r=void 0!==a&&"door"===a.blockType;null!==n&&n!==this.agent?(this.levelView.setSelectionIndicatorPosition(o[0],o[1]),this.levelView.onAnimationEnd(this.levelView.playPlayerAnimation("punch",i.position,i.facing,!1),function(){n.queue.startPushHighPriorityCommands();var o=new s(t,function(){},function(){n.use(o,i)},n.identifier);if(!t.levelEntity.isFriendlyEntity(n.type)){var a=i.facing,r=new s(t,function(){},function(){n.pushBack(r,a,150)},n.identifier);n.addCommand(r)}n.addCommand(o),n.queue.endPushHighPriorityCommands(),t.levelView.playPlayerAnimation("idle",i.position,i.facing,!1),t.getIsDirectPlayerControl()?t.delayPlayerMoveBy(0,0,function(){e.succeeded()}):e.waitForOtherQueue=!0,setTimeout(function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1])},0)})):r?(this.levelView.setSelectionIndicatorPosition(o[0],o[1]),this.levelView.onAnimationEnd(this.levelView.playPlayerAnimation("punch",i.position,i.facing,!1),function(){t.audioPlayer.play("doorOpen");var n=!a.isWalkable;t.levelView.playDoorAnimation(o,n,function(){a.isWalkable=!a.isWalkable,t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock),t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),e.succeeded()})})):a&&a.isRail?(this.levelView.playTrack(o,i.facing,!0,i,null),e.succeeded()):this.levelView.playPunchDestroyAirAnimation(i.position,i.facing,this.levelModel.getMoveForwardPosition(),function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock),t.delayPlayerMoveBy(0,0,function(){e.succeeded()})})}},{key:"destroyBlock",value:function(e){var t=this,i=this.getEntity(e.target);if(this.levelModel.canDestroyBlockForward(i)){var o=this.levelModel.actionPlane.getBlockAt(this.levelModel.getMoveForwardPosition(i));if(null!==o){var n=this.levelModel.getMoveForwardPosition(i),a=o.blockType;if(o.isDestroyable){switch(a){case"logAcacia":case"treeAcacia":a="planksAcacia";break;case"logBirch":case"treeBirch":a="planksBirch";break;case"logJungle":case"treeJungle":a="planksJungle";break;case"logOak":case"treeOak":a="planksOak";break;case"logSpruce":case"treeSpruce":a="planksSpruce"}this.levelView.playDestroyBlockAnimation(i.position,i.facing,n,a,i,function(){e.succeeded()})}else if(o.isUsable)switch(a){case"sheep":this.levelView.playShearSheepAnimation(i.position,i.facing,n,a,function(){e.succeeded()});break;default:e.succeeded()}else e.succeeded()}}else this.levelView.playPunchDestroyAirAnimation(i.position,i.facing,this.levelModel.getMoveForwardPosition(i),function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock,i),t.delayPlayerMoveBy(0,0,function(){e.succeeded()})},i)}},{key:"destroyBlockWithoutPlayerInteraction",value:function(e){if(this.levelModel.inBounds(e)){var t=this.levelModel.actionPlane.getBlockAt(e);if(null!==t&&void 0!==t){var i=e,o=t.blockType;if(t.isDestroyable){switch(o){case"logAcacia":case"treeAcacia":o="planksAcacia";break;case"logBirch":case"treeBirch":o="planksBirch";break;case"logJungle":case"treeJungle":o="planksJungle";break;case"logOak":case"treeOak":o="planksOak";break;case"logSpruce":case"treeSpruce":case"logSpruceSnowy":case"treeSpruceSnowy":o="planksSpruce"}this.levelView.destroyBlockWithoutPlayerInteraction(i),this.levelView.playExplosionAnimation(this.levelModel.player.position,this.levelModel.player.facing,e,o,function(){},!1),this.levelView.createMiniBlock(i[0],i[1],o),this.updateFowPlane(),this.updateShadingPlane()}else if(t.isUsable)switch(o){case"sheep":this.levelView.playShearAnimation(this.levelModel.player.position,this.levelModel.player.facing,e,o,function(){})}}this.levelModel.destroyBlock(e)}}},{key:"checkTntAnimation",value:function(){return"freeplay"===this.specialLevelType}},{key:"checkMinecartLevelEndAnimation",value:function(){return"minecart"===this.specialLevelType}},{key:"checkHouseBuiltEndAnimation",value:function(){return"houseBuild"===this.specialLevelType}},{key:"checkAgentSpawn",value:function(){return"agentSpawn"===this.specialLevelType}},{key:"placeBlock",value:function(e,t){var i=this,o=this.getEntity(e.target),n=o.position,a=this.levelModel.actionPlane.getBlockAt(n),r=a.blockType;if(this.levelModel.canPlaceBlock(o,a))if(""!==r&&this.levelModel.destroyBlock(n),"cropWheat"!==t||"farmlandWet"===this.levelModel.groundPlane.getBlockAt(o.position).blockType)this.levelModel.player.updateHidingBlock(o.position),this.checkMinecartLevelEndAnimation()&&"rail"===t&&(t=o.position[1]<7?"railsUnpoweredVertical":"rails"),this.levelView.playPlaceBlockAnimation(o.position,o.facing,t,r,o,function(){var a,r=y(t,n.x,n.y);r?(a=i.levelEntity).spawnEntityAt.apply(a,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(r)):(i.levelModel.placeBlock(t,o),i.updateFowPlane(),i.updateShadingPlane());i.delayBy(200,function(){i.levelView.playIdleAnimation(o.position,o.facing,!1,o)}),i.delayPlayerMoveBy(200,400,function(){e.succeeded()})});else var s=this.levelView.playPlayerAnimation("jumpUp",o.position,o.facing,!1,o).onLoop.add(function(){i.levelView.playIdleAnimation(o.position,o.facing,!1,o),s.detach(),i.delayBy(800,function(){return e.succeeded()})},this);else e.succeeded()}},{key:"setPlayerActionDelayByQueueLength",value:function(){if(this.levelModel.usePlayer){var e=this.levelModel.player.queue.getLength(),t=Math.min(Math.max(e-10,0),10);this.playerDelayFactor=1-t/10}}},{key:"delayBy",value:function(e,t){var i=this.game.time.create(!0);i.add(this.originalMsToScaled(e),t,this),i.start(),this.resettableTimers.push(i)}},{key:"delayPlayerMoveBy",value:function(e,t,i){this.delayBy(Math.max(e,t*this.playerDelayFactor),i)}},{key:"originalMsToScaled",value:function(e){return e/this.assumedSlowMotion*this.game.time.slowMotion}},{key:"originalFpsToScaled",value:function(e){return e*this.assumedSlowMotion/this.game.time.slowMotion}},{key:"placeBlockForward",value:function(e,t){this.placeBlockDirection(e,t,0)}},{key:"placeBlockDirection",value:function(e,t,i){var o,n,a=this,r=this.getEntity(e.target),s=function(){};this.levelModel.canPlaceBlockDirection(t,r,i)?(o=this.levelModel.getMoveDirectionPosition(r,i),n=this.levelModel.getPlaneToPlaceOn(o,r,t),this.levelModel.isBlockOfTypeOnPlane(o,"lava",n)&&(s=function(){return a.levelView.audioPlayer.play("fizz")}),this.levelView.playPlaceBlockInFrontAnimation(r,r.position,r.facing,o,function(){a.levelModel.placeBlockDirection(t,n,r,i),a.levelView.refreshGroundGroup(),a.updateFowPlane(),a.updateShadingPlane(),s(),a.delayBy(200,function(){a.levelView.playIdleAnimation(r.position,r.facing,!1,r)}),a.delayPlayerMoveBy(200,400,function(){e.succeeded()})})):this.levelView.playPunchAirAnimation(r.position,r.facing,r.position,function(){a.levelView.playIdleAnimation(r.position,r.facing,!1,r),e.succeeded()},r)}},{key:"checkSolution",value:function(){var e=this;if(this.attemptRunning&&!this.resultReported)if(this.levelModel.isSolved()){var t=this.levelModel.player;if(this.checkHouseBuiltEndAnimation()){this.resultReported=!0;var i=this.levelModel.getHouseBottomRight(),o=new h(i.x-1,i.y+2),n=new h(i.x,i.y),a=new h(i.x-1,i.y+1);this.levelModel.moveTo(o),this.levelView.playSuccessHouseBuiltAnimation(t.position,t.facing,t.isOnBlock,this.levelModel.houseGroundToFloorBlocks(i),[n,a],function(){e.endLevel(!0)},function(){e.levelModel.destroyBlock(n),e.levelModel.destroyBlock(a),e.updateFowPlane(),e.updateShadingPlane()})}else if(this.checkMinecartLevelEndAnimation())this.resultReported=!0,this.levelView.playMinecartAnimation(t.isOnBlock,function(){e.handleEndState(!0)});else if(this.checkAgentSpawn()){this.resultReported=!0,this.levelView.playLevelEndAnimation(t.position,t.facing,t.isOnBlock).onComplete.add(function(){e.levelModel.spawnAgent(null,new h(3,4),2),e.levelView.agent=e.agent,e.levelView.resetEntity(e.agent),e.updateFowPlane(),e.updateShadingPlane(),e.delayBy(200,function(){e.endLevel(!0)})})}else if(this.checkTntAnimation()){this.resultReported=!0,this.levelView.scaleShowWholeWorld(function(){});var r=this.levelModel.getTnt(),s=t.isOnBlock;this.levelView.playDestroyTntAnimation(t.position,t.facing,t.isOnBlock,this.levelModel.getTnt(),this.levelModel.shadingPlane,function(){for(var i in r){r[i].x===e.levelModel.player.position.x&&r[i].y===e.levelModel.player.position.y&&(e.levelModel.player.isOnBlock=!1);var o=e.levelModel.getAllBorderingPositionNotOfType(r[i],"tnt");e.levelModel.destroyBlock(r[i]);for(var n=1;n<o.length;++n)o[n][0]&&e.destroyBlockWithoutPlayerInteraction(o[n][1])}!t.isOnBlock&&s&&e.levelView.playPlayerJumpDownVerticalAnimation(t.facing,t.position),e.updateFowPlane(),e.updateShadingPlane(),e.delayBy(200,function(){e.levelView.playSuccessAnimation(t.position,t.facing,t.isOnBlock,function(){e.endLevel(!0)})})})}else this.endLevel(!0)}else(this.levelModel.isFailed()||!this.getIsDirectPlayerControl()&&!this.levelData.isAquaticLevel)&&this.endLevel(!1)}},{key:"endLevel",value:function(e){var t=this;if(!this.levelModel.usePlayer)return e?this.levelView.audioPlayer.play("success"):this.levelView.audioPlayer.play("failure"),this.resultReported=!0,void this.handleEndState(e);if(e){var i=this.levelModel.player,o=new s(this,function(){},function(){t.levelView.playSuccessAnimation(i.position,i.facing,i.isOnBlock,function(){t.handleEndState(!0)})},i.identifier);i.queue.startPushHighPriorityCommands(),i.addCommand(o,this.isRepeat),i.queue.endPushHighPriorityCommands()}else{var n=this.levelModel.player,a=new s(this,function(){},function(){t.destroyEntity(a,n.identifier)},n.identifier);n.queue.startPushHighPriorityCommands(),n.addCommand(a,this.isRepeat),n.queue.endPushHighPriorityCommands()}}},{key:"addScore",value:function(e,t){this.addCommandRecord("addScore",void 0,e.repeat),this.useScore&&(this.score+=t,this.updateScore()),e.succeeded()}},{key:"updateScore",value:function(){this.onScoreUpdate&&this.onScoreUpdate(this.score)}},{key:"isPathAhead",value:function(e){return!!this.player.isOnBlock||this.levelModel.isForwardBlockOfType(e)}},{key:"addCommand",value:function(e){void 0!==e.target?this.getEntity(e.target).addCommand(e,this.isRepeat):(this.queue.addCommand(e,this.isRepeat),this.queue.begin())}},{key:"addGlobalCommand",value:function(e){var t=this.levelEntity.entityMap.get(e.target);void 0!==t?t.addCommand(e,this.isRepeat):(this.queue.addCommand(e,this.isRepeat),this.queue.begin())}},{key:"startDay",value:function(e){var t=this;if(this.levelModel.isDaytime)void 0!==e&&null!==e&&e.succeeded(),this.DEBUG&&this.game.debug.text("Impossible to start day since it's already day time\n");else{void 0!==this.onDayCallback&&this.onDayCallback(),this.levelModel.isDaytime=!0,this.levelModel.clearFow(),this.levelView.updateFowGroup(this.levelModel.fowPlane),this.events.forEach(function(e){return e({eventType:l.WhenDayGlobal})});var i=this.levelEntity.entityMap,o=function(e){var i=e[1];t.events.forEach(function(e){return e({eventType:l.WhenDay,targetIdentifier:i.identifier,targetType:i.type})})},n=!0,a=!1,r=void 0;try{for(var s,c=i[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){o(s.value)}}catch(e){a=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw r}}for(var h=this.levelEntity.getEntitiesOfType("zombie"),u=0;u<h.length;u++)h[u].setBurn(!0);void 0!==e&&null!==e&&e.succeeded()}}},{key:"startNight",value:function(e){var t=this;if(this.levelModel.isDaytime){void 0!==this.onNightCallback&&this.onNightCallback(),this.levelModel.isDaytime=!1,this.levelModel.computeFowPlane(),this.levelView.updateFowGroup(this.levelModel.fowPlane),this.events.forEach(function(e){return e({eventType:l.WhenNightGlobal})});var i=this.levelEntity.entityMap,o=function(e){var i=e[1];t.events.forEach(function(e){return e({eventType:l.WhenNight,targetIdentifier:i.identifier,targetType:i.type})})},n=!0,a=!1,r=void 0;try{for(var s,c=i[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){o(s.value)}}catch(e){a=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw r}}for(var h=this.levelEntity.getEntitiesOfType("zombie"),u=0;u<h.length;u++)h[u].setBurn(!1);void 0!==e&&null!==e&&e.succeeded()}else void 0!==e&&null!==e&&e.succeeded(),this.DEBUG&&this.game.debug.text("Impossible to start night since it's already night time\n")}},{key:"initiateDayNightCycle",value:function(e,t,i){var o=this;"day"===i||"Day"===i?this.timeouts.push(setTimeout(function(){o.startDay(null),o.setDayNightCycle(t,"night")},1e3*e)):"night"!==i&&"Night"!==i||this.timeouts.push(setTimeout(function(){o.startNight(null),o.setDayNightCycle(t,"day")},1e3*e))}},{key:"setDayNightCycle",value:function(e,t){var i=this;this.dayNightCycle&&("day"===t||"Day"===t?this.timeouts.push(setTimeout(function(){i.dayNightCycle&&(i.startDay(null),i.setDayNightCycle(e,"night"))},1e3*e)):"night"!==t&&"Night"!==t||this.timeouts.push(setTimeout(function(){i.dayNightCycle&&(i.startNight(null),i.setDayNightCycle(e,"day"))},1e3*e)))}},{key:"arrowDown",value:function(e){this.levelModel.usePlayer&&(this.player.movementState=e,this.player.updateMovement())}},{key:"arrowUp",value:function(e){this.levelModel.usePlayer&&(this.player.movementState===e&&(this.player.movementState=-1),this.player.updateMovement())}},{key:"clickDown",value:function(){this.levelModel.usePlayer&&(this.player.movementState=-2,this.player.updateMovement())}},{key:"clickUp",value:function(){this.levelModel.usePlayer&&(-2===this.player.movementState&&(this.player.movementState=-1),this.player.updateMovement())}},{key:"updateFowPlane",value:function(){this.levelModel.computeFowPlane(),this.levelView.updateFowGroup(this.levelModel.fowPlane)}},{key:"updateShadingPlane",value:function(){this.levelModel.computeShadingPlane(),this.levelView.updateShadingGroup(this.levelModel.shadingPlane)}}]),e}();window.GameController=k,e.exports=k},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(14),a=i(6),r=i(1),s=i(3),l=i(16),c=i(17);e.exports=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.planeWidth=t.gridDimensions?t.gridDimensions[0]:10,this.planeHeight=t.gridDimensions?t.gridDimensions[1]:10,this.controller=i,this.player={},this.agent={},this.usingAgent=!1,this.initialLevelData=Object.create(t),this.reset(),this.initialPlayerState=Object.create(this.player),this.initialAgentState=Object.create(this.agent)}return o(e,[{key:"isUnderwater",value:function(){return!!this.getOceanType()}},{key:"getOceanType",value:function(){return this.initialLevelData.ocean}},{key:"isInBoat",value:function(){return this.initialLevelData.boat}},{key:"planeArea",value:function(){return this.planeWidth*this.planeHeight}},{key:"inBounds",value:function(e){var t=e[0],i=e[1];return t>=0&&t<this.planeWidth&&i>=0&&i<this.planeHeight}},{key:"reset",value:function(){var e=this;this.groundPlane=new n(this.initialLevelData.groundPlane,this.planeWidth,this.planeHeight,this,"groundPlane"),this.groundDecorationPlane=new n(this.initialLevelData.groundDecorationPlane,this.planeWidth,this.planeHeight,this,"decorationPlane"),this.shadingPlane=[],this.actionPlane=new n(this.initialLevelData.actionPlane,this.planeWidth,this.planeHeight,this,"actionPlane"),this.actionPlane.powerRedstone(),this.actionPlane.getAllPositions().forEach(function(t){e.actionPlane.getBlockAt(t).isRedstone&&e.actionPlane.determineRedstoneSprite(t),e.actionPlane.getBlockAt(t).isRail&&e.actionPlane.determineRailType(t)}),this.fluffPlane=new n(this.initialLevelData.fluffPlane,this.planeWidth,this.planeHeight),this.fowPlane=[],this.isDaytime=void 0===this.initialLevelData.isDaytime||this.initialLevelData.isDaytime;var t=Object.create(this.initialLevelData);if(void 0!==this.initialLevelData.usePlayer?this.usePlayer=this.initialLevelData.usePlayer:this.usePlayer=!0,this.usePlayer){var i=s.fromArray(t.playerStartPosition);this.player=new l(this.controller,"Player",i.x,i.y,this.initialLevelData.playerName||"Steve",!this.actionPlane.getBlockAt(i).getIsEmptyOrEntity(),t.playerStartDirection),this.controller.levelEntity.pushEntity(this.player),this.controller.player=this.player,t.useAgent&&this.spawnAgent(t)}!t.useAgent&&this.usingAgent&&this.destroyAgent(),this.computeShadingPlane(),this.computeFowPlane()}},{key:"spawnAgent",value:function(e,t,i){this.usingAgent=!0;var o=void 0!==t?t:s.fromArray(e.agentStartPosition),n=void 0!==i?i:e.agentStartDirection,a=this.actionPlane.getBlockAt(o);this.agent=new c(this.controller,"PlayerAgent",o.x,o.y,"Agent",!a.getIsEmptyOrEntity(),n),this.controller.levelEntity.pushEntity(this.agent),this.controller.agent=this.agent}},{key:"destroyAgent",value:function(){this.controller.agent=void 0,this.controller.levelEntity.destroyEntity(this.agent.identifier),this.agent=void 0,this.usingAgent=!1}},{key:"yToIndex",value:function(e){return e*this.planeWidth}},{key:"isSolved",value:function(){return this.initialLevelData.verificationFunction(this)}},{key:"isFailed",value:function(){return void 0!==this.initialLevelData.failureCheckFunction&&this.initialLevelData.failureCheckFunction(this)}},{key:"getHouseBottomRight",value:function(){return s.fromArray(this.initialLevelData.houseBottomRight)}},{key:"isPlayerNextTo",value:function(e){var t=this;return!!this.usePlayer&&s.getOrthogonalPositions(this.player.position).some(function(i){return t.inBounds(i)&&(t.isBlockOfType(i,e)||t.isEntityOfType(i,e)||t.groundPlane.getBlockAt(i).blockType===e)})}},{key:"isEntityNextTo",value:function(e,t){var i=this;return this.controller.levelEntity.getEntitiesOfType(e).some(function(e){return s.getOrthogonalPositions(e.position).some(function(e){return i.inBounds(e)&&(i.isBlockOfType(e,t)||i.isEntityOfType(e,t)||i.groundPlane.getBlockAt(e).blockType===t)})})}},{key:"isEntityOnBlocktype",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=this.controller.levelEntity.getEntitiesOfType(e),n=0,a=0;a<o.length;a++){var r=o[a];(this.isBlockOfType(r.position,t)||this.groundPlane.getBlockAt(r.position).blockType===t)&&n++}return n>=i}},{key:"isEntityAt",value:function(e,t){Array.isArray(t)&&(t=s.fromArray(t));for(var i=this.controller.levelEntity.getEntitiesOfType(e),o=0;o<i.length;o++){var n=i[o];if(s.equals(n.position,t))return!0}return!1}},{key:"isEntityTypeRunning",value:function(e){for(var t=this.controller.levelEntity.getEntitiesOfType(e),i=0;i<t.length;i++){var o=t[i],n=!o.queue.isStarted(),a=!o.queue.isFinished();if(n&&o.queue.commandList_.length>0||a)return!0}return!1}},{key:"isEntityDied",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.controller.levelEntity.entityDeathCount;return!!(i.has(e)&&i.get(e)>=t)}},{key:"getScore",value:function(){return this.controller.score}},{key:"shouldRide",value:function(e){var t=this.player,i=this.getNextRailPosition(t,e),o=this.actionPlane.getBlockAt(i);return this.isNextRailValid(o,e)}},{key:"isNextRailValid",value:function(e,t){if(e)return r.opposite(e.connectionA)===t||r.opposite(e.connectionB)===t||e.connectionA===t||e.connectionB===t}},{key:"getNextRailPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=s.directionToOffsetPosition(t)||new s(0,0);return s.add(e.position,i)}},{key:"getEntityCount",value:function(e){return this.controller.levelEntity.getEntitiesOfType(e).length}},{key:"getCommandExecutedCount",value:function(e,t){return this.controller.getCommandCount(e,t,!1)}},{key:"getRepeatCommandExecutedCount",value:function(e,t){return this.controller.getCommandCount(e,t,!0)}},{key:"getTurnRandomCount",value:function(){return this.controller.turnRandomCount}},{key:"getInventoryAmount",value:function(e){if(!this.usePlayer)return 0;if("all"===e||"All"===e){var t=this.player.inventory,i=0;for(var o in t)i+=t[o];return i}return this.player.inventory[e]}},{key:"getInventoryTypes",value:function(){return this.usePlayer?Object.keys(this.player.inventory):[]}},{key:"countOfTypeOnMap",value:function(e){var t=this;return this.actionPlane.getAllPositions().filter(function(i){return t.actionPlane.getBlockAt(i).blockType===e}).length}},{key:"isPlayerAt",value:function(e){return!!this.usePlayer&&(Array.isArray(e)&&(e=s.fromArray(e)),s.equals(this.player.position,e))}},{key:"spritePositionToIndex",value:function(e,t){var i=s.subtract(t,e);return new s(i.x/40,i.y/40)}},{key:"solutionMapMatchesResultMap",value:function(e){for(var t=0;t<this.planeArea();t++){var i=e[t],o=this.actionPlane.indexToCoordinates(t);if(""!==i)if("empty"===i){if(!this.actionPlane.getBlockAt(o).isEmpty)return!1}else if("any"===i){if(this.actionPlane.getBlockAt(o).isEmpty)return!1}else if(this.actionPlane.getBlockAt(o).blockType!==i)return!1}return!0}},{key:"getTnt",value:function(){var e=this;return this.actionPlane.getAllPositions().filter(function(t){var i=e.actionPlane.getBlockAt(t);return i&&"tnt"===i.blockType})}},{key:"getMoveForwardPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;return s.forward(e.position,e.facing)}},{key:"getMoveDirectionPosition",value:function(e,t){for(var i=e.facing,o=0;o<t;++o)i=r.turn(i,"right");return s.forward(e.position,i)}},{key:"isForwardBlockOfType",value:function(e){var t=this.getMoveForwardPosition(),i=this.isBlockOfTypeOnPlane(t,"empty",this.actionPlane);return!(""!==e||!i)||(i?this.isBlockOfTypeOnPlane(t,e,this.groundPlane):this.isBlockOfTypeOnPlane(t,e,this.actionPlane))}},{key:"getForwardBlockType",value:function(){var e=this.getForwardBlock();return e?e.blockType:""}},{key:"getForwardBlock",value:function(){var e=this.getMoveForwardPosition();return this.actionPlane.getBlockAt(e)}},{key:"isBlockOfType",value:function(e,t){return this.isBlockOfTypeOnPlane(e,t,this.actionPlane)}},{key:"isEntityOfType",value:function(e,t){return this.controller.levelEntity.getEntitiesOfType(t).some(function(t){return s.equals(e,t.position)})}},{key:"isBlockOfTypeOnPlane",value:function(e,t,i){var o=!1;return this.inBounds(e)&&(o="empty"===t?i.getBlockAt(e).isEmpty:"tree"===t?i.getBlockAt(e).getIsTree():t===i.getBlockAt(e).blockType),o}},{key:"isPlayerStandingInWater",value:function(){return"water"===this.groundPlane.getBlockAt(this.player.position).blockType}},{key:"isPlayerStandingInLava",value:function(){return"lava"===this.groundPlane.getBlockAt(this.player.position).blockType}},{key:"coordinatesToIndex",value:function(e){return this.yToIndex(e[1])+e[0]}},{key:"checkPositionForTypeAndPush",value:function(e,t,i){return!e&&""!==this.actionPlane.getBlockAt(t).blockType||this.isBlockOfType(t,e)?(i.push([!0,t]),!0):(i.push([!1,null]),!1)}},{key:"houseGroundToFloorHelper",value:function(e,t,i){var o,n,a,r,s,l=0,c=i,h=this.yToIndex(e[2])+e[1];44===h&&(h=44),(n=[0,e[1],e[2]+1])[0]=this.yToIndex(n[2])+n[1],(a=[0,e[1],e[2]-1])[0]=this.yToIndex(a[2])+a[1],(r=[0,e[1]+1,e[2]])[0]=this.yToIndex(r[2])+r[1],s=[0,e[1]-1,e[2]],r[0]=this.yToIndex(r[2])+r[1],o=this.actionPlane.getBlockAt(this.actionPlane.indexToCoordinates(h));for(var u=0;u<c.length;++u)if(c[u][0]===h){l=-1;break}return""!==o.blockType?{}:c.length>0&&-1===l?{}:(c.push(e),c.concat(this.houseGroundToFloorHelper(n,t,c)),c.concat(this.houseGroundToFloorHelper(a,t,c)),c.concat(this.houseGroundToFloorHelper(r,t,c)),c.concat(this.houseGroundToFloorHelper(s,t,c)),c)}},{key:"houseGroundToFloorBlocks",value:function(e){var t=[0,e[0],e[1]];return this.houseGroundToFloorHelper(t,"wool_orange",[])}},{key:"getEntityAt",value:function(e){var t=!0,i=!1,o=void 0;try{for(var n,a=this.controller.levelEntity.entityMap[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var r=n.value;if(s.equals(r[1].position,e))return r[1]}}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}}},{key:"getAllBorderingPositionNotOfType",value:function(e,t){for(var i=this.getAllBorderingPosition(e,null),o=1;o<i.length;++o)i[o][0]&&this.actionPlane.getBlockAt(i[o][1]).blockType===t&&(i[o][0]=!1);return i}},{key:"getAllBorderingPosition",value:function(e,t){var i=this,o=[!1];return s.getSurroundingPositions(e).forEach(function(e){i.checkPositionForTypeAndPush(t,e,o)&&(o[0]=!0)}),o}},{key:"canMoveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveForwardPosition(e);return!(!this.controller.followingPlayer()&&(t.x>9||t.y>9))&&this.isPositionEmpty(t,e)}},{key:"canMoveBackward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveDirectionPosition(e,2);return this.isPositionEmpty(t,e)}},{key:"isPositionEmpty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player,i=[!1];if(this.inBounds(e)){if(this.actionPlane.getBlockAt(e).isWalkable||i.push("notWalkable"),!this.actionPlane.getBlockAt(e).isEmpty){if(this.player.isOnBlock)return[!0];i.push("notEmpty")}var o=this.groundPlane.getBlockAt(e).blockType,n=this.getEntityAt(e);if(["water","lava"].includes(o))if(this.controller.getIsDirectPlayerControl())i.push(o);else if(void 0===n||n.canMoveThrough())return[!0];if("water"!==this.groundPlane.getBlockAt(e).blockType&&this.isInBoat())return i.push("notWater"),i;void 0!==n&&(i.push("frontEntity"),i.push(n));var a=this.groundPlane.getBlockAt(e),r=this.actionPlane.getBlockAt(e);i[0]=t.hasPermissionToWalk(r,n,a)}else i.push("outBound");return i}},{key:"canMoveDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=e.facing;this.turnToDirection(e,t);var o=this.canMoveForward(e);return this.turnToDirection(e,i),o}},{key:"canPlaceBlock",value:function(e,t){return e.canPlaceBlock(t)}},{key:"canPlaceBlockDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1],i=arguments[2];return!t.isOnBlock&&((this.getPlaneToPlaceOn(this.getMoveDirectionPosition(t,i),t,e)!==this.groundPlane||!a.notValidOnGroundPlane(e)||!this.groundPlane.getBlockAt(this.getMoveDirectionPosition(t,i)))&&(!this.checkEntityConflict(this.getMoveDirectionPosition(t,i))&&null!==this.getPlaneToPlaceOn(this.getMoveDirectionPosition(t,i),t,e)))}},{key:"checkEntityConflict",value:function(e){var t=!1;return this.controller.levelEntity.entityMap.forEach(function(i){s.equals(i.position,e)&&(t=!0)}),t}},{key:"canPlaceBlockForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;return this.canPlaceBlockDirection(e,t,0)}},{key:"getPlaneToPlaceOn",value:function(e,t,i){if(this.inBounds(e)){var o=this.actionPlane.getBlockAt(e);if(t===this.agent&&o.isEmpty){if(this.groundPlane.getBlockAt(e).getIsLiquid()){if(a.getCanFall(i))return this.groundPlane;if(!a.getIsPlaceableInLiquid(i))return null}return this.actionPlane}if(o.isPlacable)return this.groundPlane.getBlockAt(e).isPlacable?this.groundPlane:this.actionPlane}return null}},{key:"canDestroyBlockForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=!1;if(!e.isOnBlock){var i=this.getMoveForwardPosition(e);if(this.inBounds(i)){var o=this.actionPlane.getBlockAt(i);t=!o.isEmpty&&(o.isDestroyable||o.isUsable)}}return t}},{key:"moveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveForwardPosition(e);this.moveTo(t,e)}},{key:"moveBackward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveDirectionPosition(e,2);this.moveTo(t,e)}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;t.setMovePosition(e),this.actionPlane.getBlockAt(e).isEmpty&&(t.isOnBlock=!1)}},{key:"turnLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;e.facing=r.turn(e.facing,"left")}},{key:"turnRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;e.facing=r.turn(e.facing,"right")}},{key:"turnToDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1];e.facing=t}},{key:"moveDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1];this.turnToDirection(e,t),this.moveForward()}},{key:"placeBlock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player,i=t.position,o=null,n=this.groundPlane.getBlockAt(i),r=this.actionPlane.getBlockAt(i),s=new a(e),l=t.canPlaceBlockOver(s,n);if(l.canPlace&&!r.getIsMiniblock())switch(l.plane){case"actionPlane":o=this.actionPlane.setBlockAt(i,s),t.walkableCheck(s);break;case"groundPlane":this.groundPlane.setBlockAt(i,s)}return o}},{key:"placeBlockForward",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player;return this.placeBlockDirection(e,t,i,0)}},{key:"placeBlockDirection",value:function(e,t,i,o){var n=this.getMoveDirectionPosition(i,o);return"watering"===e&&(e="farmlandWet",t=this.groundPlane),t.setBlockAt(n,new a(e))}},{key:"destroyBlock",value:function(e){var t=null;return this.inBounds(e)&&null!==(t=this.actionPlane.getBlockAt(e))&&(t.position=e,t.isDestroyable&&this.actionPlane.setBlockAt(e,new a(""))),t}},{key:"destroyBlockForward",value:function(e){var t=null,i=this.getMoveForwardPosition(e);return this.inBounds(i)&&null!==(t=this.actionPlane.getBlockAt(i))&&t.isDestroyable&&this.actionPlane.setBlockAt(i,new a("")),t}},{key:"solveFOWTypeForMap",value:function(){var e,t;for(var i in e=this.getAllEmissives(),t=this.findBlocksAffectedByEmissives(e))t.hasOwnProperty(i)&&this.solveFOWTypeFor(t[i],e)}},{key:"solveFOWTypeFor",value:function(e,t){var i,o,n,a=!1,r=!1,s=!1,l=!1,c=!1,h=!1,u=!1,d=!1,p=0,f=this.coordinatesToIndex(e);for(var y in i=this.findEmissivesThatTouch(e,t)){var m=i[y];n=e[1],o=e[0],(p=-(p=Math.atan2(m[1]-e[1],m[0]-e[0])))<0&&(p+=2*Math.PI),p*=360/(2*Math.PI),!h&&p>32.5&&p<=57.5&&(l=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_InCorner_TopRight",precedence:0})),!s&&p>122.5&&p<=147.5&&(a=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_InCorner_TopLeft",precedence:0})),!s&&p>212.5&&p<=237.5&&(r=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_InCorner_BottomLeft",precedence:0})),!h&&p>302.5&&p<=317.5&&(c=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_InCorner_BottomRight",precedence:0})),(p>=327.5||p<=32.5)&&(h=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Right",precedence:1})),p>237.5&&p<=302.5&&(d=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Bottom",precedence:1})),p>147.5&&p<=212.5&&(s=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Left",precedence:1})),p>57.5&&p<=122.5&&(u=!0,this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Top",precedence:1}))}a&&r&&this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Left",precedence:1}),l&&c&&this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Right",precedence:1}),a&&l&&this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Top",precedence:1}),c&&r&&this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Bottom",precedence:1}),s&&h||u&&d||h&&d&&a||d&&l&&a||u&&c&&r||s&&l&&c||s&&d&&l?this.fowPlane[f]="":a&&c?this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_TopLeftBottomRight",precedence:2}):r&&l?this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_BottomLeftTopRight",precedence:2}):d&&s||d&&a||s&&c?this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Bottom_Left",precedence:2}):d&&h||d&&l||h&&r?this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Bottom_Right",precedence:2}):u&&h||u&&c||h&&a?this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Top_Right",precedence:2}):(u&&s||u&&r||s&&l)&&this.pushIfHigherPrecedence(f,{x:o,y:n,type:"FogOfWar_Top_Left",precedence:2})}},{key:"pushIfHigherPrecedence",value:function(e,t){if(""!==t){var i=this.fowPlane[e];i&&i.precedence>t.precedence||(this.fowPlane[e]=t)}else this.fowPlane[e]=""}},{key:"getAllEmissives",value:function(){for(var e=[],t=0;t<this.planeHeight;++t)for(var i=0;i<this.planeWidth;++i){var o=new s(i,t);(!this.actionPlane.getBlockAt(o).isEmpty&&this.actionPlane.getBlockAt(o).isEmissive||this.groundPlane.getBlockAt(o).isEmissive&&(this.actionPlane.getBlockAt(o).isEmpty||this.actionPlane.getBlockAt(o).isTransparent)||this.actionPlane.getBlockAt(o).isEmpty&&this.groundDecorationPlane.getBlockAt(o).isEmissive)&&e.push(o)}return e}},{key:"findBlocksAffectedByEmissives",value:function(e){var t={};for(var i in e)for(var o=e[i],n=o.x,a=o.y,r=o.y-2;r<=a+2;++r)for(var l=o.x-2;l<=n+2;++l){var c=new s(l,r);this.inBounds(c)&&(r>=a-1&&r<=a+1&&l>=n-1&&l<=n+1||(t[r+"_"+l]=c))}return t}},{key:"findEmissivesThatTouch",value:function(e,t){for(var i=[],o=e.y,n=e.x,a=o-2;a<=o+2;++a)for(var r=n-2;r<=n+2;++r){var l=new s(r,a);if(this.inBounds(l)&&!(a>=o-1&&a<=o+1&&r>=n-1&&r<=n+1))for(var c in t)s.equals(t[c],l)&&i.push(t[c])}return i}},{key:"computeFowPlane",value:function(){var e,t;if(this.fowPlane=[],!this.isDaytime){for(t=0;t<this.planeHeight;++t)for(e=0;e<this.planeWidth;++e)this.fowPlane.push({x:e,y:t,type:"FogOfWar_Center"});for(this.solveFOWTypeForMap(),t=0;t<this.planeHeight;++t)for(e=0;e<this.planeWidth;++e){var i=new s(e,t),o=this.groundPlane.getBlockAt(i),n=this.actionPlane.getBlockAt(i),a=this.groundDecorationPlane.getBlockAt(i);(o.isEmissive&&(n.isEmpty||n.isTransparent)||!n.isEmpty&&n.isEmissive||n.isEmpty&&a.isEmissive)&&this.clearFowAround(e,t)}}}},{key:"clearFowAround",value:function(e,t){var i,o;for(o=-1;o<=1;++o)for(i=-1;i<=1;++i)this.clearFowAt(e+i,t+o)}},{key:"clearFowAt",value:function(e,t){if(e>=0&&e<this.planeWidth&&t>=0&&t<this.planeHeight){var i=this.yToIndex(t)+e;this.fowPlane[i]=""}}},{key:"clearFow",value:function(){for(var e=0;e<this.planeWidth;e++)for(var t=0;t<this.planeHeight;t++){var i=this.yToIndex(t)+e;this.fowPlane[i]=""}}},{key:"computeShadingPlane",value:function(){this.shadingPlane=[],this.computeShading(this.actionPlane),this.computeShading(this.groundPlane)}},{key:"occludedBy",value:function(e){return e&&!e.getIsEmptyOrEntity()&&!e.getIsLiquid()}},{key:"computeShading",value:function(e){var t,i,o,n;for(o=0;o<this.planeArea();++o){t=o%this.planeWidth,i=Math.floor(o/this.planeWidth);var a=new s(t,i);n=!1;var r=e.getBlockAt(a),l=this.groundPlane.getBlockAt(a);if(r.isEmpty||r.isTransparent||r.getIsLiquid()){var c="AO";"lava"===r.blockType?c="LavaGlow":"water"!==r.blockType&&"magmaUnderwater"!==r.blockType||(c="WaterAO"),r!==l&&l.getIsLiquid()||(0===i&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Bottom"}),i===this.planeHeight-1&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Top"}),0===t&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Right"}),t===this.planeWidth-1&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Left"}));var h=e.getSurroundingBlocks(a);t<this.planeWidth-1&&this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Left"}),t>0&&this.occludedBy(h.west)&&(this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Right"}),r.getIsLiquid()||(this.shadingPlane.push({x:t,y:i,atlas:"blockShadows",type:"Shadow_Parts_Fade_base.png"}),i>0&&t>0&&e.getBlockAt(s.north(s.west(a))).getIsEmptyOrEntity()&&this.shadingPlane.push({x:t,y:i,atlas:"blockShadows",type:"Shadow_Parts_Fade_top.png"})),n=!0),i>0&&this.occludedBy(h.north)?this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Bottom"}):i>0&&(t<this.planeWidth-1&&this.occludedBy(h.northEast)&&!this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_BottomLeft"}),!n&&t>0&&this.occludedBy(h.northWest)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_BottomRight"})),i<this.planeHeight-1&&this.occludedBy(h.south)?this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Top"}):i<this.planeHeight-1&&(t<this.planeWidth-1&&this.occludedBy(h.southEast)&&!this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_TopLeft"}),!n&&t>0&&this.occludedBy(h.southWest)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_TopRight"}))}}}}]),e}()},function(e,t,i){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var a=i(6),r=i(1),s=r.North,l=r.South,c=r.East,h=r.West,u=r.opposite,d=r.turnDirection,p=r.turn,f=r.directionToRelative,y=i(3),m=i(15),v=function(e){switch(e){case s:return"North";case l:return"South";case c:return"East";case h:return"West";default:return""}},g=["","Vertical","Vertical","Vertical","Horizontal","UpRight","DownRight","TRight","Horizontal","UpLeft","DownLeft","TLeft","Horizontal","TUp","TDown","Cross"],k=[[],[s],[l],[s,l],[c],[s,c],[l,c],[l,c],[h],[s,h],[l,h],[l,h],[c,h],[s,c],[l,c],[s,c]],b=[[],[s],[l],[s,l],[c],[c,h],[c,h],[c,h],[h],[c,h],[c,h],[c,h],[c,h],[c,h],[c,h],[c,h]];e.exports=function(){function e(t,i,o,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=[],this.width=i,this.height=o,this.levelModel=n,this.planeType=r,this.playPistonOn=!1,this.playPistonOff=!1;for(var s=0;s<t.length;++s){var l=new a(t[s]);this._data.push(l)}this.isActionPlane()&&(this.redstoneAdjacencySet=this.createRedstoneAdjacencySet())}return n(e,[{key:"inBounds",value:function(e){return e.x>=0&&e.x<this.width&&e.y>=0&&e.y<this.height}},{key:"coordinatesToIndex",value:function(e){return e.y*this.width+e.x}},{key:"indexToCoordinates",value:function(e){var t=Math.floor(e/this.width),i=e-t*this.width;return new y(i,t)}},{key:"getAllPositions",value:function(){var e=this;return this._data.map(function(t,i){return e.indexToCoordinates(i)})}},{key:"getBlockAt",value:function(e){if(e=y.fromArray(e),this.inBounds(e))return this._data[this.coordinatesToIndex(e)]}},{key:"isActionPlane",value:function(){return"actionPlane"===this.planeType}},{key:"isDecorationPlane",value:function(){return"decorationPlane"===this.planeType}},{key:"isGroundPlane",value:function(){return"groundPlane"===this.planeType}},{key:"setBlockAt",value:function(e,t){var i=this;if(e=y.fromArray(e),this.inBounds(e)){if(this._data[this.coordinatesToIndex(e)]=t,this.isActionPlane()){t.isRedstone||t.isRedstoneBattery?this.redstoneAdjacencySet.add(e):this.redstoneAdjacencySet.remove(e);var o=[];if(t.needToRefreshRedstone()&&(o=this.refreshRedstone()),this.updateWeakCharge(e,t),t.isEmpty&&[s,l,c,h].forEach(function(t){var o=y.directionToOffsetPosition(t),n=i.getBlockAt(y.add(e,o));n&&n.isRail&&(n.connectionA===u(t)&&(n.connectionA=void 0),n.connectionB===u(t)&&(n.connectionB=void 0))}),this.determineRailType(e,!0),this.levelModel&&this.levelModel.controller.levelView){var n=y.north(y.east(e)),a=y.south(y.west(e)),r=y.getOrthogonalPositions(e).concat([e,n,a]);this.levelModel.controller.levelView.refreshActionGroup(r),this.levelModel.controller.levelView.refreshActionGroup(o)}}else this.isGroundPlane()&&this.levelModel.controller.levelView.refreshGroundGroup();return this.resolveConduitState(),t}}},{key:"getOrthogonalBlocks",value:function(e){return{north:{block:this.getBlockAt(y.north(e)),relative:l},south:{block:this.getBlockAt(y.south(e)),relative:s},east:{block:this.getBlockAt(y.east(e)),relative:h},west:{block:this.getBlockAt(y.west(e)),relative:c}}}},{key:"getSurroundingBlocks",value:function(e){return{north:this.getBlockAt(y.north(e)),northEast:this.getBlockAt(y.north(y.east(e))),east:this.getBlockAt(y.east(e)),southEast:this.getBlockAt(y.south(y.east(e))),south:this.getBlockAt(y.south(e)),southWest:this.getBlockAt(y.south(y.west(e))),west:this.getBlockAt(y.west(e)),northWest:this.getBlockAt(y.north(y.west(e)))}}},{key:"getOrthogonalMask",value:function(e,t){var i=this.getOrthogonalBlocks(e);return(t(i.north)<<0)+(t(i.south)<<1)+(t(i.east)<<2)+(t(i.west)<<3)}},{key:"getMinecartTrack",value:function(e,t){var i=this.getBlockAt(e);if(i.isRail){if(i.connectionA===t||i.connectionB===t)return["",y.forward(e,t),t,300];var o=u(t);if(i.connectionA===o&&void 0!==i.connectionB){var n=d(t,i.connectionB);return["turn_"+n,e,p(t,n),300]}if(i.connectionB===o&&void 0!==i.connectionA){var a=d(t,i.connectionA);return["turn_"+a,e,p(t,a),300]}}}},{key:"getPoweredRailsConnected",value:function(e,t){if(!y.isAdjacent(e,t))return!1;var i=this.getBlockAt(e),o=this.getBlockAt(t);return!(!i.getIsPowerableRail()||!o.getIsPowerableRail())&&(i.getIsHorizontal()&&o.getIsHorizontal()?y.equals(y.forward(e,c),t)||y.equals(y.forward(e,h),t):!(!i.getIsVertical()||!o.getIsVertical())&&(y.equals(y.forward(e,s),t)||y.equals(y.forward(e,l),t)))}},{key:"powerRedstone",value:function(){var e=this;return this.redstoneAdjacencySet.sets.forEach(function(t){var i=t.some(function(t){return e.getBlockAt(t).isRedstoneBattery});t.forEach(function(t){e.getBlockAt(t).isPowered=i,e.determineRedstoneSprite(t)})}),this.redstoneAdjacencySet.flattenSets()}},{key:"createRedstoneAdjacencySet",value:function(){var e=this,t=this.getAllPositions().filter(function(t){var i=e.getBlockAt(t);return i.isRedstone||i.isRedstoneBattery});return new m(t)}},{key:"powerRails",value:function(){var e=this,t=this.getAllPositions().filter(function(t){return e.getBlockAt(t).getIsPowerableRail()});return t.forEach(function(t){e.determineRailType(t)}),new m(t,this.getPoweredRailsConnected.bind(this)).sets.forEach(function(t){t.some(function(t){return e.getBlockAt(t).isPowered})&&t.forEach(function(t){e.getBlockAt(t).isPowered=!0})}),t.forEach(function(t){e.determineRailType(t)}),t}},{key:"determineRailType",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getBlockAt(e);if(n&&n.isRail){var a="",r=k;if(n.getIsPowerableRail()&&(a=n.isPowered?"Powered":"Unpowered",r=b),void 0===n.connectionA||void 0===n.connectionB){var s=this.getOrthogonalMask(e,function(e){var t=e.block,i=e.relative;if(!t||!t.isRail)return!1;var o=void 0===t.connectionA||t.connectionA===i,n=void 0===t.connectionB||t.connectionB===i;return o||n}),l=o(r[s],2);n.connectionA=l[0],n.connectionB=l[1]}var c=v(n.connectionA)+v(n.connectionB);n.blockType="rails"+a+c,i&&y.getOrthogonalPositions(e).forEach(function(e){t.determineRailType(e)})}}},{key:"determineRedstoneSprite",value:function(e){var t=this.getBlockAt(e);if(t&&t.isRedstone){var i=this.getOrthogonalMask(e,function(e){var t=e.block;return t&&(t.isRedstone||t.isConnectedToRedstone)}),o=g[i],n=t.isPowered?"On":"";return t.blockType="redstoneWire"+o+n,"redstoneWire"+o}}},{key:"refreshRedstone",value:function(){var e=this,t=this.powerRedstone();this.powerAllBlocks();var i=this.powerRails(),o=t.concat(i);return this.getAllPositions().forEach(function(t){e.getIronDoors(t),e.getPistonState(t)}),this.playPistonSound(),o}},{key:"playPistonSound",value:function(){this.levelModel&&(this.playPistonOn?this.levelModel.controller.audioPlayer.play("pistonOut"):this.playPistonOff&&this.levelModel.controller.audioPlayer.play("pistonIn"),this.playPistonOn=!1,this.playPistonOff=!1)}},{key:"checkEntityConflict",value:function(e){var t=this;if(this.levelModel){var i=!1;return this.levelModel.controller.levelEntity.entityMap.forEach(function(o){t.levelModel.controller.positionEquivalence(e,o.position)&&(i=!0)}),i}}},{key:"getIronDoors",value:function(e){e=y.fromArray(e);var t=this.getBlockAt(e),i=this.coordinatesToIndex(e);"doorIron"===t.blockType&&(t.isPowered=this.powerCheck(e,!0),t.isPowered&&!t.isOpen?(t.isOpen=!0,this.levelModel&&this.levelModel.controller.levelView.animateDoor(i,!0)):!t.isPowered&&t.isOpen&&this.levelModel&&(this.checkEntityConflict(e)||(t.isOpen=!1,this.levelModel.controller.levelView.animateDoor(i,!1))))}},{key:"getPistonState",value:function(e){var t=this.getBlockAt(e);t.getIsPiston()&&!t.getIsPistonArm()&&(t.isPowered=this.powerCheck(e,!0),t.isPowered?this.activatePiston(e):t.isPowered||this.deactivatePiston(e),this.levelModel&&(this.levelModel.controller.updateFowPlane(),this.levelModel.controller.updateShadingPlane()))}},{key:"findDoorToAnimate",value:function(e){var t=this;this.getAllPositions().forEach(function(i){var o=t.getBlockAt(i),n=t.coordinatesToIndex(i);"doorIron"===o.blockType&&i!==e&&(o.isPowered=t.powerCheck(i,!0),o.isPowered&&!o.isOpen?(o.isOpen=!0,t.levelModel&&t.levelModel.controller.levelView.animateDoor(n,!0)):o.isPowered||!o.isOpen||t.checkEntityConflict(i)||(o.isOpen=!1,t.levelModel&&t.levelModel.controller.levelView.animateDoor(n,!1)))})}},{key:"activatePiston",value:function(e){var t=this.getBlockAt(e),i=t.blockType;t.getIsStickyPiston()&&(i=i.substring(0,i.length-6)),"On"===i.substring(i.length-2,i.length)&&(i=i.substring(0,i.length-2));var o=t.getPistonDirection(),n="pistonArm"+f(o),r=y.directionToOffsetPosition(o),s=y.forward(e,o),l=this.getBlockAt(s);if(!this.pistonArmBlocked(e,r))if(l.isDestroyableUponPush())this.setBlockAt(s,new a("")),this.playPistonOn=!0,this.levelModel&&this.levelModel.controller.levelView.playExplosionAnimation(s,2,s,l.blockType,null,null,this.player);else if(""===l.blockType||l.getIsPistonArm()){if(""===l.blockType){var c="On";t.getIsStickyPiston()&&(c+="Sticky",n+="Sticky");var h=new a(n),u=new a(i+=c);this.setBlockAt(s,h),this.setBlockAt(e,u),this.playPistonOn=!0}}else{var d=this.getBlocksToPush(s,r),p="On";t.getIsStickyPiston()&&(p+="Sticky");var m=new a(i+=p);this.setBlockAt(e,m),this.pushBlocks(d,r),this.playPistonOn=!0}}},{key:"pistonArmBlocked",value:function(e,t){var i=y.add(e,t);return this.checkEntityConflict(i)}},{key:"deactivatePiston",value:function(e){var t=this.getBlockAt(e);if(t.getIsPiston()&&t.blockType.match("On")){var i=t.getPistonDirection();void 0!==i&&this.retractArm(y.forward(e,i),e)}}},{key:"retractArm",value:function(e,t){var i=new a(""),o=this.getBlockAt(t),n="",r="";this.getBlockAt(t).getIsStickyPiston()?(n="Sticky",r=o.blockType.substring(0,o.blockType.length-8)):r=o.blockType.substring(0,o.blockType.length-2);var s=new a(r+n);if(this.getBlockAt(e).getIsPistonArm())if(this.getBlockAt(t).getIsStickyPiston()){var l=y.directionToOffsetPosition(o.getPistonDirection()),c=y.add(e,l);this.inBounds(c)&&this.getBlockAt(c).isStickable?(this.setBlockAt(e,this.getBlockAt(c)),this.setBlockAt(c,i)):(this.setBlockAt(e,i),this.playPistonOff=!0)}else this.setBlockAt(e,i),this.playPistonOff=!0;this.setBlockAt(t,s)}},{key:"pushBlocks",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i="",o=!1;1===t[0]?i="pistonArmRight":-1===t[0]?i="pistonArmLeft":1===t[1]?i="pistonArmDown":-1===t[1]&&(i="pistonArmUp");for(var n=new a(i),r=e.length-1;r>=0;--r){var s=y.add(e[r],y.fromArray(t)),l=this.getBlockAt(e[r]);this.inBounds(s)&&this.getBlockAt(s).isDestroyableUponPush()&&(this.levelModel&&this.levelModel.controller.levelView.playExplosionAnimation(s,2,s,l.blockType,null,null,this.player),o=!0),this.setBlockAt(s,this.getBlockAt(e[r])),0===r&&this.setBlockAt(e[r],n)}o&&this.refreshRedstone()}},{key:"getBlocksToPush",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i=[],o=e;this.inBounds(o)&&this.getBlockAt(o).getIsPushable();)i.push(o),o=y.add(o,y.fromArray(t));return i}},{key:"powerCheck",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.getOrthogonalPositions(e).some(function(o){var n=t.getBlockAt(o);if(n){if(!n.isWeaklyPowerable)return!1;if(t.getBlockAt(e).getIsPiston()){var a=t.getBlockAt(e),r=y.directionToOffsetPosition(a.getPistonDirection())||new y(0,0),s=y.add(e,r);if(y.equals(o,s))return!1}return i?n.isPowered||n.isRedstoneBattery:n.isRedstone&&n.isPowered||n.isRedstoneBattery}})}},{key:"powerAllBlocks",value:function(){var e=this;this.getAllPositions().forEach(function(t){var i=e.getBlockAt(t);""!==i.blockType&&i.canHoldCharge()&&(i.isPowered=e.powerCheck(t))})}},{key:"updateWeakCharge",value:function(e,t){var i=this;t.isWeaklyPowerable&&(t.isPowered=this.powerCheck(e)),t.isPowered&&y.getOrthogonalPositions(e).forEach(function(e){i.inBounds(e)&&(i.getIronDoors(e),i.getPistonState(e))})}},{key:"getConduitRingPositions",value:function(e,t){var i=new y(e.x-t,e.y-t),o=new y(e.x+t,e.y+t),n=[];if(!this.inBounds(i)||!this.inBounds(o))return n;for(var a=2*t+1,r=0;r<a;++r)for(var s=0;s<a;++s)if(0===r||r===a-1||0===s||s===a-1){var l=new y(i.x+r,i.y+s);n.push(l)}return n}},{key:"resolveConduitState",value:function(){var e=this;this.getAllPositions().forEach(function(t){var i=e.getBlockAt(t);if("conduit"===i.blockType){var o=0,n=0;e.getConduitRingPositions(t,2).forEach(function(t){"prismarine"===e.getBlockAt(t).blockType&&++o}),e.getConduitRingPositions(t,1).forEach(function(t){e.getBlockAt(t).isEmpty&&++n}),o!==e.getRingRequirement(2)||n!==e.getRingRequirement(1)||i.isActivatedConduit?(o<e.getRingRequirement(2)||n<e.getRingRequirement(1))&&i.isActivatedConduit&&(e.getBlockAt(t).isActivatedConduit=!1,e.levelModel&&e.levelModel.controller.levelView.playCloseConduitAnimation(t)):(e.getBlockAt(t).isActivatedConduit=!0,e.levelModel&&e.levelModel.controller.levelView.playOpenConduitAnimation(t))}})}},{key:"getRingRequirement",value:function(e){return 8*e}}]),e}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var a=i(3);e.exports=function(){function e(t,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.comparisonFunction=i||a.isAdjacent,this.sets=[],t&&t.forEach(function(e){o.add(e)})}return o(e,[{key:"flattenSets",value:function(){return this.sets.reduce(function(e,t){return e.concat(t)},[])}},{key:"add",value:function(e){var t=this;if(this.find(e))return!1;var i=this.sets.filter(function(i){return i.some(function(i){return t.comparisonFunction(e,i)})});if(1===i.length)i[0].push(e);else if(i.length>1){var o=[];i.forEach(function(e){t.sets.splice(t.sets.indexOf(e),1),o.push.apply(o,n(e))}),o.push(e),this.sets.push(o)}else this.sets.push([e]);return!0}},{key:"find",value:function(e){return this.sets.find(function(t){return t.some(function(t){return a.equals(e,t)})})}},{key:"remove",value:function(t){var i=this.find(t);if(!i)return!1;this.sets.splice(this.sets.indexOf(i),1);var o=i.filter(function(e){return!a.equals(t,e)});if(o.length){var r,s=new e(o,this.comparisonFunction).sets;(r=this.sets).push.apply(r,n(s))}return!0}}]),e}()},function(e,t,i){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var a=i(0),r=i(4),s=i(3);e.exports=function(e){function t(e,i,o,n,a,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,"Player",o,n,s));return l.offset=[-18,-32],l.name=a,l.isOnBlock=r,l.inventory={},l.movementState=-1,l.onTracks=!1,l.getOffTrack=!1,e.getIsDirectPlayerControl()?(l.moveDelayMin=0,l.moveDelayMax=0):(l.moveDelayMin=30,l.moveDelayMax=200),e.levelData.ocean&&(l.offset=[-26,-26]),e.levelData.boat&&(l.offset=[-27,-30]),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"canPlaceBlockOver",value:function(e,t){var i={canPlace:!1,plane:""};return t.getIsLiquid()?(i.canPlace=!0,i.plane="groundPlane"):(i.canPlace=!0,i.plane="actionPlane"),"cropWheat"===e.blockType&&(i.canPlace="farmlandWet"===t.blockType),i}},{key:"canPlaceBlock",value:function(e){return e.isEmpty}},{key:"shouldUpdateSelectionIndicator",value:function(){return!0}},{key:"setMovePosition",value:function(e){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setMovePosition",this).call(this,e),this.collectItems(this.position)}},{key:"walkableCheck",value:function(e){this.isOnBlock=!e.isWalkable}},{key:"updateMovement",value:function(){var e=this;if(this.controller.attemptRunning&&this.controller.getIsDirectPlayerControl()&&(this.onTracks&&this.collectItems(this.position),this.canUpdateMovement()))if(this.movementState>=0){var t=this.movementState,i=new r(this,function(){},function(){e.lastMovement=+new Date,e.controller.moveDirection(i,t)},this.identifier);this.addCommand(i)}else{var o=new r(this,function(){},function(){e.lastMovement=+new Date,e.controller.use(o)},this.identifier);this.addCommand(o)}}},{key:"canUpdateMovement",value:function(){var e=this.queue.isFinished()||!this.queue.isStarted(),t=-1!==this.movementState,i=this.queue.currentCommand&&0===this.queue.getLength(),o=+new Date-this.lastMovement,n=o>300;return t&&o>800&&(this.getOffTrack=!0),!this.onTracks&&(e||i&&n)&&t}},{key:"doMoveForward",value:function(e){var t,i,o=this,n=this.controller.levelModel,a=this.controller.levelView,r=this.isOnBlock,s=this.position;n.moveForward(),i=r&&r!==this.isOnBlock,t=this.isOnBlock||i?n.actionPlane.getBlockAt(this.position).blockType:n.groundPlane.getBlockAt(this.position).blockType,a.playMoveForwardAnimation(this,s,this.facing,i,this.isOnBlock,t,function(){return o.afterMove(e)}),this.updateHidingTree(),this.updateHidingBlock(s)}},{key:"doMoveBackward",value:function(e){var t,i,o=this,n=this.controller.levelModel,a=this.controller.levelView,r=this.isOnBlock,s=this.position;n.moveBackward(this),i=r&&r!==this.isOnBlock,t=(this.isOnBlock,n.actionPlane.getBlockAt(this.position).blockType),a.playMoveBackwardAnimation(this,s,this.facing,i,this.isOnBlock,t,function(){return o.afterMove(e)}),this.updateHidingTree(),this.updateHidingBlock(s)}},{key:"afterMove",value:function(e){var t=this,i=this.controller.levelModel,o=this.controller.levelView;o.playIdleAnimation(this.position,this.facing,this.isOnBlock),i.isPlayerStandingInWater()&&!i.isInBoat()?o.playDrownFailureAnimation(this.position,this.facing,this.isOnBlock,function(){t.controller.handleEndState(!1)}):i.isPlayerStandingInLava()?o.playBurnInLavaAnimation(this.position,this.facing,this.isOnBlock,function(){t.controller.handleEndState(!1)}):(s.getOrthogonalPositions(this.position).forEach(function(e){var t=i.actionPlane.getBlockAt(e);t&&t.blockType.endsWith("Chest")&&!t.isOpen&&(t.isOpen=!0,o.playOpenChestAnimation(e))}),this.controller.delayPlayerMoveBy(this.moveDelayMin,this.moveDelayMax,function(){e.succeeded()}))}},{key:"bump",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel;t.playBumpAnimation(this.position,this.facing,!1);var o=this.controller.levelEntity.getEntityAt(i.getMoveForwardPosition(this));if(null!==o&&this.controller.levelEntity.isFriendlyEntity(o.type)){var n=this.facing,a=new r(this,function(){},function(){o.pushBack(a,n,250)},o.identifier);o.queue.startPushHighPriorityCommands(),o.addCommand(a),o.queue.endPushHighPriorityCommands()}this.controller.delayPlayerMoveBy(200,400,function(){e.succeeded()})}},{key:"collectItems",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position,t=this.controller.levelView.collectibleItems,i=0;i<t.length;i++){var n=o(t[i],4),a=n[0],r=n[1],l=n[2],c=n[3];if(null===a)t.splice(i,1);else{var h=this.controller.levelModel.spritePositionToIndex(r,new s(a.x,a.y));s.absoluteDistanceSquare(e,h)<c&&(this.controller.levelView.playItemAcquireAnimation(this.position,this.facing,a,function(){},l),t.splice(i,1))}}}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.healthPoint--,this.healthPoint>0?(this.controller.levelView.playScaledSpeed(this.getAnimationManager(),"hurt"+i),e.succeeded()):(this.getAnimationManager().stop(null,!0),this.controller.levelView.playFailureAnimation(this.position,this.facing,this.isOnBlock,function(){e.failed(),t.controller.handleEndState(!1)}))}},{key:"canTriggerPressurePlates",value:function(){return!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(4);e.exports=function(e){function t(e,i,o,n,a,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,"PlayerAgent",o,n,s));return l.offset=[-16,-15],l.name=a,l.isOnBlock=r,l.inventory={},l.movementState=-1,l.moveDelayMin=20,l.moveDelayMax=150,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"canPlaceBlockOver",value:function(e,t){var i={canPlace:!1,plane:""};return t.getIsLiquid()?e.getIsPlaceableInLiquid()&&(i.canPlace=!0,i.plane="groundPlane"):e.isWalkable&&(i.canPlace=!0,i.plane="actionPlane"),i}},{key:"canPlaceBlock",value:function(e){return e.isEmpty}},{key:"canMoveThrough",value:function(){return!0}},{key:"getSortOrderOffset",value:function(){return function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getSortOrderOffset",this).call(this)-1}},{key:"updateMovement",value:function(){var e=this;if(this.controller.attemptRunning&&this.controller.getIsDirectPlayerControl()){var t=this.queue.isFinished()||!this.queue.isStarted(),i=-1!==this.movementState,o=this.queue.currentCommand&&0===this.queue.getLength(),n=+new Date-this.lastMovement;if((t||o&&n>300)&&i)if(this.movementState>=0){var r=this.movementState,s=new a(this,function(){},function(){e.lastMovement=+new Date,e.controller.moveDirection(s,r)},this.identifier);this.addCommand(s)}else{var l=new a(this,function(){},function(){e.lastMovement=+new Date,e.controller.use(l)},this.identifier);this.addCommand(l)}}}},{key:"doMove",value:function(e,t){var i=this,o=void 0,n=this.controller.levelModel,a=this.controller.levelView,r=this.isOnBlock,s=this.position;n["move"+t](this);var l=r&&r!==this.isOnBlock;o=this.isOnBlock||l?n.actionPlane.getBlockAt(this.position).blockType:n.groundPlane.getBlockAt(this.position).blockType,a["playMove"+t+"Animation"](this,s,this.facing,l,this.isOnBlock,o,function(){a.playIdleAnimation(i.position,i.facing,i.isOnBlock,i),i.controller.delayPlayerMoveBy(i.moveDelayMin,i.moveDelayMax,function(){e.succeeded()})}),this.updateHidingTree(),this.updateHidingBlock(s)}},{key:"doMoveForward",value:function(e){this.doMove(e,"Forward")}},{key:"doMoveBackward",value:function(e){this.doMove(e,"Backward")}},{key:"bump",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel;t.playBumpAnimation(this.position,this.facing,!1,this);var o=this.controller.levelEntity.getEntityAt(i.getMoveForwardPosition(this));if(null!==o&&this.controller.levelEntity.isFriendlyEntity(o.type)){var n=this.facing,r=new a(this,function(){},function(){o.pushBack(r,n,250)},o.identifier);o.queue.startPushHighPriorityCommands(),o.addCommand(r),o.queue.endPushHighPriorityCommands()}this.controller.delayPlayerMoveBy(200,400,function(){e.succeeded()})}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.healthPoint--,this.healthPoint>0?(this.controller.levelView.playScaledSpeed(this.sprite.animations,"hurt"+i),e.succeeded()):(this.sprite.animations.stop(null,!0),this.controller.levelView.playFailureAnimation(this.position,this.facing,this.isOnBlock,function(){e.failed(),t.controller.handleEndState(!1)}))}},{key:"hasPermissionToWalk",value:function(e){return e.isWalkable}},{key:"canTriggerPressurePlates",value:function(){return!0}}]),t}()},function(e,t,i){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var a=i(6),r=i(1),s=i(3),l=i(19).createEvent,c=i(7).randomInt,h=i(10).addBobTween;window.PIXI&&(PIXI.canUseNewCanvasBlendModes=function(){return!0}),e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.audioPlayer=t.audioPlayer,this.game=t.game,this.baseShading=null,this.prismarinePhase=0,this.uniforms={time:{type:"1f",value:0},surface:{type:"sampler2D",value:null},tint:{type:"4fv",value:[67/255,213/255,238/255,1]},x:{type:"1f",value:0},y:{type:"1f",value:0}},this.waveShader=new Phaser.Filter(this.game,this.uniforms,["\n      precision lowp float;\n      varying vec2 vTextureCoord;\n      uniform sampler2D uSampler;\n      uniform sampler2D surface;\n      uniform float time;\n      uniform float x;\n      uniform float y;\n      uniform vec4 tint;\n\n      float overlay(float source, float dest) {\n        return dest > 0.5 ? (2.0 * dest * source) : (1.0 - 2.0 * (1.0 - dest) * (1.0 - source));\n      }\n\n      vec4 overlay(vec4 source, vec4 dest) {\n        return vec4(overlay(source.r, dest.r), overlay(source.g, dest.g), overlay(source.b, dest.b), 1.0);\n      }\n\n      void main(void) {\n        vec2 relativeCoord = vTextureCoord + vec2(x * 0.9, -y * 0.9);\n        float offsetA = sin(relativeCoord.y * 31.0 + time / 18.0) * 0.0014;\n        float offsetB = sin(relativeCoord.y * 57.0 + time / 18.0) * 0.0007;\n        vec4 base = texture2D(uSampler, vTextureCoord + vec2(0.0, offsetA + offsetB));\n        float frame = mod(floor(time / 5.0), 31.0);\n        float surfaceOffset = 0.0; //sin(time / 57.0) * 0.01 + sin(time / 31.0) * 0.005;\n        vec4 surface = texture2D(\n          surface,\n          vec2(mod(relativeCoord.x * 2.0, 1.0),\n          mod((-relativeCoord.y * 2.0 + frame + surfaceOffset) / 32.0, 1.0))\n        );\n        gl_FragColor = mix(mix(overlay(base, surface), base, 0.5), tint, 0.3);\n      }\n    "]),this.player=null,this.agent=null,this.selectionIndicator=null,this.groundGroup=null,this.shadingGroup=null,this.actionGroup=null,this.fluffGroup=null,this.fowGroup=null,this.collectibleItems=[],this.trees=[],this.miniBlocks={bed:"bed",boat:"boat",bookEnchanted:"book_enchanted",bricks:"bricks",bucketEmpty:"bucket_empty",bucketLava:"bucket_lava",milk:"bucket_milk",bucketWater:"bucket_water",cactus:"cactus",carrots:"carrot",chest:"chest",clay:"clay_ball",coal:"coal",dirtCoarse:"coarse_dirt",cobblestone:"cobblestone",compass:"compass",blackConcrete:"concrete_black",blueConcrete:"concrete_blue",brownConcrete:"concrete_brown",blackConcretePowder:"concrete_powder_black",blueConcretePowder:"concrete_powder_blue",brownConcretePowder:"concrete_powder_brown",deadbush:"deadbush",diamond:"diamond",axeDiamond:"diamond_axe",pickaxeDiamond:"diamond_pickaxe",shovelDiamond:"diamond_shovel",dirt:"dirt",door:"door",doorIron:"door_iron",egg:"egg",emerald:"emerald",flint:"flint",flintAndSteel:"flint_and_steel",daisy:"flower_daisy",dandelion:"flower_dandelion",poppy:"flower_rose",glowstoneDust:"glowstone_dust",ingotGold:"gold_ingot",gravel:"gravel",gunPowder:"gunpowder",hardenedClay:"hardend_clay",hardenedClayBlack:"hardened_clay_stained_black",hardenedClayBlue:"hardened_clay_stained_blue",hardenedClayBrown:"hardened_clay_stained_brown",hardenedClayCyan:"hardened_clay_stained_cyan",hardenedClayGray:"hardened_clay_stained_gray",hardenedClayGreen:"hardened_clay_stained_green",hardenedClayLightBlue:"hardened_clay_stained_light_blue",hardenedClayLime:"hardened_clay_stained_lime",hardenedClayMagenta:"hardened_clay_stained_magenta",hardenedClayOrange:"hardened_clay_stained_orange",hardenedClayPink:"hardened_clay_stained_pink",hardenedClayPurple:"hardened_clay_stained_purple",hardenedClayRed:"hardened_clay_stained_red",hardenedClaySilver:"hardened_clay_stained_silver",hardenedClayWhite:"hardened_clay_stained_white",hardenedClayYellow:"hardened_clay_stained_yellow",heartofthesea:"heartofthesea_closed",ingotIron:"iron_ingot",lapisLazuli:"lapis_lazuli",logAcacia:"log_acacia",logBirch:"log_birch",logJungle:"log_jungle",logOak:"log_oak",logSpruce:"log_spruce",mapEmpty:"map_empty",minecart:"minecart_normal",nautilus:"nautilus",netherbrick:"netherbrick",netherrack:"netherrack",obsidian:"obsidian",piston:"piston",planksAcacia:"planks_acacia",planksBirch:"planks_birch",planksJungle:"planks_jungle",planksOak:"planks_oak",planksSpruce:"planks_spruce",potato:"potato",potion:"potion_bottle_drinkable",pressurePlateOak:"pressure_plate_oak",prismarine:"prismarine",quartzOre:"quartz",railGolden:"rail_golden",railNormal:"rail_normal",redstoneDust:"redstone_dust",redstoneTorch:"redstone_torch",reeds:"reeds",sand:"sand",sandstone:"sandstone",seaPickles:"sea_pickle",seedsWheat:"seeds_wheat",snow:"snow",snowBall:"snowball",tnt:"tnt",torch:"torch",turtle:"turtle",cropWheat:"wheat",wool_black:"wool_colored_black",wool_blue:"wool_colored_blue",wool_brown:"wool_colored_brown",wool_cyan:"wool_colored_cyan",wool_gray:"wool_colored_gray",wool_green:"wool_colored_green",wool_light_blue:"wool_colored_light_blue",wool_lime:"wool_colored_lime",wool_magenta:"wool_colored_magenta",wool_orange:"wool_colored_orange",wool_pink:"wool_colored_pink",wool_purple:"wool_colored_purple",wool_red:"wool_colored_red",wool_silver:"wool_colored_silver",wool:"wool_colored_white",wool_yellow:"wool_colored_yellow"},this.blocks={bedrock:["blocks","Bedrock",-13,0],bricks:["blocks","Bricks",-13,0],oreCoal:["blocks","Coal_Ore",-13,0],dirtCoarse:["blocks","Coarse_Dirt",-13,0],cobblestone:["blocks","Cobblestone",-13,0],oreDiamond:["blocks","Diamond_Ore",-13,0],dirt:["blocks","Dirt",-13,0],oreEmerald:["blocks","Emerald_Ore",-13,0],farmlandWet:["blocks","Farmland_Wet",-13,0],flowerDandelion:["blocks","Flower_Dandelion",-13,0],flowerOxeeye:["blocks","Flower_Oxeeye",-13,0],flowerRose:["blocks","Flower_Rose",-13,0],glass:["blocks","Glass",-13,0],oreGold:["blocks","Gold_Ore",-13,0],grass:["blocks","Grass",-13,0],gravel:["blocks","Gravel",-13,0],oreIron:["blocks","Iron_Ore",-13,0],oreLapis:["blocks","Lapis_Ore",-13,0],lava:["blocks","Lava_0",-13,0],logAcacia:["blocks","Log_Acacia",-13,0],logBirch:["blocks","Log_Birch",-13,0],logJungle:["blocks","Log_Jungle",-13,0],logOak:["blocks","Log_Oak",-13,0],logSpruce:["blocks","Log_Spruce",-13,0],logSpruceSnowy:["blocks","Log_Spruce",-13,0],obsidian:["blocks","Obsidian",-13,0],planksAcacia:["blocks","Planks_Acacia",-13,0],planksBirch:["blocks","Planks_Birch",-13,0],planksJungle:["blocks","Planks_Jungle",-13,0],planksOak:["blocks","Planks_Oak",-13,0],planksSpruce:["blocks","Planks_Spruce",-13,0],oreRedstone:["blocks","Redstone_Ore",-13,0],sand:["blocks","Sand",-13,0],sandstone:["blocks","Sandstone",-13,0],stone:["blocks","Stone",-13,0],tnt:["tnt","TNTexplosion0",-80,-58],water:["blocks","Water_0",-13,0],wool:["blocks","Wool_White",-13,0],wool_orange:["blocks","Wool_Orange",-13,0],wool_black:["blocks","Wool_Black",-13,0],wool_blue:["blocks","Wool_Blue",-13,0],wool_brown:["blocks","Wool_Brown",-13,0],wool_cyan:["blocks","Wool_Cyan",-13,0],wool_gray:["blocks","Wool_Gray",-13,0],wool_green:["blocks","Wool_Green",-13,0],wool_light_blue:["blocks","Wool_LightBlue",-13,0],wool_lime:["blocks","Wool_Lime",-13,0],wool_magenta:["blocks","Wool_Magenta",-13,0],wool_pink:["blocks","Wool_Pink",-13,0],wool_purple:["blocks","Wool_Purple",-13,0],wool_red:["blocks","Wool_Red",-13,0],wool_silver:["blocks","Wool_Silver",-13,0],wool_yellow:["blocks","Wool_Yellow",-13,0],leavesAcacia:["leavesAcacia","Leaves_Acacia0.png",-100,0],leavesBirch:["leavesBirch","Leaves_Birch0.png",-100,0],leavesJungle:["leavesJungle","Leaves_Jungle0.png",-100,0],leavesOak:["leavesOak","Leaves_Oak0.png",-100,0],leavesSpruce:["leavesSpruce","Leaves_Spruce0.png",-100,0],leavesSpruceSnowy:["leavesSpruceSnowy","Leaves_SpruceSnowy0.png",-100,36],watering:["blocks","Water_0",-13,0],cropWheat:["blocks","Wheat0",-13,0],torch:["torch","Torch0",-13,0],tallGrass:["blocks","TallGrass",-13,0],lavaPop:["lavaPop","LavaPop01",-13,0],redstoneSparkle:["redstoneSparkle","redstone_sparkle1.png",7,23],fire:["fire","",-11,135],bubbles:["bubbles","",-11,135],explosion:["explosion","",-70,60],door:["door","",-12,-15],doorIron:["doorIron","",-12,-15],rails:["blocks","Rails_Vertical",-13,-0],railsNorthEast:["blocks","Rails_BottomLeft",-13,0],railsNorthWest:["blocks","Rails_BottomRight",-13,0],railsEast:["blocks","Rails_Horizontal",-13,0],railsWest:["blocks","Rails_Horizontal",-13,0],railsEastWest:["blocks","Rails_Horizontal",-13,0],railsSouthEast:["blocks","Rails_TopLeft",-13,0],railsSouthWest:["blocks","Rails_TopRight",-13,0],railsNorth:["blocks","Rails_Vertical",-13,-0],railsSouth:["blocks","Rails_Vertical",-13,-0],railsNorthSouth:["blocks","Rails_Vertical",-13,-0],railsUnpowered:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredNorth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredSouth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredNorthSouth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredEast:["blocks","Rails_UnpoweredHorizontal",-13,0],railsUnpoweredWest:["blocks","Rails_UnpoweredHorizontal",-13,0],railsUnpoweredEastWest:["blocks","Rails_UnpoweredHorizontal",-13,0],railsPowered:["blocks","Rails_PoweredVertical",-13,0],railsPoweredNorth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredSouth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredNorthSouth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredEast:["blocks","Rails_PoweredHorizontal",-13,0],railsPoweredWest:["blocks","Rails_PoweredHorizontal",-13,0],railsPoweredEastWest:["blocks","Rails_PoweredHorizontal",-13,0],railsRedstoneTorch:["blocks","Rails_RedstoneTorch",-12,9],redstoneWire:["blocks","redstone_dust_dot_off",-13,0],redstoneWireHorizontal:["blocks","redstone_dust_line_h_off",-13,0],redstoneWireVertical:["blocks","redstone_dust_line_v_off",-13,0],redstoneWireUpRight:["blocks","redstone_dust_corner_BottomLeft_off",-13,0],redstoneWireUpLeft:["blocks","redstone_dust_corner_BottomRight_off",-13,0],redstoneWireDownRight:["blocks","redstone_dust_corner_TopLeft_off",-13,0],redstoneWireDownLeft:["blocks","redstone_dust_corner_TopRight_off",-13,0],redstoneWireTUp:["blocks","redstone_dust_cross_up_off",-13,0],redstoneWireTDown:["blocks","redstone_dust_cross_down_off",-13,0],redstoneWireTLeft:["blocks","redstone_dust_cross_left_off",-13,0],redstoneWireTRight:["blocks","redstone_dust_cross_right_off",-13,0],redstoneWireCross:["blocks","redstone_dust_cross_off",-13,0],redstoneWireOn:["blocks","redstone_dust_dot",-13,0],redstoneWireHorizontalOn:["blocks","redstone_dust_line_h",-13,0],redstoneWireVerticalOn:["blocks","redstone_dust_line_v",-13,0],redstoneWireUpRightOn:["blocks","redstone_dust_corner_BottomLeft",-13,0],redstoneWireUpLeftOn:["blocks","redstone_dust_corner_BottomRight",-13,0],redstoneWireDownRightOn:["blocks","redstone_dust_corner_TopLeft",-13,0],redstoneWireDownLeftOn:["blocks","redstone_dust_corner_TopRight",-13,0],redstoneWireTUpOn:["blocks","redstone_dust_cross_up",-13,0],redstoneWireTDownOn:["blocks","redstone_dust_cross_down",-13,0],redstoneWireTLeftOn:["blocks","redstone_dust_cross_left",-13,0],redstoneWireTRightOn:["blocks","redstone_dust_cross_right",-13,0],redstoneWireCrossOn:["blocks","redstone_dust_cross",-13,0],pressurePlateUp:["blocks","PressurePlate_Up",-13,0],pressurePlateDown:["blocks","PressurePlate_Down",-13,0],pistonUp:["blocks","piston_up",-13,0],pistonDown:["blocks","piston_down",-13,0],pistonLeft:["blocks","piston_left",-13,0],pistonRight:["blocks","piston_right",-13,0],pistonUpOn:["blocks","piston_base_up",-26,-13],pistonDownOn:["blocks","piston_base_down",-26,-13],pistonLeftOn:["blocks","piston_base_left",-26,-13],pistonRightOn:["blocks","piston_base_right",-26,-13],pistonArmLeft:["blocks","piston_arm_left",-26,-13],pistonArmRight:["blocks","piston_arm_right",-26,-13],pistonArmUp:["blocks","piston_arm_up",-26,-13],pistonArmDown:["blocks","piston_arm_down",-26,-13],pistonUpSticky:["blocks","piston_up",-13,0],pistonDownSticky:["blocks","piston_down_sticky",-13,0],pistonLeftSticky:["blocks","piston_left",-13,0],pistonRightSticky:["blocks","piston_right",-13,0],pistonUpOnSticky:["blocks","piston_base_up",-26,-13],pistonDownOnSticky:["blocks","piston_base_down_sticky",-26,-13],pistonLeftOnSticky:["blocks","piston_base_left",-26,-13],pistonRightOnSticky:["blocks","piston_base_right",-26,-13],pistonArmLeftSticky:["blocks","piston_arm_left",-26,-13],pistonArmRightSticky:["blocks","piston_arm_right",-26,-13],pistonArmUpSticky:["blocks","piston_arm_up",-26,-13],pistonArmDownSticky:["blocks","piston_arm_down_sticky",-26,-13],cactus:["blocks","cactus",-13,0],deadBush:["blocks","dead_bush",-13,0],glowstone:["blocks","glowstone",-13,0],grassPath:["blocks","grass_path",-13,0],ice:["blocks","ice",-13,0],netherrack:["blocks","netherrack",-13,0],netherBrick:["blocks","nether_brick",-13,0],quartzOre:["blocks","quartz_ore",-13,0],snow:["blocks","snow",-13,0],snowyGrass:["blocks","snowy_grass",-13,0],topSnow:["blocks","top_snow",-13,0],sandDeep:["blocks","Sand_Deep",-13,0],gravelDeep:["blocks","Gravel_Deep",-13,0],reeds:["blocks","Reeds",-13,-18],Nether_Portal:["blocks","NetherPortal1",0,-58],bedFoot:["blocks","Bed_Foot",-13,0],bedHead:["blocks","Bed_Head",-13,10],clay:["blocks","Clay",-13,0],glassBlack:["blocks","Glass_Black",-13,0],glassBlue:["blocks","Glass_Blue",-13,0],glassBrown:["blocks","Glass_Brown",-13,0],glassCyan:["blocks","Glass_Cyan",-13,0],glassGray:["blocks","Glass_Gray",-13,0],glassGreen:["blocks","Glass_Green",-13,0],glassLightBlue:["blocks","Glass_LightBlue",-13,0],glassLime:["blocks","Glass_Lime",-13,0],glassMagenta:["blocks","Glass_Magenta",-13,0],glassOrange:["blocks","Glass_Orange",-13,0],glassPink:["blocks","Glass_Pink",-13,0],glassPurple:["blocks","Glass_Purple",-13,0],glassRed:["blocks","Glass_Red",-13,0],glassSilver:["blocks","Glass_Silver",-13,0],glassWhite:["blocks","Glass_White",-13,0],glassYellow:["blocks","Glass_Yellow",-13,0],terracotta:["blocks","Terracotta",-13,0],terracottaBlack:["blocks","Terracotta_Black",-13,0],terracottaBlue:["blocks","Terracotta_Blue",-13,0],terracottaBrown:["blocks","Terracotta_Brown",-13,0],terracottaCyan:["blocks","Terracotta_Cyan",-13,0],terracottaGray:["blocks","Terracotta_Gray",-13,0],terracottaGreen:["blocks","Terracotta_Green",-13,0],terracottaLightBlue:["blocks","Terracotta_LightBlue",-13,0],terracottaLime:["blocks","Terracotta_Lime",-13,0],terracottaMagenta:["blocks","Terracotta_Magenta",-13,0],terracottaOrange:["blocks","Terracotta_Orange",-13,0],terracottaPink:["blocks","Terracotta_Pink",-13,0],terracottaPurple:["blocks","Terracotta_Purple",-13,0],terracottaRed:["blocks","Terracotta_Red",-13,0],terracottaSilver:["blocks","Terracotta_Silver",-13,0],terracottaWhite:["blocks","Terracotta_White",-13,0],terracottaYellow:["blocks","Terracotta_Yellow",-13,0],strippedOak:["blocks","Stripped_Oak",-12,0],strippedDarkOak:["blocks","Stripped_Dark_Oak",-12,0],stoneBricks:["blocks","Stone_Bricks",-12,0],chiseledStoneBricks:["blocks","Stone_Bricks_Chisled",-12,0],mossyStoneBricks:["blocks","Stone_Bricks_Mossy",-12,0],crackedStoneBricks:["blocks","Stone_Bricks_Cracked",-12,0],magmaBlock:["blocks","Magma_Block0",-12,0],blueCoralBlock:["blocks","Coral_Block_Blue",-12,0],pinkCoralBlock:["blocks","Coral_Block_Pink",-12,0],magentaCoralBlock:["blocks","Coral_Block_Magenta",-12,0],redCoralBlock:["blocks","Coral_Block_Red",-12,0],yellowCoralBlock:["blocks","Coral_Block_Yellow",-12,0],deadCoralBlock:["blocks","Coral_Block_Dead_Blue",-12,0],blueDeadCoralBlock:["blocks","Coral_Block_Dead_Blue",-12,0],pinkDeadCoralBlock:["blocks","Coral_Block_Dead_Pink",-12,0],magentaDeadCoralBlock:["blocks","Coral_Block_Dead_Magenta",-12,0],readDeadCoralBlock:["blocks","Coral_Block_Dead_Red",-12,0],yellowDeadCoralBlock:["blocks","Coral_Block_Dead_Yellow",-12,0],prismarine:["blocks","Prismarine0",-12,0],prismarineBricks:["blocks","Prismarine_Bricks",-12,0],darkPrismarine:["blocks","Prismarine_Dark",-12,0],seaLantern:["blocks","Sea_Lantern0",-12,0],packedIce:["blocks","Ice_Packed",-12,0],blueIce:["blocks","Ice_Blue",-12,0],blackConcrete:["blocks","Concrete_Black",-12,0],seaGrass:["blocks","Seagrass0",-12,0],kelp:["blocks","KelpSingle_0",-12,0],polishedGranite:["blocks","Granite_Polished",-12,0],coralFanBlueBottom:["blocks","Coral_Fan_Blue_Bottom",-12,0],coralFanPinkBottom:["blocks","Coral_Fan_Pink_Bottom",-12,0],coralFanMagentaBottom:["blocks","Coral_Fan_Magenta_Bottom",-12,0],coralFanRedBottom:["blocks","Coral_Fan_Red_Bottom",-12,0],coralFanYellowFanBottom:["blocks","Coral_Fan_Yellow_Bottom",-12,0],coralFanBlueTop:["blocks","Coral_Fan_Blue_Top",-12,0],coralFanPinkTop:["blocks","Coral_Fan_Pink_Top",-12,0],coralFanMagentaTop:["blocks","Coral_Fan_Magenta_Top",-12,0],coralFanRedTop:["blocks","Coral_Fan_Red_Top",-12,0],coralFanYellowFanTop:["blocks","Coral_Fan_Yellow_Top",-12,0],coralFanBlueLeft:["blocks","Coral_Fan_Blue_Left",-12,0],coralFanPinkLeft:["blocks","Coral_Fan_Pink_Left",-12,0],coralFanMagentaLeft:["blocks","Coral_Fan_Magenta_Left",-12,0],coralFanRedLeft:["blocks","Coral_Fan_Red_Left",-12,0],coralFanYellowFanLeft:["blocks","Coral_Fan_Yellow_Left",-12,0],coralFanBlueRight:["blocks","Coral_Fan_Blue_Right",-12,0],coralFanPinkRight:["blocks","Coral_Fan_Pink_Right",-12,0],coralFanMagentaRight:["blocks","Coral_Fan_Magenta_Right",-12,0],coralFanRedRight:["blocks","Coral_Fan_Red_Right",-12,0],coralFanYellowFanRight:["blocks","Coral_Fan_Yellow_Right",-12,0],coralPlantBlue:["blocks","Coral_Plant_Blue",-12,0],coralPlantBlueDeep:["blocks","Coral_Plant_Blue_Sand",-12,0],coralPlantPink:["blocks","Coral_Plant_Pink",-12,0],coralPlantPinkDeep:["blocks","Coral_Plant_Pink_Sand",-12,0],coralPlantMagenta:["blocks","Coral_Plant_Magenta",-12,0],coralPlantMagentaDeep:["blocks","Coral_Plant_Magenta_Sand",-12,0],coralPlantRed:["blocks","Coral_Plant_Red",-12,0],coralPlantRedDeep:["blocks","Coral_Plant_Red_Sand",-12,0],coralPlantYellow:["blocks","Coral_Plant_Yellow",-12,0],coralPlantYellowDeep:["blocks","Coral_Plant_Yellow_Sand",-12,0],magmaUnderwater:["blocks","Magma_Bubble_Boat0",-12,4],magmaDeep:["blocks","Magma_Bubble_Deep0",-12,0],bubbleColumn:["blocks","Bubble_Column0",-12,0],conduit:["blocks","Conduit00",-13,-10],seaPickles:["blocks","SeaPickle",-10,-30],Chest:["blocks","Chest0",-12,-20],chest:["blocks","Chest0",-12,-20],invisible:["blocks","Invisible",0,0]},this.actionPlaneBlocks=[],this.toDestroy=[],this.resettableTweens=[],this.treeFluffTypes={treeAcacia:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2]],treeBirch:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]],treeJungle:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3],[1,-3]],treeOak:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[0,-3]],treeSpruce:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]],treeSpruceSnowy:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]]}}return n(e,[{key:"initPrismarine",value:function(){if(!this.prismarine){this.prismarine=this.controller.game.make.bitmapData(64,64,"prismarine"),this.prismarineFrames=[];for(var e=0;e<6;e++)this.prismarineFrames[e]=this.controller.game.make.sprite(0,0,"blocks","Prismarine"+e);this.prismarine.copy(this.prismarineFrames[0])}}},{key:"updatePrismarine",value:function(){var e=Math.floor(this.prismarinePhase),t=Math.ceil(this.prismarinePhase)%6,i=this.prismarinePhase-e;this.prismarine.copy(this.prismarineFrames[e]),i>0&&this.prismarine.copy(this.prismarineFrames[t],null,null,null,null,null,null,null,null,null,null,null,null,null,i)}},{key:"yToIndex",value:function(e){return this.controller.levelModel.yToIndex(e)}},{key:"create",value:function(e){if(this.createGroups(),this.reset(e),e.isUnderwater()){var t=this.game.add.sprite(0,0,"underwaterOverlay");t.visible=!1,t.smoothed=!1,this.uniforms.surface.value=t.texture}}},{key:"resetEntity",value:function(e){this.preparePlayerSprite(e.name,e),e.getAnimationManager().stop(),this.setPlayerPosition(e.position,e.isOnBlock,e),e.shouldUpdateSelectionIndicator()&&(this.setSelectionIndicatorPosition(e.position[0],e.position[1]),this.selectionIndicator.visible=!0),this.initWithIdleAnimation(e.position,e.facing,e.isOnBlock,e)}},{key:"reset",value:function(e){this.player=e.player,this.agent=e.agent,this.resettableTweens.forEach(function(e){e.stop(!1)}),this.resettableTweens.length=0,this.collectibleItems=[],this.trees=[],this.resetGroups(e),e.usePlayer&&(this.resetEntity(this.player),e.usingAgent&&this.resetEntity(this.agent)),e.isUnderwater()&&("cold"===e.getOceanType()&&(this.uniforms.tint.value=[57/255,56/255,201/255,1]),this.game.world.filters=[this.waveShader]),this.updateShadingGroup(e.shadingPlane),this.updateFowGroup(e.fowPlane),this.controller.followingPlayer()?(this.game.world.setBounds(0,0,40*e.planeWidth,40*e.planeHeight),this.game.camera.follow(this.player.sprite),this.game.world.scale.x=1,this.game.world.scale.y=1):this.game.world.setBounds(0,0,400,400)}},{key:"update",value:function(){for(var e=0;e<this.toDestroy.length;++e)this.toDestroy[e].destroy();this.toDestroy=[],this.prismarine&&(this.prismarinePhase=(this.prismarinePhase+this.controller.originalFpsToScaled(.015))%6,this.updatePrismarine())}},{key:"render",value:function(){this.actionGroup.sort("sortOrder"),this.fluffGroup.sort("z");var e=this.game.camera.view;this.uniforms.x.value=e.x/e.width,this.uniforms.y.value=e.y/e.height,this.uniforms.time.value++}},{key:"scaleShowWholeWorld",value:function(e){var t=this.controller.scaleFromOriginal(),i=o(t,2),n=i[0],a=i[1],r=this.addResettableTween(this.game.world.scale).to({x:1/n,y:1/a},1e3,Phaser.Easing.Exponential.Out);this.game.camera.unfollow();var s=this.addResettableTween(this.game.camera).to({x:0,y:0},1e3,Phaser.Easing.Exponential.Out);r.onComplete.addOnce(function(){e()}),s.start(),r.start()}},{key:"getDirectionName",value:function(e){return"_"+r.directionToRelative(e).toLowerCase()}},{key:"playDoorAnimation",value:function(e,t,i){var o=this.yToIndex(e[1])+e[0],n=this.actionPlaneBlocks[o],a=t?"open":"close",r=this.playScaledSpeed(n.animations,a);this.onAnimationEnd(r,function(){r.updateCurrentFrame(),i()})}},{key:"playOpenConduitAnimation",value:function(e){var t=this,i=this.yToIndex(e[1])+e[0],o=this.actionPlaneBlocks[i],n=this.playScaledSpeed(o.animations,"activation");this.onAnimationEnd(n,function(){t.controller.levelModel.actionPlane.getBlockAt(e).isEmissive=!0,t.controller.updateShadingPlane(),t.controller.updateFowPlane(),t.playScaledSpeed(o.animations,"open")})}},{key:"playCloseConduitAnimation",value:function(e){var t=this,i=this.yToIndex(e[1])+e[0],o=this.actionPlaneBlocks[i],n=this.playScaledSpeed(o.animations,"deactivation");this.onAnimationEnd(n,function(){t.controller.levelModel.actionPlane.getBlockAt(e).isEmissive=!1,t.controller.updateShadingPlane(),t.controller.updateFowPlane()})}},{key:"playOpenChestAnimation",value:function(e){var t=this,i=this.yToIndex(e[1])+e[0],o=this.actionPlaneBlocks[i],n=this.playScaledSpeed(o.animations,"open");this.onAnimationEnd(n,function(){var i=t.getTreasureTypeFromChest(t.controller.levelModel.actionPlane.getBlockAt(e));i&&t.createMiniBlock(e[0],e[1],i,{collectibleDistance:-1,xOffsetRange:0,yOffsetRange:0,isOnBlock:!0})})}},{key:"getTreasureTypeFromChest",value:function(e){return e.blockType.substring(0,e.blockType.length-5)}},{key:"playPlayerAnimation",value:function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player,n=this.getDirectionName(i);o.sprite.sortOrder=this.yToIndex(t[1])+o.getSortOrderOffset();var a=e+n;return this.playScaledSpeed(o.getAnimationManager(),a)}},{key:"playIdleAnimation",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player,n=this.controller.levelModel.isUnderwater()?"walk":"idle";this.playPlayerAnimation(n,e,t,i,o)}},{key:"initWithIdleAnimation",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player;this.playPlayerAnimation("idle",e,t,i,o)}},{key:"playSuccessAnimation",value:function(e,t,i,o){var n=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.controller.delayBy(250,function(){n.audioPlayer.play("success"),n.onAnimationEnd(n.playPlayerAnimation("celebrate",e,t,i,a),function(){o()})})}},{key:"playFailureAnimation",value:function(e,t,i,o){var n=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.controller.delayBy(500,function(){n.audioPlayer.play("failure"),n.onAnimationEnd(n.playPlayerAnimation("fail",e,t,i,a),function(){n.controller.delayBy(800,o)})})}},{key:"playBumpAnimation",value:function(e,t,i){var o=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player,a=this.playPlayerAnimation("bump",e,t,i,n);return a.onComplete.add(function(){o.playIdleAnimation(e,t,i,n)}),a}},{key:"playDrownFailureAnimation",value:function(e,t,i,n){var a,r;this.playPlayerAnimation("fail",e,t,i),this.createBlock(this.fluffGroup,e[0],e[1],"bubbles"),a=this.fluffGroup.create(0,0,"finishOverlay");var s=this.controller.scaleFromOriginal(),l=o(s,2),c=l[0],h=l[1];a.scale.x=c,a.scale.y=h,a.alpha=0,a.tint=3296255,(r=this.addResettableTween(a).to({alpha:.5},200,Phaser.Easing.Linear.None)).onComplete.add(function(){n()}),r.start()}},{key:"playBurnInLavaAnimation",value:function(e,t,i,n){var a,r;this.playPlayerAnimation("jumpUp",e,t,i),this.createBlock(this.fluffGroup,e[0],e[1],"fire"),a=this.fluffGroup.create(0,0,"finishOverlay");var s=this.controller.scaleFromOriginal(),l=o(s,2),c=l[0],h=l[1];a.scale.x=c,a.scale.y=h,a.alpha=0,a.tint=13719565,(r=this.addResettableTween(a).to({alpha:.5},200,Phaser.Easing.Linear.None)).onComplete.add(function(){n()}),r.start()}},{key:"playDestroyTntAnimation",value:function(e,t,i,o,n,a){var r,s,l=this;if(0!==o.length){for(var c in this.audioPlayer.play("fuse"),o)r=this.actionPlaneBlocks[this.coordinatesToIndex(o[c])],s=this.playScaledSpeed(r.animations,"explode");this.onAnimationEnd(s,function(){l.audioPlayer.play("explode"),a()})}else a()}},{key:"playCreeperExplodeAnimation",value:function(e,t,i,o,n){var a=this;this.controller.delayBy(180,function(){a.playPlayerAnimation("bump",e,t,!1).onComplete.add(function(){a.audioPlayer.play("fuse"),a.playExplodingCreeperAnimation(e,t,i,o,n,a),a.controller.delayBy(200,function(){a.onAnimationLoopOnce(a.playPlayerAnimation("jumpUp",e,t,!1),function(){a.playIdleAnimation(e,t,o)})})})})}},{key:"flashEntity",value:function(e){return this.flashSpriteToWhite(e.sprite)}},{key:"flashBlock",value:function(e){var t=this.yToIndex(e[1])+e[0],i=this.actionPlaneBlocks[t];return this.flashSpriteToWhite(i)}},{key:"flashSpriteToWhite",value:function(e){var t=this.game.add.bitmapData(e.width,e.height);t.fill(255,255,255,255);var i=this.game.add.bitmapData(e.width,e.height),o={x:0,y:0,width:e.width,height:e.height},n={x:0,y:0,width:e.texture.crop.width,height:e.texture.crop.height};i.alphaMask(t,e,o,n);var a=e.addChild(this.game.make.sprite(0,0,i.texture));a.alpha=0;var r=0,s={alpha:1},l={alpha:0},c=this.game.add.tween(a).to(s,60,Phaser.Easing.Linear.None),h=this.game.add.tween(a).to(l,60,Phaser.Easing.Linear.None);r=120,c.chain(h);for(var u=h,d=0;d<2;d++){var p=this.game.add.tween(a).to(l,240,Phaser.Easing.Linear.None),f=this.game.add.tween(a).to(s,60,Phaser.Easing.Linear.None),y=this.game.add.tween(a).to(l,60,Phaser.Easing.Linear.None);r+=360,u.chain(p),p.chain(f),f.chain(y),u=y}return u.onComplete.add(function(){a.destroy()}),c.start(),2*r}},{key:"playExplodingCreeperAnimation",value:function(e,t,i,o,n){var a=this,r=this.yToIndex(i[1])+i[0],s=this.actionPlaneBlocks[r],l=s.animations.getAnimation("explode");l.onComplete.add(function(){s.kill(),a.playExplosionAnimation(e,t,i,o,function(){a.controller.delayBy(100,function(){a.playFailureAnimation(e,t,!1,n)})},!1),a.audioPlayer.play("explode"),a.playExplosionCloudAnimation(i)}),l.play()}},{key:"playExplosionCloudAnimation",value:function(e){this.createBlock(this.fluffGroup,e[0],e[1],"explosion")}},{key:"coordinatesToIndex",value:function(e){return this.yToIndex(e[1])+e[0]}},{key:"playMinecartTurnAnimation",value:function(e,t,i,o,n){var a=t?r.North:r.South;return this.playPlayerAnimation("mineCart_turn"+n,e,a,!1)}},{key:"playMinecartMoveForwardAnimation",value:function(e,t,i,o,n,a){var r;return this.audioPlayer.play("minecart"),this.playPlayerAnimation("mineCart",e,t,!1),(r=this.addResettableTween(this.player.sprite).to(this.positionToScreen(n),a,Phaser.Easing.Linear.None)).start(),this.player.sprite.sortOrder=this.yToIndex(n[1])+10,r}},{key:"playMinecartAnimation",value:function(e,t){var i=this,o=new s(3,2);this.setPlayerPosition(o,e),this.player.facing=2;var n=this.playLevelEndAnimation(o,this.player.facing,e,t,!1);this.game.world.setBounds(0,0,440,400),this.game.camera.follow(this.player.sprite),n.onComplete.add(function(){i.playTrack(o,i.player.facing,e,i.player,t)})}},{key:"playTrack",value:function(e,t,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player,l=arguments[4];a.onTracks=!0;var c=this.controller.levelModel.actionPlane.getMinecartTrack(e,t),h=s.forward(a.position,t);if(a.getOffTrack||!c&&!this.isFirstTimeOnRails(e,h))return a.getOffTrack=!1,a.onTracks=!1,void(l&&l());if(void 0===c&&void 0===(c=this.controller.levelModel.actionPlane.getMinecartTrack(h,t)))return a.getOffTrack=!1,a.onTracks=!1,void(l&&l());var u=void 0,d=o(c,4),p=d[0],f=d[1],y=d[2],m=d[3];if(this.player.position=f,"turn"===p.substring(0,4)){u=p.substring(5);var v=t===r.North||y===r.North;this.onAnimationEnd(this.playMinecartTurnAnimation(e,v,i,l,u),function(){n.playTrack(f,y,i,a,l)})}else this.onAnimationEnd(this.playMinecartMoveForwardAnimation(e,t,i,l,f,m),function(){n.playTrack(f,y,i,a,l)})}},{key:"isFirstTimeOnRails",value:function(e,t){var i=this.controller.levelModel.actionPlane.getBlockAt(t),o=this.controller.levelModel.actionPlane.getBlockAt(e);return!(!i||!o||o.isRail||!i.isRail)}},{key:"addHouseBed",value:function(e){var t=e[1]-1;this.actionGroup.create(38*e[0],35*t,"bed").sortOrder=this.yToIndex(e[1])}},{key:"addDoor",value:function(e){var t,i=this.actionPlaneBlocks[this.coordinatesToIndex(e)];this.createActionPlaneBlock(e,"door"),t=this.createBlock(this.groundGroup,e[0],e[1],"wool_orange"),i.kill(),t.sortOrder=this.yToIndex(6)}},{key:"playSuccessHouseBuiltAnimation",value:function(e,t,i,o,n,a,r){var s=this;this.playLevelEndAnimation(e,t,i,function(){s.controller.delayBy(4e3,a)},!0).onComplete.add(function(){var e,t;s.audioPlayer.play("houseSuccess");for(var i=0;i<o.length;++i)e=o[i][1],t=o[i][2],s.createBlock(s.groundGroup,e,t,"wool_orange").sortOrder=s.yToIndex(t);s.addHouseBed(n[0]),s.addDoor(n[1]),s.groundGroup.sort("sortOrder"),r()})}},{key:"playLevelEndAnimation",value:function(e,t,i,n,a){var r,s,l,c=this;r=this.fluffGroup.create(0,0,"finishOverlay");var h=this.controller.scaleFromOriginal(),u=o(h,2),d=u[0],p=u[1];return r.scale.x=d,r.scale.y=p,r.alpha=0,s=this.tweenToWhite(r),l=this.tweenFromWhiteToClear(r),s.onComplete.add(function(){c.selectionIndicator.visible=!1,c.setPlayerPosition(e,i),l.start()}),a&&l.onComplete.add(function(){c.playSuccessAnimation(e,t,i,n)}),s.start(),s}},{key:"tweenFromWhiteToClear",value:function(e){return this.addResettableTween(e).to({alpha:0},700,Phaser.Easing.Linear.None)}},{key:"tweenToWhite",value:function(e){var t;return t=this.addResettableTween(e).to({alpha:1},300,Phaser.Easing.Linear.None),t}},{key:"playBlockSound",value:function(e){if("water"!==e&&"lava"!==e&&!this.controller.levelModel.isUnderwater()){var t=e.substring(0,3);"stone"===e||"cobblestone"===e||"bedrock"===e||"ore"===t||"bricks"===e?this.audioPlayer.play("stepStone"):"grass"===e||"dirt"===e||"dirtCoarse"===e||"wool_orange"===e||"wool"===e?this.audioPlayer.play("stepGrass"):"gravel"===e?this.audioPlayer.play("stepGravel"):"farmlandWet"===e?this.audioPlayer.play("stepFarmland"):this.audioPlayer.play("stepWood")}}},{key:"playMoveForwardAnimation",value:function(e,t,i,o,n,a,s){var l=e.position[1]+(i===r.North?1:0);this.playWalkAnimation(e,t,i,o,n,a,l,s)}},{key:"playMoveBackwardAnimation",value:function(e,t,i,o,n,a,s){var l=e.position[1]+(i===r.South?1:0);this.playWalkAnimation(e,t,i,o,n,a,l,s)}},{key:"playWalkAnimation",value:function(e,t,i,o,n,a,r,s){var l=this,c=void 0,h=e.position;this.playBlockSound(a),e.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(h[0],h[1]),o?c=this.playPlayerJumpDownVerticalAnimation(i,h,t):(this.playPlayerAnimation("walk",t,i,n,e),c=this.addResettableTween(e.sprite).to(this.positionToScreen(h,n,e),180,Phaser.Easing.Linear.None)),c.onUpdateCallback(function(t,i){i>=.75&&(e.sprite.sortOrder=l.yToIndex(r)+e.getSortOrderOffset(),t.onUpdateCallback(null))}),c.onComplete.add(function(){s()}),c.start()}},{key:"playPlayerJumpDownVerticalAnimation",value:function(e,t){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!this.controller.levelModel.isUnderwater()){var n="jumpDown"+this.getDirectionName(e);this.playScaledSpeed(this.player.getAnimationManager(),n)}var a=this.positionToScreen(o),r=this.positionToScreen(t),s=this.addResettableTween(this.player.sprite).to({x:[a.x,r.x,r.x],y:[a.y,r.y-50,r.y]},300,Phaser.Easing.Linear.None).interpolation(function(e,t){return Phaser.Math.bezierInterpolation(e,t)});return s.onComplete.addOnce(function(){i.audioPlayer.play("fall")}),s.start(),s}},{key:"playPlaceBlockAnimation",value:function(e,t,i,o,n,r){var s=this,l=this.yToIndex(e[1])+e[0];if(n.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(e[0],e[1]),n===this.agent||a.isWalkable(i))var c=this.playPlayerAnimation("punch",e,t,!1,n).onComplete.add(function(){c.detach(),r()});else{this.audioPlayer.play("placeBlock");var h=this.getDirectionName(t);""!==o&&this.playExplosionAnimation(e,t,e,o,function(){},!1),this.controller.levelModel.isUnderwater()||this.playScaledSpeed(this.player.getAnimationManager(),"jumpUp"+h);var u=this.addResettableTween(this.player.sprite).to({y:40*e[1]-55},125,Phaser.Easing.Cubic.EaseOut);u.onComplete.addOnce(function(){u=null,""!==o&&s.actionPlaneBlocks[l].kill(),r()}),u.start()}}},{key:"playPlaceBlockInFrontAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=arguments[2],o=arguments[3],n=arguments[4];this.setSelectionIndicatorPosition(o[0],o[1]),this.playPlayerAnimation("punch",t,i,!1,e).onComplete.addOnce(function(){n()})}},{key:"correctForShadowOverlay",value:function(e,t){e.startsWith("piston")&&(t.sortOrder-=.1)}},{key:"createActionPlaneBlock",value:function(e,t){var i=new a(t),o=this.yToIndex(e[1])+e[0];if(this.actionGroup.remove(this.actionPlaneBlocks[o]),this.groundGroup.remove(this.actionPlaneBlocks[o]),i.isEmpty)this.actionPlaneBlocks[o]=null;else{var n=void 0;if(i.getIsMiniblock())n=this.createMiniBlock(e[0],e[1],t,{collectibleDistance:1,xOffsetRange:10,yOffsetRange:10});else{var r=i.shouldRenderOnGroundPlane()?this.groundGroup:this.actionGroup,s=i.shouldRenderOnGroundPlane()?-.5:0;n=i.getIsChestblock()?this.createBlock(r,e[0],e[1]+s,"Chest"):this.createBlock(r,e[0],e[1]+s,t)}n&&(n.sortOrder=this.yToIndex(e[1]),this.correctForShadowOverlay(t,n)),this.actionPlaneBlocks[o]=n}}},{key:"playShearAnimation",value:function(e,t,i,o,n){var a=this,r=this.yToIndex(i[1])+i[0],s=this.actionPlaneBlocks[r];s.animations.stop(null,!0),this.onAnimationLoopOnce(this.playScaledSpeed(s.animations,"used"),function(){a.playScaledSpeed(s.animations,"face")}),this.playExplosionAnimation(e,t,i,o,n,!0)}},{key:"playShearSheepAnimation",value:function(e,t,i,o,n){var a=this;this.setSelectionIndicatorPosition(i[0],i[1]),this.onAnimationEnd(this.playPlayerAnimation("punch",e,t,!1),function(){var r=a.yToIndex(i[1])+i[0],s=a.actionPlaneBlocks[r];s.animations.stop(null,!0),a.onAnimationLoopOnce(a.playScaledSpeed(s.animations,"used"),function(){a.playScaledSpeed(s.animations,"face")}),a.playExplosionAnimation(e,t,i,o,n,!0)})}},{key:"destroyBlockWithoutPlayerInteraction",value:function(e){var t=this,i=this.yToIndex(e[1])+e[0],o=this.actionPlaneBlocks[i],n=this.actionGroup.create(40*e[0]-12,40*e[1]-22,"destroyOverlay","destroy1");n.sortOrder=this.yToIndex(e[1])+2,this.onAnimationEnd(n.animations.add("destroy",Phaser.Animation.generateFrameNames("destroy",1,12,"",0),30,!1),function(){t.actionPlaneBlocks[i]=null,o.hasOwnProperty("onBlockDestroy")&&o.onBlockDestroy(o),o.kill(),n.kill(),t.toDestroy.push(o),t.toDestroy.push(n),t.audioPlayer.play("dig_wood1")}),this.playScaledSpeed(n.animations,"destroy")}},{key:"playDestroyBlockAnimation",value:function(e,t,i,o,n,a){n.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(i[0],i[1]);var r=void 0;r=n===this.agent||this.controller.levelModel.isUnderwater()?"punchDestroy":o.match(/(ore|stone|clay|bricks|bedrock)/)?"mine":"punchDestroy",this.playPlayerAnimation(r,e,t,!1,n),this.playMiningParticlesAnimation(t,i),this.playBlockDestroyOverlayAnimation(e,t,i,o,n,a)}},{key:"playPunchDestroyAirAnimation",value:function(e,t,i,o){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.playPunchAnimation(e,t,i,"punchDestroy",o,n)}},{key:"playPunchAirAnimation",value:function(e,t,i,o){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.playPunchAnimation(e,t,i,"punch",o,n)}},{key:"playPunchAnimation",value:function(e,t,i,o,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.player;a.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(i[0],i[1]),this.onAnimationEnd(this.playPlayerAnimation(o,e,t,!1,a),function(){n()})}},{key:"playBlockDestroyOverlayAnimation",value:function(e,t,i,o,n,r){var s=this,l=this.yToIndex(i[1])+i[0],c=this.actionPlaneBlocks[l],h=function(){c.hasOwnProperty("onBlockDestroy")&&c.onBlockDestroy(c),s.controller.levelModel.destroyBlockForward(n),s.controller.updateShadingPlane(),s.controller.updateFowPlane(),n.shouldUpdateSelectionIndicator()&&s.setSelectionIndicatorPosition(e[0],e[1]),s.audioPlayer.play("dig_wood1"),s.playExplosionAnimation(e,t,i,o,r,!0,n)};if(a.skipsDestructionOverlay(o))h();else{var u=this.actionGroup.create(40*i[0]-12,40*i[1]-22,"destroyOverlay","destroy1");if(a.isFlat(o)){var d=new Phaser.Rectangle(0,0,60,40);u.position.y+=20,u.crop(d)}u.sortOrder=this.yToIndex(i[1])+2,this.onAnimationEnd(u.animations.add("destroy",Phaser.Animation.generateFrameNames("destroy",1,12,"",0),30,!1),function(){u.kill(),s.toDestroy.push(u),h()}),this.playScaledSpeed(u.animations,"destroy")}}},{key:"playMiningParticlesAnimation",value:function(e,t){var i=this,o=[[24,-100,-80],[12,-120,-80],[0,-60,-80],[36,-80,-60]],n=this.getDirectionName(e),a="_left"===n?0:"_bottom"===n?1:"_right"===n?2:3,r=o[a][0],s=o[a][1],l=o[a][2],c=this.actionGroup.create(s+40*t[0],l+40*t[1],"miningParticles","MiningParticles"+r);c.sortOrder=this.yToIndex(t[1])+2,this.onAnimationEnd(c.animations.add("miningParticles",Phaser.Animation.generateFrameNames("MiningParticles",r,r+11,"",0),30,!1),function(){c.kill(),i.toDestroy.push(c)}),this.playScaledSpeed(c.animations,"miningParticles")}},{key:"playExplosionAnimation",value:function(e,t,i,o,n,a){var r=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.player,l=this.actionGroup.create(40*i[0]-36,40*i[1]-30,"blockExplode","BlockBreakParticle0");switch(o){case"treeAcacia":case"logAcacia":l.tint=7103834;break;case"treeBirch":case"logBirch":l.tint=14341836;break;case"treeJungle":case"logJungle":l.tint=6967089;break;case"treeOak":case"logOak":l.tint=6771249;break;case"treeSpruce":case"logSpruce":l.tint=4929827;break;case"planksAcacia":l.tint=12215095;break;case"planksBirch":l.tint=14142349;break;case"planksJungle":l.tint=12093284;break;case"planksOak":l.tint=11833434;break;case"planksSpruce":l.tint=8412726;break;case"stone":case"oreCoal":case"oreDiamond":case"oreIron":case"oreGold":case"oreEmerald":case"oreRedstone":l.tint=13027014;break;case"grass":case"cropWheat":l.tint=6131491;break;case"dirt":l.tint=9068083;break;case"redstoneWireOn":case"redstoneWireHorizontalOn":case"redstoneWireVerticalOn":case"redstoneWireUpRightOn":case"redstoneWireUpLeftOn":case"redstoneWireDownRightOn":case"redstoneWireDownLeftOn":case"redstoneWireTUpOn":case"redstoneWireTDownOn":case"redstoneWireTLeftOn":case"redstoneWireTRightOn":case"redstoneWireCrossOn":l.tint=10028807;break;case"redstoneWire":case"redstoneWireHorizontal":case"redstoneWireVertical":case"redstoneWireUpRight":case"redstoneWireUpLeft":case"redstoneWireDownRight":case"redstoneWireDownLeft":case"redstoneWireTUp":case"redstoneWireTDown":case"redstoneWireTLeft":case"redstoneWireTRight":case"redstoneWireCross":l.tint=2687490}l.sortOrder=this.yToIndex(i[1])+2,this.onAnimationEnd(l.animations.add("explode",Phaser.Animation.generateFrameNames("BlockBreakParticle",0,7,"",0),30,!1),function(){l.kill(),r.toDestroy.push(l),a&&(r.controller.getIsDirectPlayerControl()||r.playPlayerAnimation("idle",e,t,!1,s),null!==n&&r.playItemDropAnimation(i,o,n))}),this.playScaledSpeed(l.animations,"explode"),this.controller.getIsDirectPlayerControl()^!a&&n&&n()}},{key:"playItemDropAnimation",value:function(e,t,i){var o=this,n=void 0;this.controller.getIsDirectPlayerControl()&&i?i():n=function(){var e=o.controller.levelModel.player;o.playItemAcquireAnimation(e.position,e.facing,a,i,t)};var a=this.createMiniBlock(e[0],e[1],t,{onComplete:n});a&&(a.sortOrder=this.yToIndex(e[1])+2)}},{key:"playScaledSpeed",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=e.getAnimation(t);if(null!==o){o.originalFps||(o.originalFps=1e3/o.delay);var n=this.controller.originalFpsToScaled(o.originalFps);return e.play(t,n*i)}console.log("can't find animation name : "+t)}},{key:"playItemAcquireAnimation",value:function(e,t,i,o,n){var a=this,r=this.positionToScreen(e),c=this.addResettableTween(i).to({x:r.x+20,y:r.y+20},200,Phaser.Easing.Linear.None);c.onComplete.add(function(){var t=s.equals(a.player.position,e);if(i.alive&&t){a.audioPlayer.play("collectedBlock"),a.player.inventory[n]=(a.player.inventory[n]||0)+1,i.kill(),a.toDestroy.push(i);var r=l("craftCollectibleCollected");r.blockType=n,window.dispatchEvent(r),o&&o()}else a.playItemAcquireAnimation(a.player.position,a.player.facing,i,o,n)}),c.start()}},{key:"positionToScreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,o=e[0],n=e[1];return{x:i.offset[0]+40*o,y:i.offset[1]+(t?-23:0)+40*n}}},{key:"setPlayerPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,o=this.positionToScreen(e,t,i);i.sprite.x=o.x,i.sprite.y=o.y,i.sprite.sortOrder=this.yToIndex(o.y)+i.getSortOrderOffset()}},{key:"setSelectionIndicatorPosition",value:function(e,t){this.selectionIndicator.x=40*e-12,this.selectionIndicator.y=40*t-12}},{key:"drawHintPath",value:function(e){this.hintGroup.removeAll(!0);var t=this.game.world.bounds,i=this.game.add.bitmapData(t.width,t.height),n=i.context;n.setLineDash([10,10]),n.lineDashOffset=5,n.lineWidth=2,n.strokeStyle="#fff",n.shadowColor="#000",n.shadowOffsetY=7,n.shadowBlur=4,n.beginPath(),e.forEach(function(e){var t=o(e,2),i=t[0],a=t[1];n.lineTo(40*i+19,40*a+19)}),n.stroke();var a=this.hintGroup.create(0,0,i);a.alpha=0,this.addResettableTween(a).to({alpha:1},830,Phaser.Easing.Quadratic.Out).to({alpha:.4},500,Phaser.Easing.Quadratic.InOut,!0,0,-1,!0)}},{key:"createGroups",value:function(){this.groundGroup=this.game.add.group(),this.groundGroup.yOffset=-2,this.shadingGroup=this.game.add.group(),this.shadingGroup.yOffset=-2,this.hintGroup=this.game.add.group(),this.actionGroup=this.game.add.group(),this.actionGroup.yOffset=-22,this.fluffGroup=this.game.add.group(),this.fluffGroup.yOffset=-160,this.fowGroup=this.game.add.group(),this.fowGroup.yOffset=0}},{key:"resetGroups",value:function(e){var t,i,o;for(this.groundGroup.removeAll(!0),this.actionGroup.removeAll(!0),this.hintGroup.removeAll(!0),this.fluffGroup.removeAll(!0),this.shadingGroup.removeAll(!0),this.fowGroup.removeAll(!0),this.baseShading=this.game.add.group(),this.actionPlaneBlocks=[],this.refreshGroundGroup(),o=0;o<this.controller.levelModel.planeHeight;++o)for(i=0;i<this.controller.levelModel.planeWidth;++i){var n=new s(i,o);t=null;var a=e.groundDecorationPlane.getBlockAt(n);a.isEmpty||(t=this.createBlock(this.actionGroup,i,o,a.blockType))&&(t.sortOrder=this.yToIndex(o));var r=e.actionPlane.getBlockAt(n);r.shouldRenderOnGroundPlane()||this.createActionPlaneBlock(n,r.blockType)}for(o=0;o<this.controller.levelModel.planeHeight;++o)for(i=0;i<this.controller.levelModel.planeWidth;++i){var l=new s(i,o);e.fluffPlane.getBlockAt(l).isEmpty||(t=this.createBlock(this.fluffGroup,i,o,e.fluffPlane.getBlockAt(l).blockType))}this.controller.levelModel.actionPlane.refreshRedstone(),this.controller.levelModel.actionPlane.resolveConduitState(),this.refreshActionGroup(this.controller.levelModel.actionPlane.getAllPositions())}},{key:"refreshGroundGroup",value:function(){this.groundGroup.removeAll(!0);for(var e=0;e<this.controller.levelModel.planeHeight;++e)for(var t=0;t<this.controller.levelModel.planeWidth;++t){var i=new s(t,e),o=this.controller.levelModel.groundPlane.getBlockAt(i),n=this.createBlock(this.groundGroup,t,e,o.blockType);n&&(n.sortOrder=this.yToIndex(e));var a=this.controller.levelModel.actionPlane.getBlockAt(i);a&&a.shouldRenderOnGroundPlane()&&this.createActionPlaneBlock(i,a.blockType)}}},{key:"refreshActionGroup",value:function(e){for(var t=this,i=0;i<e.length;++i){var o=s.south(e[i]);if(this.controller.levelModel.actionPlane.inBounds(o))""===this.controller.levelModel.actionPlane.getBlockAt(o).blockType||e.push(o)}e.forEach(function(e){if(e){var i=t.controller.levelModel.actionPlane.getBlockAt(e);if(i&&i.getIsDoor()||i&&i.getIsConduit()&&i.isActivatedConduit)return;if(i&&i.getIsMiniblock()||i&&i.getIsTree())return;if(i&&i.blockType)t.createActionPlaneBlock(e,i.blockType);else if(i){var o=t.coordinatesToIndex(e);t.actionGroup.remove(t.actionPlaneBlocks[o]),t.groundGroup.remove(t.actionPlaneBlocks[o])}}})}},{key:"updateShadingGroup",value:function(e){var t,i,o,n,a;for(this.shadingGroup.removeAll(),this.shadingGroup.add(this.baseShading),this.selectionIndicator&&this.shadingGroup.add(this.selectionIndicator),t=0;t<e.length;++t){a=(i=e[t]).atlas,o=40*i.x,n=40*i.y;var r=this.shadingGroup.create(o,n,a,i.type);"WaterAO"===a&&(r.tint=5592405)}}},{key:"updateFowGroup",value:function(e){var t,i,o,n;for(this.fowGroup.removeAll(),t=0;t<e.length;++t){var a=e[t];if(""!==a)n="undergroundFow",i=40*a.x-40,o=40*a.y-40,this.fowGroup.create(i,o,n,a.type).alpha=.8}}},{key:"playRandomPlayerIdle",value:function(e){var t,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;switch(t=this.getDirectionName(e),Math.trunc(4*Math.random())+1){case 1:i="idle";break;case 2:i="lookLeft";break;case 3:i="lookRight";break;case 4:i="lookAtCam"}i+=t,this.playScaledSpeed(o.getAnimationManager(),i)}},{key:"generatePlayerCelebrateFrames",value:function(){for(var e=[],t=0;t<6;++t)e.push("Player_001");return(e=(e=e.concat("Player_259")).concat("Player_260")).push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e}},{key:"generateFramesWithEndDelay",value:function(e,t,i,o,n,a){for(var r=Phaser.Animation.generateFrameNames(e,t,i,"",n),s=0;s<a;++s)r.push(o);return r}},{key:"generateReverseFrames",value:function(e,t,i,o,n){return Phaser.Animation.generateFrameNames(e,t,i,o,n).concat(Phaser.Animation.generateFrameNames(e,i-1,t,o,n))}},{key:"preparePlayerSprite",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;i.sprite=this.actionGroup.create(0,0),i.animationRig=this.actionGroup.create(0,0,"player"+e,"Player_121"),i.sprite.addChild(i.animationRig),this.controller.followingPlayer()&&i===this.player&&this.game.camera.follow(i.sprite),i.shouldUpdateSelectionIndicator()&&(this.selectionIndicator=this.shadingGroup.create(24,44,"selectionIndicator")),this.generateAnimations(r.South,0,i),this.generateAnimations(r.East,60,i),this.generateAnimations(r.North,120,i),this.generateAnimations(r.West,180,i);var n=void 0;if((n=this.generateFramesWithEndDelay("Player_",263,262,"Player_262",3,5)).push("Player_263"),i.addAnimation("lookAtCam_down",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.getAnimationManager(),"idlePause_down")}),(n=this.generateFramesWithEndDelay("Player_",270,269,"Player_269",3,5)).push("Player_270"),i.addAnimation("lookAtCam_right",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.getAnimationManager(),"idlePause_right")}),(n=this.generateFramesWithEndDelay("Player_",277,276,"Player_276",3,5)).push("Player_277"),i.addAnimation("lookAtCam_up",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.getAnimationManager(),"idlePause_up")}),(n=this.generateFramesWithEndDelay("Player_",284,283,"Player_283",3,5)).push("Player_284"),i.addAnimation("lookAtCam_left",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.getAnimationManager(),"idlePause_left")}),i.addAnimation("mine_down",Phaser.Animation.generateFrameNames("Player_",241,244,"",3),20,!0),i.addAnimation("mine_right",Phaser.Animation.generateFrameNames("Player_",245,248,"",3),20,!0),i.addAnimation("mine_up",Phaser.Animation.generateFrameNames("Player_",249,252,"",3),20,!0),i.addAnimation("mine_left",Phaser.Animation.generateFrameNames("Player_",253,256,"",3),20,!0),i.addAnimation("mineCart_down",Phaser.Animation.generateFrameNames("Minecart_",5,5,"",2),20,!1),i.addAnimation("mineCart_turnleft_down",Phaser.Animation.generateFrameNames("Minecart_",6,6,"",2),20,!1),i.addAnimation("mineCart_turnright_down",Phaser.Animation.generateFrameNames("Minecart_",12,12,"",2),20,!1),i.addAnimation("mineCart_right",Phaser.Animation.generateFrameNames("Minecart_",7,7,"",2),20,!1),i.addAnimation("mineCart_left",Phaser.Animation.generateFrameNames("Minecart_",11,11,"",2),20,!1),i.addAnimation("mineCart_up",Phaser.Animation.generateFrameNames("Minecart_",9,9,"",2),20,!1),i.addAnimation("mineCart_turnleft_up",Phaser.Animation.generateFrameNames("Minecart_",10,10,"",2),20,!1),i.addAnimation("mineCart_turnright_up",Phaser.Animation.generateFrameNames("Minecart_",8,8,"",2),20,!1),this.controller.levelModel.isUnderwater()){for(var a=[["down",299],["left",306],["up",313],["right",320]],s=0;s<a.length;s++){var l=o(a[s],2),c=l[0],u=l[1];i.addAnimation("walk_"+c,Phaser.Animation.generateFrameNames("Player_",u+1,u+4,"",3),5,!0)}for(var d=[["down",327],["left",333],["up",345],["right",339]],p=0;p<d.length;p++){var f=o(d[p],2),y=f[0],m=f[1];i.addAnimation("bump_"+y,Phaser.Animation.generateFrameNames("Player_",m,m+5,"",3),10,!1).onStart.add(function(){t.audioPlayer.play("bump")})}for(var v=[["down",351],["left",354],["up",360],["right",357]],g=0;g<v.length;g++){var k=o(v[g],2),b=k[0],w=k[1],P=Phaser.Animation.generateFrameNames("Player_",w,w+2,"",3);i.addAnimation("punch_"+b,P,10,!1).onComplete.add(function(){t.audioPlayer.play("punch")}),i.addAnimation("punchDestroy_"+b,P.concat(P).concat(P),10,!1)}}if(this.controller.levelModel.isInBoat()){for(var _=[["down",9],["left",15],["up",21],["right",27]],S=0;S<_.length;S++){var A=o(_[S],2),O=A[0],T=A[1];i.addAnimation("idle_"+O,Phaser.Animation.generateFrameNames("Boat_",T,T,"",2),10,!0),i.addAnimation("walk_"+O,Phaser.Animation.generateFrameNames("Boat_",T,T+4,"",2),10,!0),i.addAnimation("celebrate_"+O,["Boat_49","Boat_50","Boat_49","Boat_50","Boat_49"],5,!1)}for(var C=[["down",51],["left",63],["up",69],["right",57]],B=0;B<C.length;B++){var E=o(C[B],2),R=E[0],D=E[1];i.addAnimation("bump_"+R,Phaser.Animation.generateFrameNames("Boat_",D,D+5,"",2),10,!1).onStart.add(function(){t.audioPlayer.play("bump")})}h(this.game,i.animationRig)}}},{key:"playerFrameName",value:function(e){return Phaser.Animation.generateFrameNames("Player_",e,e,"",3)}},{key:"generateAnimations",value:function(e,t){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,n=this.getDirectionName(e),a=[];a.push(this.playerFrameName(t+1)),a.push(this.playerFrameName(t+3)),a.push(this.playerFrameName(t+1)),a.push(this.playerFrameName(t+7)),a.push(this.playerFrameName(t+9)),a.push(this.playerFrameName(t+7));for(var r=0;r<5;++r)a.push(this.playerFrameName(t+1));o.addAnimation("idle"+n,a,20/3,!1).onComplete.add(function(){i.playRandomPlayerIdle(e,o)}),(a=this.generateFramesWithEndDelay("Player_",t+6,t+5,this.playerFrameName(t+5),3,5)).push(this.playerFrameName(t+6)),o.addAnimation("lookLeft"+n,a,10,!1).onComplete.add(function(){i.playScaledSpeed(o.getAnimationManager(),"idlePause"+n)}),(a=this.generateFramesWithEndDelay("Player_",t+12,t+11,this.playerFrameName(t+11),3,5)).push(this.playerFrameName(t+12)),o.addAnimation("lookRight"+n,a,10,!1).onComplete.add(function(){i.playScaledSpeed(o.getAnimationManager(),"idlePause"+n)}),a=[];for(var s=0;s<13;++s)a.push(this.playerFrameName(t+1));o.addAnimation("idlePause"+n,a,20/3,!1).onComplete.add(function(){i.playRandomPlayerIdle(e,o)}),o.addAnimation("walk"+n,Phaser.Animation.generateFrameNames("Player_",t+13,t+20,"",3),20,!0);var l=Phaser.Animation.generateFrameNames("Player_",t+21,t+24,"",3);o.addAnimation("punch"+n,l,20,!1).onComplete.add(function(){i.audioPlayer.play("punch")}),o.addAnimation("punchDestroy"+n,l.concat(l).concat(l),20,!1),o.addAnimation("hurt"+n,Phaser.Animation.generateFrameNames("Player_",t+25,t+28,"",3),20,!1).onComplete.add(function(){i.playScaledSpeed(o.getAnimationManager(),"idlePause"+n)}),o.addAnimation("crouch"+n,Phaser.Animation.generateFrameNames("Player_",t+29,t+32,"",3),20,!0),o.addAnimation("jumpUp"+n,Phaser.Animation.generateFrameNames("Player_",t+33,t+36,"",3),10,!0),o.addAnimation("fail"+n,Phaser.Animation.generateFrameNames("Player_",t+45,t+48,"",3),20,!1),o.addAnimation("celebrate"+n,this.generatePlayerCelebrateFrames(),10,!1),o.addAnimation("bump"+n,Phaser.Animation.generateFrameNames("Player_",t+49,t+54,"",3),20,!1).onStart.add(function(){i.audioPlayer.play("bump")}),o.addAnimation("jumpDown"+n,Phaser.Animation.generateFrameNames("Player_",t+55,t+60,"",3),20,!0)}},{key:"createMiniBlock",value:function(e,t,i){var o=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function r(e,t){return void 0===e?t:e}var l=r(n.collectibleDistance,2),c=r(n.xOffsetRange,40),h=r(n.yOffsetRange,40),u=a.getMiniblockFrame(i);if(!u||!this.miniBlocks[u])return null;var d=7-c/2+Math.random()*c,p=3-h/2+Math.random()*h,f=new s(d,p),y=n.isOnBlock?-20:0,m=this.actionGroup.create(d+40*e,p+40*t+y,"miniBlocks","shadow.png"),v=this.actionGroup.create(0,0,"miniBlocks",this.miniBlocks[u]+".png");m.addChild(v);var g=this.addResettableTween(v).to({y:-8},350,function(e){return e<.2?1:e<.4?2:e<.6?1:e<.8?0:e<1?1:0});if(n.onComplete)g.onComplete.add(n.onComplete);else{var k=this.controller.levelModel.spritePositionToIndex(f,new s(m.x,m.y));this.collectibleItems.push([m,f,i,l]),g.onComplete.add(function(){o.controller.levelModel.usePlayer&&function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(o.player.position,k)<l&&o.player.collectItems(new s(e,t))})}return g.start(),m}},{key:"playAnimationWithRandomOffset",value:function(e,t){var i=this.playScaledSpeed(e,t);i.frame=Math.trunc(Math.random()*i.frameTotal)}},{key:"psuedoRandomTint",value:function(e,t,i,o){var n=Math.pow(10*i+o,5)%251/12;e===this.groundGroup?n+=24:n*=.75;var a=Math.floor(255-n).toString(16);t.tint="0x"+a+a+a}},{key:"createBlock",value:function(e,t,i,o){var n,r,l,c,h,u,d=this,p=new s(t,i),f=null,y=function(n,a){var r=o.substring(4);(f=n.createBlock(e,t,i,"log"+r)).fluff=n.createBlock(n.fluffGroup,t,i,"leaves"+r),f.onBlockDestroy=function(e){e.fluff.animations.add("despawn",Phaser.Animation.generateFrameNames("Leaves_"+r,a[0],a[1],".png",0),10,!1).onComplete.add(function(){n.toDestroy.push(e.fluff),e.fluff.kill()}),n.playScaledSpeed(e.fluff.animations,"despawn")},n.trees.push({sprite:f,type:o,position:p})},m=function(n,a){l=d.blocks[o][0],c=d.blocks[o][1],h=d.blocks[o][2],u=d.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=[];for(var s=Phaser.Animation.generateFrameNames(a,0,3,"",1),p=0;p<5;++p)r.push(a+"0");r=r.concat(s),f.animations.add("open",r),r=[],s=Phaser.Animation.generateFrameNames(a,3,0,"",1);for(var y=0;y<5;++y)r.push(a+"3");return r=r.concat(s),f.animations.add("close",r),f};switch(o){case"treeAcacia":y(this,[0,7]);break;case"treeBirch":y(this,[0,8]);break;case"treeJungle":y(this,[0,9]);break;case"treeOak":y(this,[0,6]);break;case"treeSpruce":case"treeSpruceSnowy":y(this,[0,8]);break;case"cropWheat":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Wheat",0,2,"",0),f.animations.add("idle",r,.4,!1),this.playScaledSpeed(f.animations,"idle");break;case"torch":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Torch",0,23,"",0),f.animations.add("idle",r,15,!0),this.playScaledSpeed(f.animations,"idle");break;case"water":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Water_",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"watering":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],(f=e.create(h+40*t,u+e.yOffset+40*i,l,c)).kill(),this.toDestroy.push(f),this.createBlock(this.groundGroup,t,i,"farmlandWet"),this.refreshGroundGroup();break;case"lava":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Lava_",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"magmaBlock":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Magma_Block",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"magmaUnderwater":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Magma_Bubble_Boat",0,5,"",0),f.animations.add("idle",r,5,!0),this.playAnimationWithRandomOffset(f.animations,"idle");break;case"magmaDeep":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Magma_Bubble_Deep",0,5,"",0),f.animations.add("idle",r,5,!0),this.playAnimationWithRandomOffset(f.animations,"idle");break;case"bubbleColumn":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Bubble_Column",0,5,"",0),f.animations.add("idle",r,5,!0),this.playAnimationWithRandomOffset(f.animations,"idle");break;case"conduit":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Conduit",3,10,"",2),f.animations.add("open",r,5,!0),r=Phaser.Animation.generateFrameNames("Conduit",0,2,"",2),f.animations.add("activation",r,5,!1),f.animations.add("deactivation",r.reverse(),5,!1);break;case"prismarine":this.initPrismarine(),h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,this.prismarine);break;case"seaLantern":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Sea_Lantern",0,4,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"seaGrass":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Seagrass",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle",.5);break;case"kelp":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("KelpSingle_",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle",.5);break;case"Chest":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Chest",0,2,"",0),f.animations.add("open",r,5,!1);break;case"NetherPortal":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("NetherPortal",1,6,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"lavaPop":for(l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("LavaPop",1,7,"",2),n=0;n<4;++n)r.push("LavaPop07");for(r=r.concat(Phaser.Animation.generateFrameNames("LavaPop",8,13,"",2)),n=0;n<3;++n)r.push("LavaPop13");for(r=r.concat(Phaser.Animation.generateFrameNames("LavaPop",14,30,"",2)),n=0;n<8;++n)r.push("LavaPop01");f.animations.add("idle",r,5,!0),this.playAnimationWithRandomOffset(f.animations,"idle");break;case"fire":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Fire",0,14,"",2),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"bubbles":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Bubbles",0,14,"",2),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"explosion":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Explosion",0,16,"",1),f.animations.add("idle",r,15,!1).onComplete.add(function(){d.toDestroy.push(f),f.kill()}),this.playScaledSpeed(f.animations,"idle");break;case"door":f=m(0,"Door");break;case"doorIron":f=m(0,"DoorIron"),this.blockReceivesCornerShadow(t,i)&&f.addChild(this.game.make.sprite(-40,55,"blockShadows","Shadow_Parts_Fade_overlap.png"));break;case"tnt":l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("TNTexplosion",0,8,"",0),f.animations.add("explode",r,7,!1).onComplete.add(function(){d.playExplosionCloudAnimation(p),f.kill(),d.toDestroy.push(f),d.actionPlaneBlocks[d.coordinatesToIndex(p)]=null});break;default:if(!this.blocks[o])throw new Error("Unknown block type: "+o);if(l=this.blocks[o][0],c=this.blocks[o][1],h=this.blocks[o][2],u=this.blocks[o][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),e!==this.actionGroup&&e!==this.groundGroup||a.isWalkable(o)||this.psuedoRandomTint(e,f,t,i),e===this.actionGroup&&!a.isWalkable(o)&&this.blockReceivesCornerShadow(t,i)){var v=-39,g=40;o.startsWith("pistonArm")&&(v=-26,g=53),f.addChild(this.game.make.sprite(v,g,"blockShadows","Shadow_Parts_Fade_overlap.png"))}o.startsWith("redstoneWire")&&o.endsWith("On")&&f.addChild(this.addRedstoneSparkle())}return f}},{key:"addRedstoneSparkle",value:function(){for(var e=this,t="redstone_sparkle99.png",i=this.game.make.sprite(20,25,"redstoneSparkle",t),o=0;o<3;o++){var n=8*o,a=[t].concat(Phaser.Animation.generateFrameNames("redstone_sparkle",n,n+7,".png"),t);i.animations.add("fizz_"+o,a,7)}return function t(){setTimeout(function(){if(i.alive){var o=Math.floor(3*Math.random());e.onAnimationEnd(e.playScaledSpeed(i.animations,"fizz_"+o),t),i.position.x=Math.random()>.5?20:40,i.position.y=Math.random()>.5?25:45}},c(500,7e3)/e.controller.tweenTimeScale)}(),i}},{key:"blockReceivesCornerShadow",value:function(e,t){var i=this.controller.levelModel.actionPlane.getBlockAt([e,t+1]);if(!i||i.blockType&&!i.isWalkable)return!1;var o=this.controller.levelModel.actionPlane.getBlockAt([e-1,t+1]);return o&&o.blockType&&!o.isWalkable}},{key:"isUnderTree",value:function(e,t){if(e>=this.trees.length||e<0)return!1;for(var i=this.treeFluffTypes[this.trees[e].type],o=0;o<i.length;o++)if(this.trees[e].position[0]+i[o][0]===t[0]&&this.trees[e].position[1]+i[o][1]===t[1])return!0;return!1}},{key:"changeTreeAlpha",value:function(e,t){this.controller.levelView.addResettableTween(this.trees[e].sprite.fluff).to({alpha:t},300,Phaser.Easing.Linear.None).start()}},{key:"onAnimationEnd",value:function(e,t){var i=e.onComplete.add(function(){i.detach(),t()})}},{key:"onAnimationStart",value:function(e,t){var i=e.onStart.add(function(){i.detach(),t()})}},{key:"onAnimationLoopOnce",value:function(e,t){var i=e.onLoop.add(function(){i.detach(),t()})}},{key:"addResettableTween",value:function(e){var t=this.game.add.tween(e);return t.timeScale=this.controller.tweenTimeScale,this.resettableTweens.push(t),t}},{key:"animateDoor",value:function(e,t){var i=this,o=this.controller.levelModel.player;this.setSelectionIndicatorPosition(this.controller.levelModel.actionPlane.indexToCoordinates(e)[0],this.controller.levelModel.actionPlane.indexToCoordinates(e)[1]),this.controller.audioPlayer.play("doorOpen");var n=this.controller.levelModel.actionPlane.indexToCoordinates(e);this.playDoorAnimation(n,t,function(){var e=i.controller.levelModel.actionPlane.getBlockAt(n);e.isWalkable=e.isOpen,"doorIron"!==e.blockType&&i.playIdleAnimation(o.position,o.facing,o.isOnBlock,o),i.setSelectionIndicatorPosition(o.position[0],o.position[1])})}}]),e}()},function(e,t,i){"use strict";e.exports={},e.exports.createEvent=function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{t=new Event(e,{bubbles:i,cancelable:o})}catch(n){(t=document.createEvent("Event")).initEvent(e,i,o)}return t},e.exports.bisect=function(e,t){return[e.filter(function(e){return t(e)}),e.filter(function(e){return!t(e)})]}},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(21),r=i(22),s=i(23),l=i(24),c=i(25),h=i(26),u=i(27),d=i(28),p=i(29),f=i(30),y=i(31),m=i(32),v=i(33),g=i(10),k=i(3);e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.game=t.game,this.entityMap=new Map,this.entityDeathCount=new Map,this.sprite=null,this.id=0}return o(e,[{key:"loadData",value:function(e){if(void 0!==e.entities)for(var t=0;t<e.entities.length;t++){var i=e.entities[t],o=this.createEntity(i[0],this.id++,i[1],i[2],i[3],i[4]);o.updateHidingTree(),o.updateHidingBlock()}}},{key:"tick",value:function(){this.entityMap.forEach(function(e){e.tick()})}},{key:"pushEntity",value:function(e){this.entityMap.has(e.identifier)?this.controller.DEBUG&&this.game.debug.text("Duplicate entity name : "+e.identifier+"\n"):this.entityMap.set(e.identifier,e)}},{key:"isFriendlyEntity",value:function(e){for(var t=["sheep","ironGolem","cow","chicken","cod","dolphin","salmon","seaTurtle","seaTurtle","squid","tropicalFish"],i=0;i<t.length;i++)if(e===t[i])return!0;return!1}},{key:"createEntity",value:function(e,t,i,o,k,b){var w=null;if(this.entityMap.has(t))this.controller.DEBUG&&this.game.debug.text("Duplicate entity name : "+t+"\n");else{switch(e){case"sheep":w=new a(this.controller,e,t,i,o,k);break;case"zombie":w=new r(this.controller,e,t,i,o,k);break;case"ironGolem":w=new s(this.controller,e,t,i,o,k);break;case"creeper":w=new l(this.controller,e,t,i,o,k);break;case"cow":w=new c(this.controller,e,t,i,o,k);break;case"chicken":w=new h(this.controller,e,t,i,o,k);break;case"cod":w=new d(this.controller,e,t,i,o,k);break;case"dolphin":w=new u(this.controller,e,t,i,o,k);break;case"ghast":w=new v(this.controller,e,t,i,o,k,b);break;case"boat":w=new g(this.controller,e,t,i,o,k);break;case"salmon":w=new p(this.controller,e,t,i,o,k);break;case"seaTurtle":w=new f(this.controller,e,t,i,o,k);break;case"squid":w=new y(this.controller,e,t,i,o,k);break;case"tropicalFish":w=new m(this.controller,e,t,i,o,k);break;default:w=new n(this.controller,e,t,i,o,k)}this.controller.DEBUG&&console.log("Create Entity type : "+e+" "+i+","+o),this.entityMap.set(t,w)}return w}},{key:"isSpawnableInBetween",value:function(e,t,i,o){for(var n=e;n<=i;n++)for(var a=t;a<=o;a++)if(this.controller.levelModel.isPositionEmpty(new k(n,a))[0])return!0;return!1}},{key:"spawnEntity",value:function(e,t){var i=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},o=this.controller.levelModel,n=o.planeWidth,a=o.planeHeight;if("middle"===t){if(this.isSpawnableInBetween(Math.floor(.25*n),Math.floor(.25*a),Math.floor(.75*n),Math.floor(.75*a))){for(var r=new k(i(Math.floor(.25*n),Math.floor(.75*n)),i(Math.floor(.25*a),Math.floor(.75*a)));!o.isPositionEmpty(r)[0];)r=new k(i(Math.floor(.25*n),Math.floor(.75*n)),i(Math.floor(.25*a),Math.floor(.75*a)));return this.createEntity(e,this.id++,r.x,r.y,i(0,3))}if(!this.isSpawnableInBetween(1,1,n-2,a-2))return null;for(var s=new k(i(1,n-2),i(1,a-2));!o.isPositionEmpty(s)[0];)s=new k(i(1,n-2),i(1,a-2));return this.createEntity(e,this.id++,s.x,s.y,i(0,3))}if("left"===t){for(var l=0,c=!0;l<n&&c;){c=!0;for(var h=0;h<a;h++)if(o.isPositionEmpty(new k(l,h))[0]){c=!1;break}c&&l++}if(l<n){for(var u=new k(l,i(0,a-1));!o.isPositionEmpty(u)[0];)u=new k(l,i(0,a-1));return this.createEntity(e,this.id++,u.x,u.y,i(0,3))}}else if("right"===t){for(var d=n-1,p=!0;d>-1&&p;){p=!0;for(var f=0;f<a;f++)if(o.isPositionEmpty(new k(d,f))[0]){p=!1;break}p&&d--}if(d>-1){for(var y=new k(d,i(0,a-1));!o.isPositionEmpty(y)[0];)y=new k(d,i(0,a-1));return this.createEntity(e,this.id++,y.x,y.y,i(0,3))}}else if("up"===t){for(var m=0,v=!0;m<a&&v;){v=!0;for(var g=0;g<n;g++)if(o.isPositionEmpty(new k(g,m))[0]){v=!1;break}v&&m++}if(m<a){for(var b=new k(i(0,a-1),m);!o.isPositionEmpty(b)[0];)b=new k(i(0,a-1),m);return this.createEntity(e,this.id++,b.x,b.y,i(0,3))}}else if("down"===t){for(var w=a-1,P=!0;w>-1&&P;){P=!0;for(var _=0;_<n;_++)if(o.isPositionEmpty(new k(_,w))[0]){P=!1;break}P&&w--}if(w>-1){for(var S=new k(i(0,a-1),w);!o.isPositionEmpty(S)[0];)S=new k(i(0,a-1),w);return this.createEntity(e,this.id++,S.x,S.y,i(0,3))}}return null}},{key:"spawnEntityAt",value:function(e,t,i,o){return this.createEntity(e,this.id++,t,i,o)}},{key:"destroyEntity",value:function(e){if(this.entityMap.has(e)){var t=this.entityMap.get(e);this.entityDeathCount.has(t.type)?this.entityDeathCount.set(t.type,this.entityDeathCount.get(t.type)+1):this.entityDeathCount.set(t.type,1),t.reset(),t.getAnimationManager().stop(null,!0),t.sprite.destroy(),this.entityMap.delete(e)}else this.controller.DEBUG&&this.game.debug.text("It's impossible to delete since entity name : "+e+" is not existing\n")}},{key:"getEntityAt",value:function(e){var t=!0,i=!1,o=void 0;try{for(var n,a=this.entityMap[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var r=n.value[1];if(k.equals(e,r.position))return r}}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return null}},{key:"getEntitiesOfType",value:function(e){if("all"===e){var t=[],i=!0,o=!1,n=void 0;try{for(var a,r=this.entityMap[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value[1];"Player"!==s.type&&t.push(s)}}catch(e){o=!0,n=e}finally{try{!i&&r.return&&r.return()}finally{if(o)throw n}}return t}var l=[],c=!0,h=!1,u=void 0;try{for(var d,p=this.entityMap[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value[1];f.type===e&&l.push(f)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}return l}},{key:"reset",value:function(){this.entityMap.clear(),this.entityDeathCount=new Map}}]),e}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0};var a=i(0),r=i(5);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-43,-55],s.controller.levelView&&(s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y)),s.naked=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"use",value:function(e,t){var i=this,o=this.getNakedSuffix()+"lookAtCam"+this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,o),this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:r.WhenUsed,targetType:i.type,eventSenderIdentifier:t.identifier,targetIdentifier:i.identifier})}),this.queue.endPushHighPriorityCommands(),e.succeeded()}},{key:"getWalkAnimation",value:function(){return this.getNakedSuffix()+n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getWalkAnimation",this).call(this)}},{key:"getIdleAnimation",value:function(){return this.getNakedSuffix()+n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getIdleAnimation",this).call(this)}},{key:"bump",value:function(e){var t=this,i=this.getNakedSuffix()+"bump",o=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,i+o);var n=this.controller.levelModel.getMoveForwardPosition(this),a=this.controller.levelEntity.getEntityAt(n);null!==a&&(this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:r.WhenTouched,targetType:t.type,targetIdentifier:t.identifier,eventSenderIdentifier:a.identifier})}),this.queue.endPushHighPriorityCommands()),this.controller.delayPlayerMoveBy(400,800,function(){e.succeeded()})}},{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[],n="ShadowSheep_2016";this.sprite=i.create(0,0,"sheep","ShadowSheep_2016001.png");for(var a=["ShadowSheep_2016217.png","ShadowSheep_2016109.png","ShadowSheep_2016001.png","ShadowSheep_2016325.png"],r=[[[252,261],[220,222],[228,231],[276,279],[270,275],[282,293],[294,305],[306,317],[318,323],[234,243],[880,887]],[[144,153],[112,114],[120,123],[168,171],[162,167],[174,185],[186,197],[198,209],[210,215],[126,135],[872,879]],[[36,45],[3,6],[12,15],[60,63],[54,59],[66,77],[78,89],[90,101],[102,108],[18,26],[864,871]],[[360,369],[328,330],[336,339],[384,387],[378,383],[390,401],[402,413],[414,425],[426,431],[342,351],[888,895]]],s=0;s<4;s++){var l=this.controller.levelView.getDirectionName(s);o=Phaser.Animation.generateFrameNames(n,r[s][0][0],r[s][0][1],".png",3);for(var c=0;c<8;c++)o.push(a[s]);this.sprite.animations.add("idle"+l,o,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames(n,r[s][1][0],r[s][1][1],".png",3),this.sprite.animations.add("lookLeft"+l,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[s][1][1],r[s][1][0],".png",3),this.sprite.animations.add("lookLeft"+l+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][2][0],r[s][2][1],".png",3),this.sprite.animations.add("lookRight"+l,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[s][2][1],r[s][2][0],".png",3),this.sprite.animations.add("lookRight"+l+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][3][0],r[s][3][1],".png",3),this.sprite.animations.add("lookAtCam"+l,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[s][3][1],r[s][3][0],".png",3),this.sprite.animations.add("lookAtCam"+l+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][4][0],r[s][4][1],".png",3),this.sprite.animations.add("lookDown"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][5][0],r[s][5][1],".png",3),this.sprite.animations.add("walk"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][6][0],r[s][6][1],".png",3),this.sprite.animations.add("attack"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][7][0],r[s][7][1],".png",3),this.sprite.animations.add("hurt"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[s][8][0],r[s][8][1],".png",3),this.sprite.animations.add("die"+l,o,10,!1),o=this.controller.levelView.generateReverseFrames(n,r[s][9][0],r[s][9][1],".png",3),this.sprite.animations.add("eat"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=this.controller.levelView.generateReverseFrames(n,r[s][10][0],r[s][10][1],".png",3),this.sprite.animations.add("bump"+l,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}r=[[[684,693],[652,654],[660,663],[708,711],[702,707],[714,725],[726,737],[738,749],[750,755],[666,675],[912,919]],[[576,585],[544,546],[552,555],[600,603],[594,599],[606,617],[618,629],[630,641],[642,647],[558,567],[904,911]],[[468,477],[436,438],[444,447],[492,495],[486,491],[498,509],[510,521],[522,533],[534,539],[450,459],[896,903]],[[792,801],[760,762],[768,771],[816,819],[810,815],[822,833],[834,845],[846,857],[858,863],[774,783],[920,927]]],a=["ShadowSheep_2016649.png","ShadowSheep_2016541.png","ShadowSheep_2016433.png","ShadowSheep_2016757.png"];for(var h=0;h<4;h++){var u=this.controller.levelView.getDirectionName(h);o=Phaser.Animation.generateFrameNames(n,r[h][0][0],r[h][0][1],".png",3);for(var d=0;d<8;d++)o.push(a[h]);this.sprite.animations.add("naked_idle"+u,o,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames(n,r[h][1][0],r[h][1][1],".png",3),this.sprite.animations.add("naked_lookLeft"+u,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[h][1][1],r[h][1][0],".png",3),this.sprite.animations.add("naked_lookLeft"+u+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][2][0],r[h][2][1],".png",3),this.sprite.animations.add("naked_lookRight"+u,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[h][2][1],r[h][2][0],".png",3),this.sprite.animations.add("naked_lookRight"+u+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][3][0],r[h][3][1],".png",3),this.sprite.animations.add("naked_lookAtCam"+u,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,r[h][3][1],r[h][3][0],".png",3),this.sprite.animations.add("naked_lookAtCam"+u+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][4][0],r[h][4][1],".png",3),this.sprite.animations.add("naked_lookDown"+u,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][5][0],r[h][5][1],".png",3),this.sprite.animations.add("naked_walk"+u,o,10,!0),o=Phaser.Animation.generateFrameNames(n,r[h][6][0],r[h][6][1],".png",3),this.sprite.animations.add("naked_attack"+u,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][7][0],r[h][7][1],".png",3),this.sprite.animations.add("naked_hurt_"+u,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,r[h][8][0],r[h][8][1],".png",3),this.sprite.animations.add("naked_die"+u,o,10,!1),o=this.controller.levelView.generateReverseFrames(n,r[h][9][0],r[h][9][1],".png",3),this.sprite.animations.add("naked_eat"+u,o,10,!1).onComplete.add(function(){e.naked=!1,e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=this.controller.levelView.generateReverseFrames(n,r[h][10][0],r[h][10][1],".png",3),this.sprite.animations.add("naked_bump"+u,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"playRandomIdle",value:function(e){var t,i=this.getNakedSuffix();switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(6*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown";break;case 6:i+="eat"}i+=t,this.controller.levelView.playScaledSpeed(this.sprite.animations,i),this.controller.printErrorMsg(this.type+" calls animation : "+i+"\n")}},{key:"attack",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.onAnimationEnd(this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"attack"+i),function(){var o=t.controller.levelEntity.getEntityAt(t.controller.levelModel.getMoveForwardPosition(t));null!==o&&t.controller.levelView.onAnimationEnd(t.controller.levelView.playScaledSpeed(o.getAnimationManager(),t.getNakedSuffix()+"hurt"+i),function(){t.controller.events.forEach(function(e){return e({eventType:r.WhenAttacked,targetType:t.type,eventSenderIdentifier:t.identifier,targetIdentifier:o.identifier})})}),e.succeeded()})}},{key:"updateAnimationDirection",value:function(){var e=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"idle"+e)}},{key:"drop",value:function(e,i){if(this.naked)return!1;if(e&&n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"drop",this).call(this,e,i),"wool"===i&&(this.naked=!0,this.controller.levelView)){var o=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"naked_idle"+o,function(){})}return!0}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,o=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"hurt"+o),setTimeout(function(){t.healthPoint--,e.succeeded()},1500)):(this.healthPoint--,this.sprite.animations.stop(null,!0),this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"die"+o),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},500,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start()},1500))}},{key:"getNakedSuffix",value:function(){return this.naked?"naked_":""}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0};var a=i(0);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-43,-45],s.burningSprite=[null,null],s.burningSpriteGhost=[null,null],s.burningSpriteOffset=[47,40],s.prepareSprite(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"tick",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this)}},{key:"reset",value:function(){for(var e=0;e<2;e++)this.burningSprite[e]&&this.burningSprite[e].destroy()}},{key:"playMoveForwardAnimation",value:function(e,i,o,a){var r=this;n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"playMoveForwardAnimation",this).call(this,e,i,o,a),this.burningSprite[0].sortOrder=this.sprite.sortOrder+1,this.burningSprite[1].sortOrder=this.sprite.sortOrder-1,setTimeout(function(){for(var t=0;t<2;t++){var i=r.controller.levelView.addResettableTween(r.burningSprite[t]).to({x:r.offset[0]+r.burningSpriteOffset[0]+40*e[0],y:r.offset[1]+r.burningSpriteOffset[1]+40*e[1]},300,Phaser.Easing.Linear.None);i.onComplete.add(function(){}),i.start()}},50/this.controller.tweenTimeScale)}},{key:"setBurn",value:function(e){if(e)for(var t=0;t<2;t++)this.burningSprite[t].alpha=1;else for(var i=0;i<2;i++)this.burningSprite[i].alpha=0}},{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[];this.sprite=i.create(0,0,"zombie","Zombie_001.png"),this.sprite.sortOrder=this.controller.levelView.yToIndex(this.position.y),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y,this.burningSprite=[i.create(this.sprite.x+this.burningSpriteOffset[0],this.sprite.y+this.burningSpriteOffset[1],"burningInSun","BurningFront_001.png"),i.create(this.sprite.x+this.burningSpriteOffset[0],this.sprite.y+this.burningSpriteOffset[1],"burningInSun","BurningBehind_001.png")],o=Phaser.Animation.generateFrameNames("BurningFront_",1,15,".png",3),this.burningSprite[0].animations.add("burn",o,10,!0),o=Phaser.Animation.generateFrameNames("BurningBehind_",1,15,".png",3),this.burningSprite[1].animations.add("burn",o,10,!0),this.controller.levelView.playScaledSpeed(this.burningSprite[0].animations,"burn"),this.controller.levelView.playScaledSpeed(this.burningSprite[1].animations,"burn"),this.burningSprite[0].sortOrder=this.sprite.sortOrder+1,this.burningSprite[1].sortOrder=this.sprite.sortOrder-1;for(var n=["Zombie_056.png","Zombie_166.png","Zombie_001.png","Zombie_111.png"],a=[[[73,79],[57,59],[61,63],[69,71],[65,67],[80,88],[89,91],[93,101],[102,110],[229,236]],[[183,189],[167,169],[171,173],[179,181],[175,177],[190,198],[199,201],[203,211],[212,220],[245,252]],[[18,24],[2,4],[6,8],[14,16],[10,12],[25,33],[34,36],[38,46],[47,55],[221,228]],[[128,134],[112,114],[116,118],[124,126],[120,122],[135,143],[144,146],[148,156],[158,165],[237,244]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=Phaser.Animation.generateFrameNames("Zombie_",a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<8;l++)o.push(n[r]);this.sprite.animations.add("idle"+s,o,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,o,10/3,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,o,10,!0),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("hurt"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Zombie_",a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("die"+s,o,10,!1),o=this.controller.levelView.generateReverseFrames("Zombie_",a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("bump"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.setBurn(this.controller.levelModel.isDaytime)}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,o=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.sprite.animations,"hurt"+o),setTimeout(function(){t.healthPoint--,e.succeeded()},1500/this.controller.tweenTimeScale)):(this.healthPoint--,this.controller.levelView.playScaledSpeed(this.sprite.animations,"die"+o),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},500,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start();for(var i=0;i<2;i++)(e=t.controller.levelView.addResettableTween(t.burningSprite[i]).to({alpha:0},500,Phaser.Easing.Linear.None)).start()},1500/this.controller.tweenTimeScale))}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[],n="Iron_Golem_Anims";this.sprite=i.create(0,0,"ironGolem","Iron_Golem_Anims001.png");for(var a=[[[45,45],[46,48],[50,52],[58,60],[54,56],[62,70],[71,74],[77,81],[82,88],[185,192]],[[133,133],[134,136],[138,140],[146,148],[142,144],[150,158],[159,162],[165,169],[170,176],[201,208]],[[1,1],[2,4],[6,8],[14,16],[10,12],[18,26],[27,30],[33,37],[38,44],[177,184]],[[89,89],[90,92],[94,96],[102,104],[98,100],[106,114],[115,118],[121,125],[126,132],[193,200]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=Phaser.Animation.generateFrameNames(n,a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<12;l++)o.push(o[0]);this.sprite.animations.add("idle"+s,o,8,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames(n,a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,o,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,o,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,o,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown_2"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][4][1],a[r][4][0],".png",3),this.sprite.animations.add("lookDown_2"+s,o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,o,8,!0),o=Phaser.Animation.generateFrameNames(n,a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("hurt"+s,o,16/3,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("die"+s,o,16/3,!1),o=this.controller.levelView.generateReverseFrames(n,a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("bump"+s,o,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position[0],this.sprite.y=this.offset[1]+40*this.position[1]}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[],n="ShadowCreeper_2016_";this.sprite=i.create(0,0,"creeper","ShadowCreeper_2016_000.png");for(var a=[[[128,128],[128,131],[134,137],[140,143],[146,149],[152,163],[164,167],[164,178],[179,184],[185,191],[272,279]],[[64,64],[64,67],[70,73],[76,89],[82,85],[88,99],[100,103],[100,114],[115,120],[121,127],[264,271]],[[0,0],[0,3],[6,10],[12,16],[18,21],[24,35],[36,39],[36,50],[51,56],[57,63],[256,263]],[[192,192],[192,195],[198,201],[204,207],[210,213],[216,227],[228,231],[228,242],[243,248],[249,255],[280,287]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=Phaser.Animation.generateFrameNames(n,a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<12;l++)o.push(o[0]);this.sprite.animations.add("idle"+s,o,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames(n,a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,o,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames(n,a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown_2"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][4][1],a[r][4][0],".png",3),this.sprite.animations.add("lookDown_2"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,o,10,!0),o=Phaser.Animation.generateFrameNames(n,a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("explode"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("hurt"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames(n,a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("die"+s,o,10,!1),o=this.controller.levelView.generateReverseFrames(n,a[r][10][0],a[r][10][1],".png",3),this.sprite.animations.add("bump"+s,o,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[];this.sprite=i.create(0,0,"cow","Cow0001.png");for(var n=["Cow0222.png","Cow0111.png","Cow0001.png","Cow0333.png"],a=[[[258,264],[225,227],[224,226],[285,287],[240,241],[291,302],[303,313],[314,326],[327,332],[460,467],[276,282],[240,249]],[[147,153],[114,116],[129,130],[174,176],[129,130],[180,191],[192,202],[203,215],[216,221],[452,459],[165,171],[129,138]],[[36,42],[3,5],[12,14],[63,65],[18,19],[69,80],[81,91],[92,104],[105,110],[444,451],[51,54],[18,27]],[[369,375],[336,338],[335,337],[396,398],[351,352],[402,413],[414,424],[425,437],[438,443],[468,475],[387,393],[351,360]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=[];for(var l=0;l<20;l++)o.push(n[r]);this.sprite.animations.add("idle"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][1][0],a[r][1][1],".png",4),this.sprite.animations.add("lookLeft"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][1][1],a[r][1][0],".png",4),this.sprite.animations.add("lookLeft"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][2][0],a[r][2][1],".png",4),this.sprite.animations.add("lookRight"+s,o,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][2][1],a[r][2][0],".png",4),this.sprite.animations.add("lookRight"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][3][0],a[r][3][1],".png",4),this.sprite.animations.add("lookAtCam"+s,o,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][3][1],a[r][3][0],".png",4),this.sprite.animations.add("lookAtCam"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][4][0],a[r][4][1],".png",4),this.sprite.animations.add("lookDown"+s,o,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][4][1],a[r][4][0],".png",4),this.sprite.animations.add("lookDown"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][5][0],a[r][5][1],".png",4),this.sprite.animations.add("walk"+s,o,12,!0),o=Phaser.Animation.generateFrameNames("Cow",a[r][6][0],a[r][6][1],".png",4),this.sprite.animations.add("attack"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][7][0],a[r][7][1],".png",4),this.sprite.animations.add("hurt"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][8][0],a[r][8][1],".png",4),this.sprite.animations.add("die"+s,o,12,!1),o=this.controller.levelView.generateReverseFrames("Cow",a[r][9][0],a[r][9][1],".png",4),this.sprite.animations.add("bump"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),2===r?(o=Phaser.Animation.generateFrameNames("Cow",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("idle2"+s,o,6,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing)+"_reverse")}),o=Phaser.Animation.generateFrameNames("Cow",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("idle2"+s+"_reverse",o,6,!1).onComplete.add(function(){e.playRandomIdle(e.facing)})):(o=Phaser.Animation.generateFrameNames("Cow",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("idle2"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing)+"_reverse")}),o=Phaser.Animation.generateFrameNames("Cow",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("idle2"+s+"_reverse",o,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)})),o=Phaser.Animation.generateFrameNames("Cow",a[r][11][0],a[r][11][1],".png",4),this.sprite.animations.add("eat"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"eat"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Cow",a[r][11][1],a[r][11][0],".png",4),this.sprite.animations.add("eat"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"playRandomIdle",value:function(e){var t,i="";switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(5*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown"}i+=t,this.controller.levelView.playScaledSpeed(this.sprite.animations,i),this.controller.printErrorMsg(this.type+" calls animation : "+i+"\n")}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-25,-32],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[];this.sprite=i.create(0,0,"chicken","chicken0001.png"),this.sprite.scale.setTo(.75,.75);for(var n=["chicken0222.png","chicken0111.png","chicken0001.png","chicken0333.png"],a=[[[259,275],[225,227],[224,226],[285,287],[276,281],[291,302],[303,313],[314,326],[327,332],[460,467],[240,249]],[[148,164],[114,116],[113,115],[174,176],[165,170],[180,191],[192,202],[203,215],[216,221],[452,459],[129,138]],[[37,53],[3,5],[12,14],[63,65],[54,59],[69,80],[81,91],[92,104],[105,110],[444,451],[18,27]],[[370,386],[336,338],[335,337],[396,398],[387,392],[402,413],[414,424],[425,437],[438,443],[468,475],[351,360]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=Phaser.Animation.generateFrameNames("chicken",a[r][0][0],a[r][0][1],".png",4);for(var l=0;l<8;l++)o.push(n[r]);this.sprite.animations.add("idle"+s,o,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames("chicken",a[r][1][0],a[r][1][1],".png",4),this.sprite.animations.add("lookLeft"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][1][1],a[r][1][0],".png",4),this.sprite.animations.add("lookLeft"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][2][0],a[r][2][1],".png",4),this.sprite.animations.add("lookRight"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][2][1],a[r][2][0],".png",4),this.sprite.animations.add("lookRight"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][3][0],a[r][3][1],".png",4),this.sprite.animations.add("lookAtCam"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][3][1],a[r][3][0],".png",4),this.sprite.animations.add("lookAtCam"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][4][0],a[r][4][1],".png",4),this.sprite.animations.add("lookDown"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][5][0],a[r][5][1],".png",4),this.sprite.animations.add("walk"+s,o,12,!0),o=Phaser.Animation.generateFrameNames("chicken",a[r][6][0],a[r][6][1],".png",4),this.sprite.animations.add("attack"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][7][0],a[r][7][1],".png",4),this.sprite.animations.add("hurt"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][8][0],a[r][8][1],".png",4),this.sprite.animations.add("die"+s,o,12,!1),o=this.controller.levelView.generateReverseFrames("chicken",a[r][9][0],a[r][9][1],".png",4),this.sprite.animations.add("bump"+s,o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("eat"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"eat"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("chicken",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("eat"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=s.controller.levelModel.isUnderwater()?[-8,-8]:[-40,0],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){if(this.controller.levelModel.isUnderwater())switch(this.facing){case a.North:return"Dolphin09";case a.South:return"Dolphin27";case a.East:return"Dolphin18";case a.West:return"Dolphin00"}else switch(this.facing){case a.East:return"Dolphin_Surface15";default:return"Dolphin_Surface00"}}},{key:"prepareSprite",value:function(){var e=this;console.log(this.controller.levelModel.isUnderwater());var t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"dolphin",t+".png");var o=this.controller.levelModel.isUnderwater()?"Dolphin":"Dolphin_Surface",n=[[0,14],[15,29],[0,14],[0,14]];this.controller.levelModel.isUnderwater()&&(n=[[9,16],[18,25],[27,34],[0,7]]);for(var a=function(){var t=e.controller.levelView.getDirectionName(r),i=Phaser.Animation.generateFrameNames(o,n[r][0],n[r][1],".png",2);e.sprite.animations.add("idle"+t,i,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+t,.5)})},r=0;r<4;r++)a();var s=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+s,.5),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[0,10],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){if(this.controller.levelModel.isUnderwater())switch(this.facing){case a.North:return"Cod00";case a.South:return"Cod10";case a.East:return"Cod05";case a.West:return"Cod15"}else switch(this.facing){case a.East:return"Cod_Surface00";default:return"Cod_Surface06"}}},{key:"prepareSprite",value:function(){var e=this,t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"cod",t+".png");var o=this.controller.levelModel.isUnderwater()?"Cod":"Cod_Surface",n=[[6,12],[0,5],[6,12],[6,12]];this.controller.levelModel.isUnderwater()&&(n=[[0,3],[5,8],[10,13],[15,18]]);for(var a=function(){var t=e.controller.levelView.getDirectionName(r),i=Phaser.Animation.generateFrameNames(o,n[r][0],n[r][1],".png",2);e.sprite.animations.add("idle"+t,i,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+t,.5)})},r=0;r<4;r++)a();var s=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+s,.5),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[0,0],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){if(this.controller.levelModel.isUnderwater())switch(this.facing){case a.North:return"Salmon08";case a.South:return"Salmon24";case a.East:return"Salmon16";case a.West:return"Salmon00"}else switch(this.facing){case a.East:return"Salmon_Surface00";default:return"Salmon_Surface13"}}},{key:"prepareSprite",value:function(){var e=this,t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"salmon",t+".png");var o=this.controller.levelModel.isUnderwater()?"Salmon":"Salmon_Surface",n=[[13,25],[0,12],[13,25],[13,25]];this.controller.levelModel.isUnderwater()&&(n=[[8,14],[16,22],[24,30],[0,6]]);for(var a=function(){var t=e.controller.levelView.getDirectionName(r),i=Phaser.Animation.generateFrameNames(o,n[r][0],n[r][1],".png",2);e.sprite.animations.add("idle"+t,i,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+t,.5)})},r=0;r<4;r++)a();var s=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+s,.5),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=s.controller.levelModel.isUnderwater()?[-95,-100]:[-95,-90],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){if(this.controller.levelModel.isUnderwater())switch(this.facing){case a.North:return"Sea_Turtle00";case a.South:return"Sea_Turtle10";case a.East:return"Sea_Turtle05";case a.West:return"Sea_Turtle15"}else switch(this.facing){case a.East:return"Sea_Turtle_Surface13";default:return"Sea_Turtle_Surface00"}}},{key:"prepareSprite",value:function(){var e=this,t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"seaTurtle",t+".png"),this.sprite.scale.setTo(.75,.75);var o=this.controller.levelModel.isUnderwater()?"Sea_Turtle":"Sea_Turtle_Surface",n=[[0,12],[13,25],[0,12],[0,12]];this.controller.levelModel.isUnderwater()&&(n=[[0,3],[5,8],[10,13],[15,18]]);for(var a=function(){var t=e.controller.levelView.getDirectionName(r),i=Phaser.Animation.generateFrameNames(o,n[r][0],n[r][1],".png",2);e.sprite.animations.add("idle"+t,i,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+t,.5)})},r=0;r<4;r++)a();var s=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+s,.5),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelView.createMiniBlock(this.position.x,this.position.y,"turtle",{collectibleDistance:1,xOffsetRange:10,yOffsetRange:10}),this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getOffsetForDirection",value:function(){switch(this.facing){case a.North:return[0,0];case a.South:return[0,-24];case a.East:return[-32,-8];case a.West:return[-12,-8]}}},{key:"getFrameForDirection",value:function(){switch(this.facing){case a.North:return"Squid32";case a.South:return"Squid00";case a.East:return"Squid48";case a.West:return"Squid17"}}},{key:"prepareSprite",value:function(){var e=this;this.offset=this.getOffsetForDirection();var t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"squid",t+".png"),this.sprite.scale.setTo(.75,.75);for(var o=[[32,39],[40,47],[0,7],[17,23]],n=function(){var t=e.controller.levelView.getDirectionName(a),i=Phaser.Animation.generateFrameNames("Squid",o[a][0],o[a][1],".png",2);e.sprite.animations.add("idle"+t,i,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+t,.25)})},a=0;a<4;a++)n();var r=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+r,.25),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(1);e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[0,16],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"getFrameForDirection",value:function(){if(this.controller.levelModel.isUnderwater())switch(this.facing){case a.North:return"Tropical_Fish00";case a.South:return"Tropical_Fish10";case a.East:return"Tropical_Fish15";case a.West:return"Tropical_Fish05"}else switch(this.facing){case a.East:return"Tropical_Fish_Surface00";default:return"Tropical_Fish_Surface07"}}},{key:"prepareSprite",value:function(){var e=this,t=this.getFrameForDirection(),i=this.controller.levelView.actionGroup;this.sprite=i.create(0,0,"tropicalFish",t+".png");var o=this.controller.levelModel.isUnderwater()?"Tropical_Fish":"Tropical_Fish_Surface",n=[[7,13],[0,6],[7,13],[7,13]];this.controller.levelModel.isUnderwater()&&(n=[[0,3],[15,18],[10,13],[5,8]]);for(var a=function(t){var i=e.controller.levelView.getDirectionName(t),a=Phaser.Animation.generateFrameNames(o,n[t][0],n[t][1],".png",2);e.sprite.animations.add("idle"+i,a,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+i,.5)})},r=0;r<4;r++)a(r);var s=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+s,.5),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return this.controller.levelEntity.destroyEntity(this.identifier),!0}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(0),a=i(7).randomInt;e.exports=function(e){function t(e,i,o,n,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n,a,r));return s.offset=[-50,-84],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(Number.MAX_SAFE_INTEGER),s.audioDelay=15,n<5?s.patrolA():s.patrolB(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,o=[];this.sprite=i.create(0,0,"ghast","Ghast0000.png"),this.sprite.scale.setTo(1,1);for(var n=[[[72,83],[84,95]],[[48,59],[60,71]],[[24,35],[36,47]],[[0,11],[12,23]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);o=Phaser.Animation.generateFrameNames("Ghast",n[r][0][0],n[r][0][1],".png",4);for(var l=a(2,o.length),c=[],h=0;h<l;++h)c.push(o[0]),o.splice(0,1);for(var u=0;u<c.length;++u)o.push(c[u]);for(var d=0;d<0;d++)o.push(o[0]);this.sprite.animations.add("idle"+s,o,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),o=Phaser.Animation.generateFrameNames("Ghast",n[r][1][0],n[r][1][1],".png",4),this.sprite.animations.add("shoot"+s,o,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"shoot"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),o=Phaser.Animation.generateFrameNames("Ghast",n[r][1][1],n[r][1][0],".png",4),this.sprite.animations.add("shoot"+s+"_2",o,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return!0}},{key:"playRandomIdle",value:function(e){var t="";if(t+="idle",t+=this.controller.levelView.getDirectionName(e),this.controller.levelView.playScaledSpeed(this.sprite.animations,t),this.audioDelay>0)--this.audioDelay;else if(this.audioDelay=5,0===Math.floor(5*Math.random())){var i=Math.floor(4*Math.random());this.playMoan(i)}}},{key:"playMoan",value:function(e){switch(e){case 0:this.controller.audioPlayer.play("moan2");break;case 1:this.controller.audioPlayer.play("moan3");break;case 2:this.controller.audioPlayer.play("moan6");break;default:this.controller.audioPlayer.play("moan7")}}},{key:"patrolA",value:function(){var e,t,i=[Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0];(e=this.controller.levelView.addResettableTween(this.sprite)).to.apply(e,[{y:this.offset[1]+40*this.position.y+80},a(2500,3500)].concat(i)),(t=this.controller.levelView.addResettableTween(this.sprite)).to.apply(t,[{x:this.offset[0]+40*this.position.x+10},a(1500,2e3)].concat(i))}},{key:"patrolB",value:function(){var e,t,i=[Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0];(e=this.controller.levelView.addResettableTween(this.sprite)).to.apply(e,[{y:this.offset[1]+40*this.position.y-80},a(2500,3500)].concat(i)),(t=this.controller.levelView.addResettableTween(this.sprite)).to.apply(t,[{x:this.offset[0]+40*this.position.x-10},a(1500,2e3)].concat(i))}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.audioPlayer=t.audioPlayer,this.game=t.game,this.assetRoot=t.assetRoot,this.assets={entityShadow:{type:"image",path:this.assetRoot+"images/Character_Shadow.png"},selectionIndicator:{type:"image",path:this.assetRoot+"images/Selection_Indicator.png"},finishOverlay:{type:"image",path:this.assetRoot+"images/WhiteRect.png"},underwaterOverlay:{type:"atlasJSON",pngPath:this.assetRoot+"images/Water_Caustics.png",jsonPath:this.assetRoot+"images/Water_Caustics.json"},bed:{type:"image",path:this.assetRoot+"images/Bed.png"},playerSteve:{type:"atlasJSON",pngPath:this.assetRoot+"images/Steve1013.png",jsonPath:this.assetRoot+"images/Steve1013.json"},playerAlex:{type:"atlasJSON",pngPath:this.assetRoot+"images/Alex1013.png",jsonPath:this.assetRoot+"images/Alex1013.json"},playerSteveEvents:{type:"atlasJSON",pngPath:this.assetRoot+"images/Steve_2016.png",jsonPath:this.assetRoot+"images/Steve_2016.json"},playerAlexEvents:{type:"atlasJSON",pngPath:this.assetRoot+"images/DevAlex.png",jsonPath:this.assetRoot+"images/DevAlex.json"},playerAgent:{type:"atlasJSON",pngPath:this.assetRoot+"images/Agent.png",jsonPath:this.assetRoot+"images/Agent.json"},playerSteveAquatic:{type:"atlasJSON",pngPath:this.assetRoot+"images/Steve_2018.png",jsonPath:this.assetRoot+"images/Steve_2018.json"},playerAlexAquatic:{type:"atlasJSON",pngPath:this.assetRoot+"images/Alex_2018.png",jsonPath:this.assetRoot+"images/Alex_2018.json"},AO:{type:"atlasJSON",pngPath:this.assetRoot+"images/AO.png",jsonPath:this.assetRoot+"images/AO.json"},LavaGlow:{type:"atlasJSON",pngPath:this.assetRoot+"images/LavaGlow.png",jsonPath:this.assetRoot+"images/LavaGlow.json"},WaterAO:{type:"atlasJSON",pngPath:this.assetRoot+"images/WaterAO.png",jsonPath:this.assetRoot+"images/WaterAO.json"},blockShadows:{type:"atlasJSON",pngPath:this.assetRoot+"images/Block_Shadows.png",jsonPath:this.assetRoot+"images/Block_Shadows.json"},undergroundFow:{type:"atlasJSON",pngPath:this.assetRoot+"images/UndergroundFoW.png",jsonPath:this.assetRoot+"images/UndergroundFoW.json"},blocks:{type:"atlasJSON",pngPath:this.assetRoot+"images/Blocks.png",jsonPath:this.assetRoot+"images/Blocks.json"},leavesAcacia:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Acacia_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Acacia_Decay.json"},leavesBirch:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Birch_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Birch_Decay.json"},leavesJungle:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Jungle_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Jungle_Decay.json"},leavesOak:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Oak_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Oak_Decay.json"},leavesSpruce:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Spruce_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Spruce_Decay.json"},leavesSpruceSnowy:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Spruce_Snowy_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Spruce_Snowy_Decay.json"},sheep:{type:"atlasJSON",pngPath:this.assetRoot+"images/Sheep_2016.png",jsonPath:this.assetRoot+"images/Sheep_2016.json"},crops:{type:"atlasJSON",pngPath:this.assetRoot+"images/Crops.png",jsonPath:this.assetRoot+"images/Crops.json"},torch:{type:"atlasJSON",pngPath:this.assetRoot+"images/Torch.png",jsonPath:this.assetRoot+"images/Torch.json"},destroyOverlay:{type:"atlasJSON",pngPath:this.assetRoot+"images/Destroy_Overlay.png",jsonPath:this.assetRoot+"images/Destroy_Overlay.json"},blockExplode:{type:"atlasJSON",pngPath:this.assetRoot+"images/BlockExplode.png",jsonPath:this.assetRoot+"images/BlockExplode.json"},miningParticles:{type:"atlasJSON",pngPath:this.assetRoot+"images/MiningParticles.png",jsonPath:this.assetRoot+"images/MiningParticles.json"},miniBlocks:{type:"atlasJSON",pngPath:this.assetRoot+"images/Miniblocks.png",jsonPath:this.assetRoot+"images/Miniblocks.json"},lavaPop:{type:"atlasJSON",pngPath:this.assetRoot+"images/LavaPop.png",jsonPath:this.assetRoot+"images/LavaPop.json"},redstoneSparkle:{type:"atlasJSON",pngPath:this.assetRoot+"images/Redstone_Sparkle.png",jsonPath:this.assetRoot+"images/Redstone_Sparkle.json"},fire:{type:"atlasJSON",pngPath:this.assetRoot+"images/Fire.png",jsonPath:this.assetRoot+"images/Fire.json"},bubbles:{type:"atlasJSON",pngPath:this.assetRoot+"images/Bubbles.png",jsonPath:this.assetRoot+"images/Bubbles.json"},explosion:{type:"atlasJSON",pngPath:this.assetRoot+"images/Explosion.png",jsonPath:this.assetRoot+"images/Explosion.json"},door:{type:"atlasJSON",pngPath:this.assetRoot+"images/Door.png",jsonPath:this.assetRoot+"images/Door.json"},doorIron:{type:"atlasJSON",pngPath:this.assetRoot+"images/Door_Iron.png",jsonPath:this.assetRoot+"images/Door_Iron.json"},rails:{type:"atlasJSON",pngPath:this.assetRoot+"images/Rails.png",jsonPath:this.assetRoot+"images/Rails.json"},tnt:{type:"atlasJSON",pngPath:this.assetRoot+"images/TNT.png",jsonPath:this.assetRoot+"images/TNT.json"},burningInSun:{type:"atlasJSON",pngPath:this.assetRoot+"images/BurningInSun.png",jsonPath:this.assetRoot+"images/BurningInSun.json"},zombie:{type:"atlasJSON",pngPath:this.assetRoot+"images/Zombie.png",jsonPath:this.assetRoot+"images/Zombie.json"},ironGolem:{type:"atlasJSON",pngPath:this.assetRoot+"images/Iron_Golem.png",jsonPath:this.assetRoot+"images/Iron_Golem.json"},creeper:{type:"atlasJSON",pngPath:this.assetRoot+"images/Creeper_2016.png",jsonPath:this.assetRoot+"images/Creeper_2016.json"},cow:{type:"atlasJSON",pngPath:this.assetRoot+"images/Cow.png",jsonPath:this.assetRoot+"images/Cow.json"},chicken:{type:"atlasJSON",pngPath:this.assetRoot+"images/Chicken.png",jsonPath:this.assetRoot+"images/Chicken.json"},cod:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Cod_2018.png",jsonPath:this.assetRoot+"images/entities/Cod_2018.json"},dolphin:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Dolphin_2018.png",jsonPath:this.assetRoot+"images/entities/Dolphin_2018.json"},ghast:{type:"atlasJSON",pngPath:this.assetRoot+"images/Ghast.png",jsonPath:this.assetRoot+"images/Ghast.json"},salmon:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Salmon_2018.png",jsonPath:this.assetRoot+"images/entities/Salmon_2018.json"},seaTurtle:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Sea_Turtle_2018.png",jsonPath:this.assetRoot+"images/entities/Sea_Turtle_2018.json"},squid:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Squid_2018.png",jsonPath:this.assetRoot+"images/entities/Squid_2018.json"},tropicalFish:{type:"atlasJSON",pngPath:this.assetRoot+"images/entities/Tropical_Fish_2018.png",jsonPath:this.assetRoot+"images/entities/Tropical_Fish_2018.json"},dig_wood1:{type:"sound",mp3:this.assetRoot+"audio/dig_wood1.mp3",wav:this.assetRoot+"audio/dig_wood1.wav",ogg:this.assetRoot+"audio/dig_wood1.ogg"},stepGrass:{type:"sound",mp3:this.assetRoot+"audio/step_grass1.mp3",wav:this.assetRoot+"audio/step_grass1.wav",ogg:this.assetRoot+"audio/step_grass1.ogg"},stepWood:{type:"sound",mp3:this.assetRoot+"audio/wood2.mp3",ogg:this.assetRoot+"audio/wood2.ogg"},stepStone:{type:"sound",mp3:this.assetRoot+"audio/stone2.mp3",ogg:this.assetRoot+"audio/stone2.ogg"},stepGravel:{type:"sound",mp3:this.assetRoot+"audio/gravel1.mp3",ogg:this.assetRoot+"audio/gravel1.ogg"},stepFarmland:{type:"sound",mp3:this.assetRoot+"audio/cloth4.mp3",ogg:this.assetRoot+"audio/cloth4.ogg"},failure:{type:"sound",mp3:this.assetRoot+"audio/break.mp3",ogg:this.assetRoot+"audio/break.ogg"},success:{type:"sound",mp3:this.assetRoot+"audio/levelup.mp3",ogg:this.assetRoot+"audio/levelup.ogg"},fall:{type:"sound",mp3:this.assetRoot+"audio/fallsmall.mp3",ogg:this.assetRoot+"audio/fallsmall.ogg"},fuse:{type:"sound",mp3:this.assetRoot+"audio/fuse.mp3",ogg:this.assetRoot+"audio/fuse.ogg"},explode:{type:"sound",mp3:this.assetRoot+"audio/explode3.mp3",ogg:this.assetRoot+"audio/explode3.ogg"},placeBlock:{type:"sound",mp3:this.assetRoot+"audio/cloth1.mp3",ogg:this.assetRoot+"audio/cloth1.ogg"},collectedBlock:{type:"sound",mp3:this.assetRoot+"audio/pop.mp3",ogg:this.assetRoot+"audio/pop.ogg"},bump:{type:"sound",mp3:this.assetRoot+"audio/hit3.mp3",ogg:this.assetRoot+"audio/hit3.ogg"},punch:{type:"sound",mp3:this.assetRoot+"audio/cloth1.mp3",ogg:this.assetRoot+"audio/cloth1.ogg"},fizz:{type:"sound",mp3:this.assetRoot+"audio/fizz.mp3",ogg:this.assetRoot+"audio/fizz.ogg"},doorOpen:{type:"sound",mp3:this.assetRoot+"audio/door_open.mp3",ogg:this.assetRoot+"audio/door_open.ogg"},houseSuccess:{type:"sound",mp3:this.assetRoot+"audio/launch1.mp3",ogg:this.assetRoot+"audio/launch1.ogg"},minecart:{type:"sound",mp3:this.assetRoot+"audio/minecartBase.mp3",ogg:this.assetRoot+"audio/minecartBase.ogg"},sheepBaa:{type:"sound",mp3:this.assetRoot+"audio/say3.mp3",ogg:this.assetRoot+"audio/say3.ogg"},chickenHurt:{type:"sound",mp3:this.assetRoot+"audio/chickenhurt2.mp3",ogg:this.assetRoot+"audio/chickenhurt2.ogg"},chickenBawk:{type:"sound",mp3:this.assetRoot+"audio/chickensay3.mp3",ogg:this.assetRoot+"audio/chickensay3.ogg"},cowHuff:{type:"sound",mp3:this.assetRoot+"audio/cowhuff.mp3",ogg:this.assetRoot+"audio/cowhuff.ogg"},cowHurt:{type:"sound",mp3:this.assetRoot+"audio/cowhurt.mp3",ogg:this.assetRoot+"audio/cowhurt.ogg"},cowMoo:{type:"sound",mp3:this.assetRoot+"audio/cowmoo1.mp3",ogg:this.assetRoot+"audio/cowmoo1.ogg"},cowMooLong:{type:"sound",mp3:this.assetRoot+"audio/cowmoolong.mp3",ogg:this.assetRoot+"audio/cowmoolong.ogg"},creeperHiss:{type:"sound",mp3:this.assetRoot+"audio/creeper.mp3",ogg:this.assetRoot+"audio/creeper.ogg"},ironGolemHit:{type:"sound",mp3:this.assetRoot+"audio/irongolemhit.mp3",ogg:this.assetRoot+"audio/irongolemhit.ogg"},metalWhack:{type:"sound",mp3:this.assetRoot+"audio/metalwhack.mp3",ogg:this.assetRoot+"audio/metalwhack.ogg"},zombieBrains:{type:"sound",mp3:this.assetRoot+"audio/zombiebrains.mp3",ogg:this.assetRoot+"audio/zombiebrains.ogg"},zombieGroan:{type:"sound",mp3:this.assetRoot+"audio/zombiegroan.mp3",ogg:this.assetRoot+"audio/zombiegroan.ogg"},zombieHurt:{type:"sound",mp3:this.assetRoot+"audio/zombiehurt1.mp3",ogg:this.assetRoot+"audio/zombiehurt1.ogg"},pistonIn:{type:"sound",mp3:this.assetRoot+"audio/piston_in.mp3",ogg:this.assetRoot+"audio/piston_in.ogg"},zombieHurt2:{type:"sound",mp3:this.assetRoot+"audio/zombiehurt2.mp3",ogg:this.assetRoot+"audio/zombiehurt2.ogg"},pistonOut:{type:"sound",mp3:this.assetRoot+"audio/piston_out.mp3",ogg:this.assetRoot+"audio/piston_out.ogg"},portalAmbient:{type:"sound",mp3:this.assetRoot+"audio/portal.mp3",ogg:this.assetRoot+"audio/portal.ogg"},portalTravel:{type:"sound",mp3:this.assetRoot+"audio/travel_portal.mp3",ogg:this.assetRoot+"audio/travel_portal.ogg"},pressurePlateClick:{type:"sound",mp3:this.assetRoot+"audio/pressurePlateClick.mp3",ogg:this.assetRoot+"audio/pressurePlateClick.ogg"},moan2:{type:"sound",mp3:this.assetRoot+"audio/moan2.mp3",ogg:this.assetRoot+"audio/moan2.ogg"},moan3:{type:"sound",mp3:this.assetRoot+"audio/moan3.mp3",ogg:this.assetRoot+"audio/moan3.ogg"},moan6:{type:"sound",mp3:this.assetRoot+"audio/moan6.mp3",ogg:this.assetRoot+"audio/moan6.ogg"},moan7:{type:"sound",mp3:this.assetRoot+"audio/moan7.mp3",ogg:this.assetRoot+"audio/moan7.ogg"}};var i=["chicken","entityShadow","selectionIndicator","AO","blockShadows","blocks","miniBlocks","stepGrass","failure","success"].concat(["dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","minecart","sheepBaa","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"]),o=["entityShadow","selectionIndicator","finishOverlay","AO","WaterAO","blockShadows","blocks","leavesJungle","destroyOverlay","blockExplode","miningParticles","miniBlocks","bubbles","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","failure","success","fall","placeBlock","collectedBlock","bump","punch"];this.assetPacks={adventurerLevelOneAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesOak","leavesBirch","blocks","sheep","bump","stepGrass","failure","success"],adventurerLevelTwoAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesSpruce","blocks","sheep","bump","stepGrass","failure","playerSteve","success","miniBlocks","blockExplode","miningParticles","destroyOverlay","dig_wood1","collectedBlock","punch"],adventurerLevelThreeAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesOak","blocks","sheep","bump","stepGrass","failure","playerSteve","success","miniBlocks","blockExplode","miningParticles","destroyOverlay","dig_wood1","collectedBlock","sheepBaa","punch"],adventurerAllAssetsMinusPlayer:["entityShadow","selectionIndicator","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesOak","leavesSpruce","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","fire","bubbles","explosion","door","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa"],levelOneAssets:i,levelTwoAssets:i,levelThreeAssets:i,designerAllAssetsMinusPlayer:["entityShadow","selectionIndicator","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesJungle","leavesOak","leavesSpruce","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","fire","bubbles","explosion","door","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","ironGolem","burningInSun","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2"],heroAllAssetsMinusPlayer:["entityShadow","selectionIndicator","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesOak","leavesSpruce","leavesSpruceSnowy","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","redstoneSparkle","fire","bubbles","explosion","door","doorIron","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","burningInSun","ghast","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"],aquaticIslandAssets:o,aquaticLevelThreeAndFourAssets:o.concat("cod","dolphin"),aquaticAllAssetsMinusPlayer:["entityShadow","selectionIndicator","finishOverlay","underwaterOverlay","AO","LavaGlow","WaterAO","lavaPop","blockShadows","undergroundFow","blocks","leavesJungle","cod","crops","torch","dolphin","salmon","seaTurtle","squid","tropicalFish","destroyOverlay","blockExplode","miningParticles","miniBlocks","bubbles","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","failure","success","fall","placeBlock","collectedBlock","bump","punch"],allAssetsMinusPlayer:["entityShadow","selectionIndicator","finishOverlay","underwaterOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","cod","dolphin","salmon","seaTurtle","squid","tropicalFish","leavesAcacia","leavesBirch","leavesJungle","leavesOak","leavesSpruce","leavesSpruceSnowy","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","redstoneSparkle","fire","bubbles","explosion","door","doorIron","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","ghast","ironGolem","burningInSun","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"],playerSteve:["playerSteve"],playerAlex:["playerAlex"],playerSteveEvents:["playerSteveEvents"],playerAlexEvents:["playerAlexEvents"],playerAgent:["playerAgent"],playerSteveAquatic:["playerSteveAquatic"],playerAlexAquatic:["playerAlexAquatic"]}}return o(e,[{key:"loadPacks",value:function(e){var t=this;e.forEach(function(e){t.loadPack(e)})}},{key:"loadPack",value:function(e){var t=this.assetPacks[e];this.loadAssets(t)}},{key:"loadAssets",value:function(e){var t=this;e.forEach(function(e){var i=t.assets[e];t.loadAsset(e,i)})}},{key:"loadAsset",value:function(e,t){switch(t.type){case"image":this.game.load.image(e,t.path);break;case"sound":this.audioPlayer.register({id:e,mp3:t.mp3,ogg:t.ogg});break;case"atlasJSON":this.game.load.atlasJSONHash(e,t.pngPath,t.jsonPath);break;default:throw"Asset "+e+" needs config.type set in configuration."}}}]),e}()},function(e,t,i){"use strict";var o=i(36),n=i(37),a=i(38),r=i(39),s=i(40),l=i(41),c=i(42),h=i(4),u=i(43);e.exports.get=function(e){return{startCommandCollection:function(){e.DEBUG&&console.log("Collecting commands.")},startAttempt:function(t){return new Promise(function(i){e.OnCompleteCallback=function(){t&&t.apply(void 0,arguments),i(arguments.length<=0?void 0:arguments[0])},e.setPlayerActionDelayByQueueLength(),e.queue.begin(),e.run(),e.attemptRunning=!0,e.resultReported=!1})},resetAttempt:function(){e.reset(),e.queue.reset(),e.OnCompleteCallback=null,e.attemptRunning=!1},registerEventCallback:function(t,i){e.events.push(i)},onEventTriggered:function(e,t,i,o){this.registerEventCallback(e,function(e){e.eventType===i&&e.targetType===t&&o(e)})},isEventTriggered:function(e,t){return e.eventType===t},moveDirection:function(t,i,o){e.addCommand(new l(e,t,i,o),i)},moveForward:function(t,i,o){e.addCommand(new r(e,t,i,o),i)},moveBackward:function(t,i){e.addCommand(new s(e,t,i),i)},moveAway:function(t,i,o){var n=new h(e,t,function(){e.moveAway(n,o)},i);e.addCommand(n)},moveToward:function(t,i,o){var n=new h(e,t,function(){e.moveToward(n,o)},i);e.addCommand(n)},flashEntity:function(t,i){var o=new h(e,t,function(){e.flashEntity(o)},i);e.addCommand(o)},explodeEntity:function(t,i){var o=new h(e,t,function(){e.explodeEntity(o)},i);e.addCommand(o)},use:function(t,i){var o=new h(e,t,function(){e.use(o,i)},i);e.addCommand(o)},playSound:function(t,i,o){var n=new h(e,t,function(){e.playSound(n,i)},o);e.addCommand(n)},turn:function(t,i,o,n){var a=new h(e,t,function(){e.turn(a,"right"===i?1:-1)},o,n);e.addCommand(a)},turnRandom:function(t,i){var o=new h(e,t,function(){e.turnRandom(o)},i);e.addCommand(o)},turnRight:function(e,t,i){this.turn(e,"right",t,i)},turnLeft:function(e,t,i){this.turn(e,"left",t,i)},destroyBlock:function(t,i){var o=new h(e,t,function(){e.destroyBlock(o)},i);e.addCommand(o)},placeBlock:function(t,i,n){e.addCommand(new o(e,t,i,n),n)},placeDirection:function(t,i,o,n){e.addCommand(new a(e,t,i,o,n),o,n)},placeInFront:function(t,i,o){e.addCommand(new n(e,t,i,o),o)},tillSoil:function(t,i){e.addCommand(new n(e,t,"watering",i))},ifBlockAhead:function(t,i,o,n){e.addCommand(new c(e,t,i,o,n),o)},repeat:function(t,i,o,n){e.addCommand(new u(e,t,i,o,n))},repeatRandom:function(t,i,o){var n=Math.floor(10*Math.random())+1;e.addCommand(new u(e,t,i,n,o))},getScreenshot:function(){return e.getScreenshot()},spawnEntity:function(t,i,o){var n=new h(e,t,function(){e.spawnEntity(n,i,o)});e.addCommand(n)},spawnEntityAt:function(t,i,o,n,a){var r=new h(e,t,function(){e.spawnEntityAt(r,i,o,n,a)});e.addCommand(r)},destroyEntity:function(t,i){var o=new h(e,t,function(){e.destroyEntity(o,i)},i);e.addGlobalCommand(o)},drop:function(t,i,o){var n=new h(e,t,function(){e.drop(n,i)},o);e.addCommand(n)},startDay:function(t){var i=new h(e,t,function(){e.startDay(i)});e.addGlobalCommand(i)},startNight:function(t){var i=new h(e,t,function(){e.startNight(i)});e.addGlobalCommand(i)},wait:function(t,i,o){var n=new h(e,t,function(){e.wait(n,i)},o);e.addGlobalCommand(n)},attack:function(t,i){var o=new h(e,t,function(){e.attack(o)},i);e.addCommand(o)},setDayNightCycle:function(t,i,o){e.dayNightCycle||(e.dayNightCycle=!0,e.initiateDayNightCycle(t,i,o))},addScore:function(t,i,o){var n=new h(e,t,function(){e.addScore(n,i)},o);e.addGlobalCommand(n)},arrowDown:function(t){e.arrowDown(t)},arrowUp:function(t){e.arrowUp(t)},clickDown:function(){e.clickDown()},clickUp:function(){e.clickUp()}}}},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return a.BlockType=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlock(this,this.BlockType)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return a.BlockType=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlockForward(this,this.BlockType)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return r.BlockType=o,r.Direction=a,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlockDirection(this,this.BlockType,this.Direction)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveForward(this)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveBackward(this)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return a.Direciton=n,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveDirection(this,this.Direciton)}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(9),a=i(8),r=i(2);e.exports=function(e){function t(e,i,o,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return s.blockType=o,s.ifCodeCallback=r,s.queue=new a(e),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"tick",value:function(){this.state===n.WORKING&&this.queue.tick(),this.queue.isFailed()&&(this.state=n.FAILURE),this.queue.isSucceeded()&&(this.state=n.SUCCESS)}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.DEBUG&&console.log("WHILE command: BEGIN"),this.handleIfCheck()}},{key:"handleIfCheck",value:function(){if(this.GameController.isPathAhead(this.blockType)){var e=this.GameController.getEntity(this.target).queue;this.queue.reset(),e.setWhileCommandInsertState(this.queue),this.ifCodeCallback(),e.setWhileCommandInsertState(null),this.queue.begin()}else this.state=n.SUCCESS}}]),t}()},function(e,t,i){"use strict";var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();var n=i(2);e.exports=function(e){function t(e,i,o,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a));return r.actionCallback=o,r.iteration=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),o(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.succeeded(),this.addRepeatCommand()}},{key:"addRepeatCommand",value:function(){var e=this.GameController.levelEntity.entityMap.get(this.target);void 0===e?this.GameController.queue.addRepeatCommands(this.actionCallback,this.iteration):e.queue.addRepeatCommands(this.actionCallback,this.iteration)}}]),t}()}])});